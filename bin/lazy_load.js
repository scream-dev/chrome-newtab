// Copyright 2014 The Chromium Authors
// Use of this source code is governed by a BSD-style license that can be
// found in the LICENSE file.
import{css,html,CrLitElement,nothing}from"chrome://resources/lit/v3_0/lit.rollup.js";import{K as parseHtmlSubset,s as sanitizeInnerHtml,c as getCss$j,m as getCss$k,N as NewTabPageProxy,E as EventTracker,b as assert,B as BrowserCommandProxy,t as CrAutoImgElement,W as WindowProxy,C as Command,L as assertInstanceof,h as hasKeyModifiers,M as isRTL,O as isIOS,P as getDeepActiveElement,Q as isWindows,R as isMac,F as FocusOutlineManager,o as recordLoadDuration,r as recordDuration,I as I18nMixin,S as CrRippleMixin,u as getTrustedHTML,g as getFaviconForPageURL,l as getCss$l,w as recordOccurence,d as skColorToRgba,T as SUPPORTED_FILE_TYPES,v as processFile,x as recordPerdecage,H as HelpBubbleProxyImpl,e as debounceEnd,f as HelpBubbleController,i as HELP_BUBBLE_DISMISSED_EVENT,j as HELP_BUBBLE_TIMED_OUT_EVENT,k as HelpBubbleClosedReason}from"./shared.rollup.js";export{V as VoiceSearchOverlayElement}from"./shared.rollup.js";import{loadTimeData}from"chrome://resources/js/load_time_data.js";import"./strings.m.js";import{html as html$1,PolymerElement,templatize,microTask,dedupingMixin}from"chrome://resources/polymer/v3_0/polymer/polymer_bundled.min.js";import{FileSuggestionHandler}from"./file_suggestion.mojom-webui.js";import{GoogleCalendarPageHandler}from"./google_calendar.mojom-webui.js";import{OutlookCalendarPageHandler}from"./outlook_calendar.mojom-webui.js";import{PageHandler,ScoredURLUserAction}from"./most_relevant_tab_resumption.mojom-webui.js";import{VisitSource,FormFactor}from"./url_visit_types.mojom-webui.js";import{TextDirection}from"chrome://resources/mojo/mojo/public/mojom/base/text_direction.mojom-webui.js";import{MostVisitedPageCallbackRouter,MostVisitedPageHandlerRemote,MostVisitedPageHandlerFactory}from"chrome://resources/cr_components/most_visited/most_visited.mojom-webui.js";import{PageImageServiceHandler}from"chrome://resources/cr_components/page_image_service/page_image_service.mojom-webui.js";import{IphFeature}from"./new_tab_page.mojom-webui.js";import"chrome://resources/mojo/mojo/public/js/bindings.js";import"chrome://resources/mojo/mojo/public/mojom/base/time.mojom-webui.js";const I18nMixinLit=superClass=>{class I18nMixinLit extends superClass{i18nRaw_(id,...varArgs){return varArgs.length===0?loadTimeData.getString(id):loadTimeData.getStringF(id,...varArgs)}i18n(id,...varArgs){const rawString=this.i18nRaw_(id,...varArgs);return parseHtmlSubset(`<b>${rawString}</b>`).firstChild.textContent}i18nAdvanced(id,opts){opts=opts||{};const rawString=this.i18nRaw_(id,...opts.substitutions||[]);return sanitizeInnerHtml(rawString,opts)}i18nDynamic(_locale,id,...varArgs){return this.i18n(id,...varArgs)}i18nRecursive(locale,id,...varArgs){let args=varArgs;if(args.length>0){args=args.map((str=>this.i18nExists(str)?loadTimeData.getString(str):str))}return this.i18nDynamic(locale,id,...args)}i18nExists(id){return loadTimeData.valueExists(id)}}return I18nMixinLit};let instance$p=null;function getCss$i(){return instance$p||(instance$p=[...[getCss$j(),getCss$k()],css`#promoContainer{background-color:var(--color-new-tab-page-module-background);border-radius:12px;display:flex;flex-direction:column;justify-content:center;gap:8px;height:111px;padding:12px;width:271px}#titleAndDismissContainer{align-items:center;display:flex;height:24px;justify-content:space-between}#title{color:var(--color-new-tab-page-primary-foreground);font-size:13px;font-weight:500;line-height:20px}#dismissButton{--cr-icon-button-fill-color:var(--color-new-tab-page-mobile-promo-dismiss-button, currentColor);--cr-icon-button-icon-size:18px;--cr-icon-button-margin-end:0px;--cr-icon-button-size:24px}#descriptionAndQrCodeContainer{align-items:center;display:flex;gap:8px}#description{color:var(--color-new-tab-page-secondary-foreground);line-height:18px;height:54px;width:185px}#qrCode{border:1px solid var(--color-new-tab-page-most-visited-tile-background);border-radius:8px;box-sizing:border-box;height:78px;width:78px}`])}function getHtml$h(){return html`<!--_html_template_start_--><div id="promoContainer">
  <div id="titleAndDismissContainer">
    <h2 id="title">РЈСЃС‚Р°РЅРѕРІРёС‚Рµ Chrome РЅР° РјРѕР±РёР»СЊРЅРѕРµ СѓСЃС‚СЂРѕР№СЃС‚РІРѕ</h2>
    <cr-icon-button id="dismissButton" class="icon-clear" aria-label="Р—Р°РєСЂС‹С‚СЊ" title="Р—Р°РєСЂС‹С‚СЊ" @click="${this.onDismissButtonClick_}">
    </cr-icon-button>
  </div>
  <div id="descriptionAndQrCodeContainer">
    <div id="description">РЎРєР°С‡Р°Р№С‚Рµ Chrome РґР»СЏ iOS, С‡С‚РѕР±С‹ РІР°С€Рё РІРєР»Р°РґРєРё, РїР°СЂРѕР»Рё Рё Р·Р°РєР»Р°РґРєРё Р±С‹Р»Рё РґРѕСЃС‚СѓРїРЅС‹ РЅР° С‚РµР»РµС„РѕРЅРµ.</div>
    <img id="qrCode" src="data:image/webp;base64,${this.qrCode}" aria-label="РЎРєР°РЅРёСЂРѕРІР°РЅРёРµ QR-РєРѕРґР°" ?hidden="${!this.qrCode}">
  </div>
</div>
<cr-toast id="dismissPromoButtonToast" duration="10000">
  <div id="dismissPromoButtonToastMessage">
    Р’С‹ Р±РѕР»СЊС€Рµ РЅРµ СѓРІРёРґРёС‚Рµ СЌС‚Рѕ СЃРѕРѕР±С‰РµРЅРёРµ.
  </div>
  <cr-button id="undoDismissPromoButton" aria-label="Р§С‚РѕР±С‹ РѕС‚РјРµРЅРёС‚СЊ РґРµР№СЃС‚РІРёРµ, РЅР°Р¶РјРёС‚Рµ CtrlВ +В Z" @click="${this.onUndoDismissPromoButtonClick_}">
    РћС‚РјРµРЅР°
  </cr-button>
</cr-toast>
<!--_html_template_end_-->`}class MobilePromoElement extends CrLitElement{static get is(){return"ntp-mobile-promo"}static get styles(){return getCss$i()}render(){return getHtml$h.bind(this)()}static get properties(){return{qrCode:{type:String,notify:true}}}constructor(){super();NewTabPageProxy.getInstance().handler.getMobilePromoQrCode().then((({qrCode:qrCode})=>{this.qrCode=qrCode}))}onDismissButtonClick_(){NewTabPageProxy.getInstance().handler.onDismissMobilePromo();this.$.promoContainer.hidden=true;this.$.dismissPromoButtonToast.show()}onUndoDismissPromoButtonClick_(){NewTabPageProxy.getInstance().handler.onUndoDismissMobilePromo();this.$.promoContainer.hidden=false;this.$.dismissPromoButtonToast.hide()}}customElements.define(MobilePromoElement.is,MobilePromoElement);let instance$o=null;function getCss$h(){return instance$o||(instance$o=[...[getCss$j(),getCss$k()],css`:host{font-size:12px;max-width:537px}#promoAndDismissContainer{align-items:center;background-color:var(--color-new-tab-page-promo-background);border:solid var(--color-new-tab-page-border) 1px;border-radius:24px;box-sizing:border-box;color:var(--color-new-tab-page-primary-foreground);display:flex;flex-direction:row;height:30px;justify-content:center}#promoContainer{align-items:center;display:flex;overflow-x:hidden;padding-inline-end:8px;white-space:pre}:host([shown-middle-slot-promo-id_]) #promoContainer{padding-inline-end:2px}#promoContainer>:first-child{margin-inline-start:8px}a{color:var(--color-new-tab-page-link);cursor:pointer;text-decoration:underline}a:focus{border-radius:2px;box-shadow:var(--ntp-focus-shadow);outline:0}img{background-color:var(--color-new-tab-page-promo-image-background);border-radius:50%;height:20px;margin-inline-end:4px;pointer-events:none;width:20px}#dismissPromoButton{--cr-icon-button-icon-size:14px;--cr-icon-button-size:20px;--cr-icon-button-fill-color:var(--color-new-tab-page-primary-foreground);color:var(--color-new-tab-page-primary-foreground);margin-inline-end:4px;margin-inline-start:8px}#promoContainer>:last-child{overflow:hidden;text-overflow:ellipsis}`])}function getHtml$g(){return html`<!--_html_template_start_-->
<div id="promoAndDismissContainer" hidden>
  
  ${this.shownMiddleSlotPromoId_?html`
    <cr-icon-button id="dismissPromoButton" class="icon-clear" aria-label="Р—Р°РєСЂС‹С‚СЊ" title="Р—Р°РєСЂС‹С‚СЊ" @click="${this.onDismissPromoButtonClick_}">
    </cr-icon-button>
  `:""}
</div>
${this.mobilePromoEnabled_?html`
  
  <ntp-mobile-promo id="mobilePromo" @qr-code-changed="${this.onMobilePromoQrCodeChanged_}" hidden>
  </ntp-mobile-promo>
`:""}
<cr-toast id="dismissPromoButtonToast" duration="10000">
  <div id="dismissPromoButtonToastMessage">
    Р’С‹ Р±РѕР»СЊС€Рµ РЅРµ СѓРІРёРґРёС‚Рµ СЌС‚Рѕ СЃРѕРѕР±С‰РµРЅРёРµ.
  </div>
  <cr-button id="undoDismissPromoButton" aria-label="Р§С‚РѕР±С‹ РѕС‚РјРµРЅРёС‚СЊ РґРµР№СЃС‚РІРёРµ, РЅР°Р¶РјРёС‚Рµ CtrlВ +В Z" @click="${this.onUndoDismissPromoButtonClick_}">
    РћС‚РјРµРЅР°
  </cr-button>
</cr-toast>
<!--_html_template_end_-->`}var PromoDismissAction;(function(PromoDismissAction){PromoDismissAction[PromoDismissAction["DISMISS"]=0]="DISMISS";PromoDismissAction[PromoDismissAction["RESTORE"]=1]="RESTORE"})(PromoDismissAction||(PromoDismissAction={}));function recordPromoDismissAction(action){chrome.metricsPrivate.recordEnumerationValue("NewTabPage.Promos.DismissAction",action,Object.keys(PromoDismissAction).length)}async function renderPromo(promo){const browserHandler=NewTabPageProxy.getInstance().handler;const promoBrowserCommandHandler=BrowserCommandProxy.getInstance().handler;if(!promo){return null}const commandIds=[];function createAnchor(target){const commandIdMatch=/^command:(\d+)$/.exec(target.url);if(!commandIdMatch&&!target.url.startsWith("https://")){return null}const el=document.createElement("a");let commandId=null;if(!commandIdMatch){el.href=target.url}else{commandId=+commandIdMatch[1];if(!Object.values(Command).includes(commandId)){commandId=Command.kUnknownCommand}commandIds.push(commandId)}function onClick(event){if(commandId!==null){promoBrowserCommandHandler.executeCommand(commandId,{middleButton:event.button===1,altKey:event.altKey,ctrlKey:event.ctrlKey,metaKey:event.metaKey,shiftKey:event.shiftKey})}browserHandler.onPromoLinkClicked()}el.addEventListener("auxclick",onClick);el.addEventListener("click",onClick);return el}let hasContent=false;const promoContainer=document.createElement("div");promoContainer.id="promoContainer";promo.middleSlotParts.forEach((({image:image,link:link,text:text})=>{let el;if(image){el=new CrAutoImgElement;el.autoSrc=image.imageUrl.url;el.staticEncode=true;if(image.target){const anchor=createAnchor(image.target);if(anchor){anchor.appendChild(el);el=anchor}}el.classList.add("image")}else if(link){el=createAnchor(link.url)}else if(text){el=document.createElement("span")}const linkOrText=link||text;if(el&&linkOrText){el.innerText=linkOrText.text}if(el){hasContent=true;promoContainer.appendChild(el)}}));const canShow=(await Promise.all(commandIds.map((commandId=>promoBrowserCommandHandler.canExecuteCommand(commandId))))).every((({canExecute:canExecute})=>canExecute));if(hasContent&&canShow){browserHandler.onPromoRendered(WindowProxy.getInstance().now(),promo.logUrl||null);return{container:promoContainer,id:promo.id}}return null}class MiddleSlotPromoElement extends CrLitElement{static get is(){return"ntp-middle-slot-promo"}static get styles(){return getCss$h()}render(){return getHtml$g.bind(this)()}static get properties(){return{mobilePromoEnabled_:{type:Boolean},shownMiddleSlotPromoId_:{type:String,reflect:true},hasDefaultPromo_:{type:Boolean},hasMobilePromoContent_:{type:Boolean},promo_:{type:Object}}}constructor(){super();this.mobilePromoEnabled_=loadTimeData.getBoolean("mobilePromoEnabled");this.hasDefaultPromo_=null;this.hasMobilePromoContent_=null;this.eventTracker_=new EventTracker;this.setPromoListenerId_=null;this.pageHandler_=NewTabPageProxy.getInstance().handler}connectedCallback(){super.connectedCallback();this.setPromoListenerId_=NewTabPageProxy.getInstance().callbackRouter.setPromo.addListener((promo=>{this.promo_=promo}));this.eventTracker_.add(window,"keydown",this.onWindowKeydown_.bind(this));this.pageHandler_.updatePromoData()}disconnectedCallback(){super.disconnectedCallback();this.eventTracker_.removeAll();NewTabPageProxy.getInstance().callbackRouter.removeListener(this.setPromoListenerId_)}updated(changedProperties){super.updated(changedProperties);const changedPrivateProperties=changedProperties;if(changedPrivateProperties.has("promo_")){this.onPromoChange_()}if(changedPrivateProperties.has("hasDefaultPromo_")||changedPrivateProperties.has("hasMobilePromoContent_")){this.updatePromoVisibility_()}}updatePromoVisibility_(){if(this.hasDefaultPromo_===null){return}this.$.promoAndDismissContainer.hidden=!this.hasDefaultPromo_;if(this.mobilePromoEnabled_){const showMobilePromo=!this.hasDefaultPromo_&&this.hasMobilePromoContent_;this.$.mobilePromo.hidden=!showMobilePromo;if(showMobilePromo){this.pageHandler_.onMobilePromoShown()}}if(!this.mobilePromoEnabled_||this.hasMobilePromoContent_!==null){this.fire("ntp-middle-slot-promo-loaded")}}onMobilePromoQrCodeChanged_(e){this.hasMobilePromoContent_=!!e.detail.value}onPromoChange_(){if(this.mobilePromoEnabled_){if(this.hasMobilePromoContent_&&this.hasDefaultPromo_!==null){return}}renderPromo(this.promo_).then((promo=>{if(!promo){this.hasDefaultPromo_=false}else{const promoContainer=this.shadowRoot.getElementById("promoContainer");if(promoContainer){promoContainer.remove()}if(loadTimeData.getBoolean("middleSlotPromoDismissalEnabled")){this.shownMiddleSlotPromoId_=promo.id??""}const renderedPromoContainer=promo.container;assert(renderedPromoContainer);this.$.promoAndDismissContainer.prepend(renderedPromoContainer);this.mobilePromoEnabled_=false;this.hasDefaultPromo_=true}}))}onWindowKeydown_(e){let ctrlKeyPressed=e.ctrlKey;if(ctrlKeyPressed&&e.key==="z"){this.onUndoDismissPromoButtonClick_()}}onDismissPromoButtonClick_(){assert(this.$.promoAndDismissContainer);this.$.promoAndDismissContainer.hidden=true;this.pageHandler_.blocklistPromo(this.shownMiddleSlotPromoId_);this.blocklistedMiddleSlotPromoId_=this.shownMiddleSlotPromoId_;this.$.dismissPromoButtonToast.show();recordPromoDismissAction(PromoDismissAction.DISMISS)}onUndoDismissPromoButtonClick_(){assert(this.$.promoAndDismissContainer);this.pageHandler_.undoBlocklistPromo(this.blocklistedMiddleSlotPromoId_);this.$.promoAndDismissContainer.hidden=false;this.$.dismissPromoButtonToast.hide();recordPromoDismissAction(PromoDismissAction.RESTORE)}}customElements.define(MiddleSlotPromoElement.is,MiddleSlotPromoElement);const ACTIVE_CLASS="focus-row-active";class FocusRow{root;delegate;eventTracker=new EventTracker;boundary_;constructor(root,boundary,delegate){this.root=root;this.boundary_=boundary||document.documentElement;this.delegate=delegate}static isFocusable(element){if(!element||element.disabled){return false}let current=element;while(true){assertInstanceof(current,Element);const style=window.getComputedStyle(current);if(style.visibility==="hidden"||style.display==="none"){return false}const parent=current.parentNode;if(!parent){return false}if(parent===current.ownerDocument||parent instanceof DocumentFragment){return true}current=parent}}static getFocusableElement(element){const withFocusable=element;if(withFocusable.getFocusableElement){return withFocusable.getFocusableElement()}return element}addItem(type,selectorOrElement){assert(type);let element;if(typeof selectorOrElement==="string"){element=this.root.querySelector(selectorOrElement)}else{element=selectorOrElement}if(!element){return false}element.setAttribute("focus-type",type);element.tabIndex=this.isActive()?0:-1;this.eventTracker.add(element,"blur",this.onBlur_.bind(this));this.eventTracker.add(element,"focus",this.onFocus_.bind(this));this.eventTracker.add(element,"keydown",this.onKeydown_.bind(this));this.eventTracker.add(element,"mousedown",this.onMousedown_.bind(this));return true}destroy(){this.eventTracker.removeAll()}getCustomEquivalent(_sampleElement){const focusable=this.getFirstFocusable();assert(focusable);return focusable}getElements(){return Array.from(this.root.querySelectorAll("[focus-type]")).map(FocusRow.getFocusableElement)}getEquivalentElement(sampleElement){if(this.getFocusableElements().indexOf(sampleElement)>=0){return sampleElement}const sampleFocusType=this.getTypeForElement(sampleElement);if(sampleFocusType){const sameType=this.getFirstFocusable(sampleFocusType);if(sameType){return sameType}}return this.getCustomEquivalent(sampleElement)}getFirstFocusable(type){const element=this.getFocusableElements().find((el=>!type||el.getAttribute("focus-type")===type));return element||null}getFocusableElements(){return this.getElements().filter(FocusRow.isFocusable)}getTypeForElement(element){return element.getAttribute("focus-type")||""}isActive(){return this.root.classList.contains(ACTIVE_CLASS)}makeActive(active){if(active===this.isActive()){return}this.getElements().forEach((function(element){element.tabIndex=active?0:-1}));this.root.classList.toggle(ACTIVE_CLASS,active)}onBlur_(e){if(!this.boundary_.contains(e.relatedTarget)){return}const currentTarget=e.currentTarget;if(this.getFocusableElements().indexOf(currentTarget)>=0){this.makeActive(false)}}onFocus_(e){if(this.delegate){this.delegate.onFocus(this,e)}}onMousedown_(e){if(e.button){return}const target=e.currentTarget;if(!target.disabled){target.tabIndex=0}}onKeydown_(e){const elements=this.getFocusableElements();const currentElement=FocusRow.getFocusableElement(e.currentTarget);const elementIndex=elements.indexOf(currentElement);assert(elementIndex>=0);if(this.delegate&&this.delegate.onKeydown(this,e)){return}const isShiftTab=!e.altKey&&!e.ctrlKey&&!e.metaKey&&e.shiftKey&&e.key==="Tab";if(hasKeyModifiers(e)&&!isShiftTab){return}let index=-1;let shouldStopPropagation=true;if(isShiftTab){index=elementIndex-1;if(index<0){return}}else if(e.key==="ArrowLeft"){index=elementIndex+(isRTL()?1:-1)}else if(e.key==="ArrowRight"){index=elementIndex+(isRTL()?-1:1)}else if(e.key==="Home"){index=0}else if(e.key==="End"){index=elements.length-1}else{shouldStopPropagation=false}const elementToFocus=elements[index];if(elementToFocus){this.getEquivalentElement(elementToFocus).focus();e.preventDefault()}if(shouldStopPropagation){e.stopPropagation()}}}let hideInk=false;assert(!isIOS,"pointerdown doesn't work on iOS");document.addEventListener("pointerdown",(function(){hideInk=true}),true);document.addEventListener("keydown",(function(){hideInk=false}),true);function focusWithoutInk(toFocus){if(!("noink"in toFocus)||!hideInk){toFocus.focus();return}const toFocusWithNoInk=toFocus;assert(document===toFocusWithNoInk.ownerDocument);const{noink:noink}=toFocusWithNoInk;toFocusWithNoInk.noink=true;toFocusWithNoInk.focus();toFocusWithNoInk.noink=noink}let instance$n=null;function getCss$g(){return instance$n||(instance$n=[...[],css`:host{--cr-hairline:1px solid var(--color-menu-separator,
      var(--cr-fallback-color-divider));--cr-action-menu-disabled-item-color:var(--color-menu-item-foreground-disabled,
          var(--cr-fallback-color-disabled-foreground));--cr-action-menu-disabled-item-opacity:1;--cr-menu-background-color:var(--color-menu-background,
      var(--cr-fallback-color-surface));--cr-menu-background-focus-color:var(--cr-hover-background-color);--cr-menu-shadow:var(--cr-elevation-2);--cr-primary-text-color:var(--color-menu-item-foreground,
      var(--cr-fallback-color-on-surface))}:host dialog{background-color:var(--cr-menu-background-color);border:none;border-radius:var(--cr-menu-border-radius,4px);box-shadow:var(--cr-menu-shadow);margin:0;min-width:128px;outline:0;padding:0;position:absolute}@media (forced-colors:active){:host dialog{border:var(--cr-border-hcm)}}:host dialog::backdrop{background-color:transparent}:host ::slotted(.dropdown-item){-webkit-tap-highlight-color:transparent;background:0 0;border:none;border-radius:0;box-sizing:border-box;color:var(--cr-primary-text-color);font:inherit;min-height:32px;padding:8px 24px;text-align:start;user-select:none;width:100%}:host ::slotted(.dropdown-item:not([hidden])){align-items:center;display:flex}:host ::slotted(.dropdown-item[disabled]){color:var(--cr-action-menu-disabled-item-color,var(--cr-primary-text-color));opacity:var(--cr-action-menu-disabled-item-opacity,.65)}:host ::slotted(.dropdown-item:not([disabled])){cursor:pointer}:host ::slotted(.dropdown-item:focus){background-color:var(--cr-menu-background-focus-color);outline:0}@media (forced-colors:active){:host ::slotted(.dropdown-item:focus){outline:var(--cr-focus-outline-hcm)}}.item-wrapper{outline:0;padding:var(--cr-action-menu-padding,8px 0)}`])}function getHtml$f(){return html`
<dialog id="dialog" part="dialog" @close="${this.onNativeDialogClose_}"
    role="application"
    aria-roledescription="${this.roleDescription||nothing}">
  <div id="wrapper" class="item-wrapper" role="menu" tabindex="-1"
      aria-label="${this.accessibilityLabel||nothing}">
    <slot id="contentNode" @slotchange="${this.onSlotchange_}"></slot>
  </div>
</dialog>`}var AnchorAlignment;(function(AnchorAlignment){AnchorAlignment[AnchorAlignment["BEFORE_START"]=-2]="BEFORE_START";AnchorAlignment[AnchorAlignment["AFTER_START"]=-1]="AFTER_START";AnchorAlignment[AnchorAlignment["CENTER"]=0]="CENTER";AnchorAlignment[AnchorAlignment["BEFORE_END"]=1]="BEFORE_END";AnchorAlignment[AnchorAlignment["AFTER_END"]=2]="AFTER_END"})(AnchorAlignment||(AnchorAlignment={}));const DROPDOWN_ITEM_CLASS="dropdown-item";const SELECTABLE_DROPDOWN_ITEM_QUERY=`.${DROPDOWN_ITEM_CLASS}:not([hidden]):not([disabled])`;const AFTER_END_OFFSET=10;function getStartPointWithAnchor(start,end,menuLength,anchorAlignment,min,max){let startPoint=0;switch(anchorAlignment){case AnchorAlignment.BEFORE_START:startPoint=start-menuLength;break;case AnchorAlignment.AFTER_START:startPoint=start;break;case AnchorAlignment.CENTER:startPoint=(start+end-menuLength)/2;break;case AnchorAlignment.BEFORE_END:startPoint=end-menuLength;break;case AnchorAlignment.AFTER_END:startPoint=end;break}if(startPoint+menuLength>max){startPoint=end-menuLength}if(startPoint<min){startPoint=start}startPoint=Math.max(min,Math.min(startPoint,max-menuLength));return startPoint}function getDefaultShowConfig(){return{top:0,left:0,height:0,width:0,anchorAlignmentX:AnchorAlignment.AFTER_START,anchorAlignmentY:AnchorAlignment.AFTER_START,minX:0,minY:0,maxX:0,maxY:0}}class CrActionMenuElement extends CrLitElement{constructor(){super(...arguments);this.autoReposition=false;this.open=false;this.boundClose_=null;this.resizeObserver_=null;this.hasMousemoveListener_=false;this.anchorElement_=null;this.lastConfig_=null}static get is(){return"cr-action-menu"}static get styles(){return getCss$g()}render(){return getHtml$f.bind(this)()}static get properties(){return{accessibilityLabel:{type:String},autoReposition:{type:Boolean},open:{type:Boolean,notify:true},roleDescription:{type:String}}}firstUpdated(){this.addEventListener("keydown",this.onKeyDown_.bind(this));this.addEventListener("mouseover",this.onMouseover_);this.addEventListener("click",this.onClick_)}disconnectedCallback(){super.disconnectedCallback();this.removeListeners_()}getDialog(){return this.$.dialog}removeListeners_(){window.removeEventListener("resize",this.boundClose_);window.removeEventListener("popstate",this.boundClose_);if(this.resizeObserver_){this.resizeObserver_.disconnect();this.resizeObserver_=null}}onNativeDialogClose_(e){if(e.target!==this.$.dialog){return}this.fire("close")}onClick_(e){if(e.target===this){this.close();e.stopPropagation()}}onKeyDown_(e){e.stopPropagation();if(e.key==="Tab"||e.key==="Escape"){this.close();if(e.key==="Tab"){this.fire("tabkeyclose",{shiftKey:e.shiftKey})}e.preventDefault();return}if(e.key!=="Enter"&&e.key!=="ArrowUp"&&e.key!=="ArrowDown"){return}const options=Array.from(this.querySelectorAll(SELECTABLE_DROPDOWN_ITEM_QUERY));if(options.length===0){return}const focused=getDeepActiveElement();const index=options.findIndex((option=>FocusRow.getFocusableElement(option)===focused));if(e.key==="Enter"){if(index!==-1){return}if(isWindows||isMac){this.close();e.preventDefault();return}}e.preventDefault();this.updateFocus_(options,index,e.key!=="ArrowUp");if(!this.hasMousemoveListener_){this.hasMousemoveListener_=true;this.addEventListener("mousemove",(e=>{this.onMouseover_(e);this.hasMousemoveListener_=false}),{once:true})}}onMouseover_(e){const item=e.composedPath().find((el=>el.matches&&el.matches(SELECTABLE_DROPDOWN_ITEM_QUERY)));(item||this.$.wrapper).focus()}updateFocus_(options,focusedIndex,next){const numOptions=options.length;assert(numOptions>0);let index;if(focusedIndex===-1){index=next?0:numOptions-1}else{const delta=next?1:-1;index=(numOptions+focusedIndex+delta)%numOptions}options[index].focus()}close(){if(!this.open){return}this.removeListeners_();this.$.dialog.close();this.open=false;if(this.anchorElement_){assert(this.anchorElement_);focusWithoutInk(this.anchorElement_);this.anchorElement_=null}if(this.lastConfig_){this.lastConfig_=null}}showAt(anchorElement,config){this.anchorElement_=anchorElement;this.anchorElement_.scrollIntoViewIfNeeded();const rect=this.anchorElement_.getBoundingClientRect();let height=rect.height;if(config&&!config.noOffset&&config.anchorAlignmentY===AnchorAlignment.AFTER_END){height-=AFTER_END_OFFSET}this.showAtPosition(Object.assign({top:rect.top,left:rect.left,height:height,width:rect.width,anchorAlignmentX:AnchorAlignment.BEFORE_END},config));this.$.wrapper.focus()}showAtPosition(config){const doc=document.scrollingElement;const scrollLeft=doc.scrollLeft;const scrollTop=doc.scrollTop;this.resetStyle_();this.$.dialog.showModal();this.open=true;config.top+=scrollTop;config.left+=scrollLeft;this.positionDialog_(Object.assign({minX:scrollLeft,minY:scrollTop,maxX:scrollLeft+doc.clientWidth,maxY:scrollTop+doc.clientHeight},config));doc.scrollTop=scrollTop;doc.scrollLeft=scrollLeft;this.addListeners_();const openedByKey=FocusOutlineManager.forDocument(document).visible;if(openedByKey){const firstSelectableItem=this.querySelector(SELECTABLE_DROPDOWN_ITEM_QUERY);if(firstSelectableItem){requestAnimationFrame((()=>{firstSelectableItem.focus()}))}}}resetStyle_(){this.$.dialog.style.left="";this.$.dialog.style.right="";this.$.dialog.style.top="0"}positionDialog_(config){this.lastConfig_=config;const c=Object.assign(getDefaultShowConfig(),config);const top=c.top;const left=c.left;const bottom=top+c.height;const right=left+c.width;const rtl=getComputedStyle(this).direction==="rtl";if(rtl){c.anchorAlignmentX*=-1}const offsetWidth=this.$.dialog.offsetWidth;const menuLeft=getStartPointWithAnchor(left,right,offsetWidth,c.anchorAlignmentX,c.minX,c.maxX);if(rtl){const menuRight=document.scrollingElement.clientWidth-menuLeft-offsetWidth;this.$.dialog.style.right=menuRight+"px"}else{this.$.dialog.style.left=menuLeft+"px"}const menuTop=getStartPointWithAnchor(top,bottom,this.$.dialog.offsetHeight,c.anchorAlignmentY,c.minY,c.maxY);this.$.dialog.style.top=menuTop+"px"}onSlotchange_(){for(const node of this.$.contentNode.assignedElements({flatten:true})){if(node.classList.contains(DROPDOWN_ITEM_CLASS)&&!node.getAttribute("role")){node.setAttribute("role","menuitem")}}}addListeners_(){this.boundClose_=this.boundClose_||(()=>{if(this.$.dialog.open){this.close()}});window.addEventListener("resize",this.boundClose_);window.addEventListener("popstate",this.boundClose_);if(this.autoReposition){this.resizeObserver_=new ResizeObserver((()=>{if(this.lastConfig_){this.positionDialog_(this.lastConfig_);this.fire("cr-action-menu-repositioned")}}));this.resizeObserver_.observe(this.$.dialog)}}}customElements.define(CrActionMenuElement.is,CrActionMenuElement);function getTemplate$4(){return html$1`<!--_html_template_start_--><style include="cr-icons">:host{display:flex;flex-direction:column;margin:16px}#titleContainer{align-items:center;display:flex;height:22px}.icon-background{align-items:center;border-radius:50%;display:flex;height:18px;justify-content:center;margin-inline-end:8px;width:18px}.module-icon{-webkit-mask-size:20px 20px;background-color:var(--color-new-tab-page-primary-foreground);height:var(--cr-icon-size);width:var(--cr-icon-size)}#title{color:var(--color-new-tab-page-primary-foreground);font-size:15px;font-weight:400}#chip{background-color:var(--color-new-tab-page-chip-background);border-radius:4px;color:var(--color-new-tab-page-chip-foreground);font-size:10px;height:12px;margin-inline-start:10px;padding:2px 6px}#headerSpacer{flex-grow:1}cr-action-menu{--cr-menu-shadow:var(--ntp-menu-shadow)}cr-icon-button{--cr-icon-button-icon-size:16px;--cr-icon-button-fill-color:var(--color-new-tab-page-primary-foreground);--cr-icon-button-hover-background-color:var(--color-new-tab-page-control-background-hovered);margin-inline-end:-4px;margin-inline-start:0}#infoButton{--cr-icon-image:url(icons/info.svg)}#menuButton{margin-inline-end:-10px}:host([modules-redesigned-enabled_]) #menuButton{background-color:var(--color-new-tab-page-module-scroll-button);height:18px;margin:0;width:18px}:host([modules-redesigned-enabled_]) #menuButton:hover{background-color:var(--color-new-tab-page-module-scroll-button-hover)}#description{color:var(--color-new-tab-page-secondary-foreground);font-size:12px;height:12px;margin-top:3px}</style>
<div id="titleContainer">
  <template is="dom-if" if="[[showIcon_]]">
    <div class="icon-background">
      <div class="module-icon" style$="[[iconStyle_]]">
      </div>
    </div>
  </template>
  <h2 id="title"><slot></slot></h2>
  <template is="dom-if" if="[[chipText]]">
    <div id="chip">[[chipText]]</div>
  </template>
  <div id="headerSpacer"></div>
  <slot name="title-actions"></slot>
  <template is="dom-if" if="[[showInfoButton]]">
    <cr-icon-button id="infoButton" title="РћР± СЌС‚РѕР№ РєР°СЂС‚РѕС‡РєРµ" on-click="onInfoButtonClick_">
    </cr-icon-button>
  </template>
  <template is="dom-if" if="[[!hideMenuButton]]" restamp>
    <cr-icon-button id="menuButton" title="[[moreActionsText]]" class="icon-more-vert" on-click="onMenuButtonClick_">
    </cr-icon-button>
  </template>
</div>
<template is="dom-if" if="[[descriptionText]]">
  <span id="description">[[descriptionText]]</span>
</template>
<cr-action-menu id="actionMenu">
  <slot name="action-menu-items"></slot>
  <template is="dom-if" if="[[showDismissButton]]">
    <button id="dismissButton" class="dropdown-item" on-click="onDismissButtonClick_">
      [[dismissText]]
    </button>
  </template>
  <button id="disableButton" class="dropdown-item" on-click="onDisableButtonClick_">
    [[disableText]]
  </button>
  <button id="customizeButton" class="dropdown-item" on-click="onCustomizeButtonClick_">
    РќР°СЃС‚СЂРѕРёС‚СЊ РєР°СЂС‚РѕС‡РєРё
  </button>
  <template is="dom-if" if="[[showInfoButtonDropdown]]">
    <button id="infoButton" class="dropdown-item" on-click="onInfoButtonClick_">
      РћР± СЌС‚РѕР№ РєР°СЂС‚РѕС‡РєРµ
    </button>
  </template>
</cr-action-menu>
<!--_html_template_end_-->`}let ModuleHeaderElement$1=class ModuleHeaderElement extends PolymerElement{static get is(){return"ntp-module-header"}static get template(){return getTemplate$4()}static get properties(){return{iconSrc:String,chipText:String,descriptionText:String,showInfoButton:{type:Boolean,value:false},showInfoButtonDropdown:{type:Boolean,value:false},showDismissButton:{type:Boolean,value:false},hideMenuButton:{type:Boolean,value:false},dismissText:String,disableText:String,moreActionsText:String,modulesRedesignedEnabled_:{type:Boolean,value:()=>loadTimeData.getBoolean("modulesRedesignedEnabled"),reflectToAttribute:true},showIcon_:{type:Boolean,value:()=>loadTimeData.getBoolean("modulesHeaderIconEnabled")},iconStyle_:{type:String,computed:`computeIconStyle_(iconSrc)`}}}computeIconStyle_(){return`-webkit-mask-image: url(${this.iconSrc});`}onInfoButtonClick_(){this.$.actionMenu.close();this.dispatchEvent(new Event("info-button-click",{bubbles:true,composed:true}))}onMenuButtonClick_(e){this.$.actionMenu.showAt(e.target)}onDismissButtonClick_(){this.$.actionMenu.close();this.dispatchEvent(new Event("dismiss-button-click",{bubbles:true}))}onDisableButtonClick_(){this.$.actionMenu.close();this.dispatchEvent(new Event("disable-button-click",{bubbles:true}))}onCustomizeButtonClick_(){this.$.actionMenu.close();this.dispatchEvent(new Event("customize-module",{bubbles:true,composed:true}))}};customElements.define(ModuleHeaderElement$1.is,ModuleHeaderElement$1);class CrLazyRenderElement extends PolymerElement{constructor(){super(...arguments);this.child_=null;this.instance_=null}static get is(){return"cr-lazy-render"}static get template(){return html$1`<slot></slot>`}get(){if(!this.child_){this.render_()}assert(this.child_);return this.child_}getIfExists(){return this.child_}render_(){const template=this.shadowRoot.querySelector("slot").assignedNodes({flatten:true}).filter((n=>n.nodeType===Node.ELEMENT_NODE))[0];const TemplateClass=templatize(template,this,{mutableData:false,forwardHostProp:this._forwardHostPropV2});const parentNode=this.parentNode;if(parentNode&&!this.child_){this.instance_=new TemplateClass;this.child_=this.instance_.root.firstElementChild;parentNode.insertBefore(this.instance_.root,this)}}_forwardHostPropV2(prop,value){if(this.instance_){this.instance_.forwardHostProp(prop,value)}}}customElements.define(CrLazyRenderElement.is,CrLazyRenderElement);class ModuleDescriptor{constructor(id,initializeCallback){this.id_=id;this.initializeCallback_=initializeCallback}get id(){return this.id_}async initialize(timeout){const loadStartTime=WindowProxy.getInstance().now();const element=await Promise.race([this.initializeCallback_(),new Promise((resolve=>{WindowProxy.getInstance().setTimeout((()=>{resolve(null)}),timeout)}))]);if(!element){return null}const loadEndTime=WindowProxy.getInstance().now();const duration=loadEndTime-loadStartTime;recordLoadDuration("NewTabPage.Modules.Loaded",loadEndTime);recordLoadDuration(`NewTabPage.Modules.Loaded.${this.id_}`,loadEndTime);recordDuration("NewTabPage.Modules.LoadDuration",duration);recordDuration(`NewTabPage.Modules.LoadDuration.${this.id_}`,duration);return element}}let handler=null;class FileProxy{static getHandler(){return handler||(handler=FileSuggestionHandler.getRemote())}static setHandler(newHandler){handler=newHandler}constructor(){}}function getTemplate$3(){return html$1`<!--_html_template_start_--><style>:host{display:block;height:100%;width:100%}ntp-module-header{margin-bottom:8px}#files{display:flex;flex-direction:column;margin-bottom:7px}.file{box-sizing:border-box;color:var(--color-new-tab-page-primary-foreground);display:flex;flex-shrink:0;height:56px;outline:0;padding:8px 18px;text-decoration:none}.file:hover{background-color:var(--color-new-tab-page-control-background-hovered)}.file:active,:host-context(.focus-outline-visible) .file:focus{background-color:var(--color-new-tab-page-active-background)}.file-icon{height:19px;margin-inline-end:19px;margin-top:3px;object-fit:contain;width:19px}.file-info{display:flex;flex-direction:column;flex-grow:1;min-width:0}.file-description,.file-title{line-height:20px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-title{font-size:var(--ntp-module-text-size)}.file-description{color:var(--color-new-tab-page-secondary-foreground);font-size:var(--ntp-module-secondary-text-size)}</style>
<ntp-module-header dismiss-text="[[i18n('modulesDriveDismissButtonText')]]" disable-text="[[i18n('modulesDriveDisableButtonText')]]" more-actions-text="[[i18n('modulesDriveMoreActionsButtonText')]]" show-info-button on-info-button-click="onInfoButtonClick_" show-dismiss-button on-dismiss-button-click="onDismissButtonClick_" on-disable-button-click="onDisableButtonClick_" icon-src="icons/drive_logo.svg">
  РЎ Google Р”РёСЃРєР°
</ntp-module-header>
<div id="files">
  <template id="fileRepeat" is="dom-repeat" items="[[files]]">
    <a class="file" href="[[item.itemUrl.url]]" on-click="onFileClick_" on-auxclick="onFileClick_">
      <img is="cr-auto-img" class="file-icon" draggable="false" auto-src="[[getImageSrc_(item)]]">
      
      <div class="file-info">
        <div class="file-title">[[item.title]]</div>
        <div class="file-description">[[item.justificationText]]</div>
      </div>
    </a>
  </template>
</div>
<cr-lazy-render id="infoDialogRender">
  <template>
    <ntp-info-dialog inner-h-t-m-l="[[i18nAdvanced('modulesDriveInfo')]]">
    </ntp-info-dialog>
  </template>
</cr-lazy-render>
<!--_html_template_end_-->`}let DriveModuleElement$1=class DriveModuleElement extends(I18nMixin(PolymerElement)){static get is(){return"ntp-drive-module"}static get template(){return getTemplate$3()}static get properties(){return{files:Array}}onInfoButtonClick_(){this.$.infoDialogRender.get().showModal()}onDismissButtonClick_(){FileProxy.getHandler().dismissModule();this.dispatchEvent(new CustomEvent("dismiss-module",{bubbles:true,composed:true,detail:{message:loadTimeData.getStringF("dismissModuleToastMessage",loadTimeData.getString("modulesDriveFilesSentence")),restoreCallback:()=>FileProxy.getHandler().restoreModule()}}))}onDisableButtonClick_(){this.dispatchEvent(new CustomEvent("disable-module",{bubbles:true,composed:true,detail:{message:loadTimeData.getStringF("disableModuleToastMessage",loadTimeData.getString("modulesDriveSentence2"))}}))}getImageSrc_(file){return"https://drive-thirdparty.googleusercontent.com/32/type/"+file.mimeType}onFileClick_(e){this.dispatchEvent(new Event("usage",{bubbles:true,composed:true}));const index=e.model.index;chrome.metricsPrivate.recordSmallCount("NewTabPage.Drive.FileClick",index)}};customElements.define(DriveModuleElement$1.is,DriveModuleElement$1);async function createDriveElement$1(){const{files:files}=await FileProxy.getHandler().getFiles();if(files.length===0){return null}const element=new DriveModuleElement$1;element.files=files;return element}const driveDescriptor=new ModuleDescriptor("drive",createDriveElement$1);let instance$m=null;class ModuleRegistry{static getInstance(){return instance$m||(instance$m=new ModuleRegistry(descriptors))}static setInstance(newInstance){instance$m=newInstance}constructor(descriptors){this.descriptors_=descriptors}async initializeModules(timeout){const modulesIdNames=(await NewTabPageProxy.getInstance().handler.getModulesIdNames()).data;return this.initializeModulesHavingIds(modulesIdNames.map((m=>m.id)),timeout)}async initializeModulesHavingIds(modulesIds,timeout){const disabledIds=await new Promise(((resolve,_)=>{const callbackRouter=NewTabPageProxy.getInstance().callbackRouter;const listenerId=callbackRouter.setDisabledModules.addListener(((all,ids)=>{callbackRouter.removeListener(listenerId);resolve(all?this.descriptors_.map((({id:id})=>id)):ids)}));NewTabPageProxy.getInstance().handler.updateDisabledModules()}));const descriptorsMap=new Map(this.descriptors_.map((d=>[d.id,d])));const descriptors=modulesIds.filter((id=>!disabledIds.includes(id))).map((id=>descriptorsMap.get(id)));const orderedIds=(await NewTabPageProxy.getInstance().handler.getModulesOrder()).moduleIds;if(orderedIds.length>0){descriptors.sort(((a,b)=>{const aHasOrder=orderedIds.includes(a.id);const bHasOrder=orderedIds.includes(b.id);if(aHasOrder&&bHasOrder){return orderedIds.indexOf(a.id)-orderedIds.indexOf(b.id)}if(!aHasOrder&&bHasOrder){return 1}if(aHasOrder&&!bHasOrder){return-1}return 0}))}const elements=await Promise.all(descriptors.map((d=>d.initialize(timeout))));return elements.map(((e,i)=>({elements:e,descriptor:descriptors[i]}))).filter((m=>!!m.elements)).map((m=>({elements:Array.isArray(m.elements)?m.elements:[m.elements],descriptor:m.descriptor}))).filter((m=>m.elements.length!==0))}}let instance$l=null;function getCss$f(){return instance$l||(instance$l=[...[],css`:host{--cr-chip-border-radius:8px;--cr-chip-color:var(--color-chip-foreground,
      var(--cr-fallback-color-on-surface));--cr-chip-font-size:12px;--cr-chip-height:28px}button{--cr-icon-button-margin-start:0;--cr-icon-color:var(--color-chip-icon, var(--cr-fallback-color-primary));--cr-icon-ripple-margin:0;--cr-icon-ripple-size:16px;--cr-icon-size:contain;--iron-icon-fill-color:var(--color-chip-icon,
      var(--cr-fallback-color-primary));--iron-icon-height:16px;--iron-icon-width:16px;align-items:center;appearance:none;background-color:transparent;border:1px solid var(--color-chip-border,var(--cr-fallback-color-tonal-outline));border-radius:var(--cr-chip-border-radius);color:var(--cr-chip-color);cursor:pointer;font-family:inherit;display:flex;flex-direction:row;font-size:var(--cr-chip-font-size);font-weight:500;gap:4px;height:var(--cr-chip-height);overflow:hidden;padding:0 8px;position:relative;white-space:nowrap}button:not(:is([disabled],[selected])):hover{background-color:transparent;border-color:var(--color-chip-border,var(--cr-fallback-color-tonal-outline))}button:focus-visible{outline:solid 2px var(--cr-focus-outline-color);outline-offset:2px}button[disabled]{cursor:default;opacity:var(--cr-disabled-opacity)}button[selected]{--cr-icon-color:var(--color-chip-icon-selected,
      var(--cr-fallback-color-on-tonal-container));--iron-icon-fill-color:var(--color-chip-icon-selected,
      var(--cr-fallback-color-on-tonal-container));background-color:var(--color-chip-background-selected,var(--cr-fallback-color-tonal-container));border-color:var(--color-chip-background-selected,var(--cr-fallback-color-tonal-container));color:var(--color-chip-foreground-selected,var(--cr-fallback-color-on-tonal-container));padding:0 8px}#hoverLayer{display:none}button:hover #hoverLayer{background:var(--cr-hover-on-subtle-background-color);display:block;inset:0;pointer-events:none;position:absolute}#ink{--paper-ripple-opacity:1;color:var(--cr-active-neutral-on-subtle-background-color);display:block}`])}function getHtml$e(){return html`
<button id="button" ?selected="${this.selected}"
    ?disabled="${this.disabled}" aria-pressed="${this.selected}"
    role="${this.chipRole}" aria-label="${this.chipAriaLabel}">
  <div id="hoverLayer"></div>
  <slot></slot>
</button>`}const CrChipElementBase=CrRippleMixin(CrLitElement);class CrChipElement extends CrChipElementBase{static get is(){return"cr-chip"}static get styles(){return getCss$f()}render(){return getHtml$e.bind(this)()}static get properties(){return{disabled:{type:Boolean},chipAriaLabel:{type:String},chipRole:{type:String},selected:{type:Boolean}}}constructor(){super();this.disabled=false;this.chipAriaLabel="";this.chipRole="";this.selected=false;this.ensureRippleOnPointerdown()}createRipple(){this.rippleContainer=this.shadowRoot.querySelector("button");return super.createRipple()}}customElements.define(CrChipElement.is,CrChipElement);let instance$k=null;function getCss$e(){return instance$k||(instance$k=[...[getCss$k(),getCss$j()],css`:host([expanded]) #header{color:var(--color-new-tab-page-primary-foreground);font-weight:500;overflow:hidden}#header{box-sizing:border-box;column-gap:4px;color:var(--color-new-tab-page-secondary-foreground);display:flex;font-size:var(--ntp-module-text-size);line-height:var(--ntp-module-line-height);padding:4px 16px;position:relative;text-decoration:none;width:100%}#header #hoverContainer{background:var(--color-new-tab-page-module-item-background-hovered);display:none;height:100%;inset:0;position:absolute;width:100%}#header:hover #hoverContainer{display:block}#header:focus-visible,:host-context(.focus-outline-visible) #header:focus{box-shadow:var(--ntp-focus-shadow);outline:0}@media (forced-colors:active){#header:focus-visible,:host-context(.focus-outline-visible) #header:focus{outline:var(--cr-border-hcm)}}#startTime{display:inline-block;flex-shrink:0;position:relative;width:56px}#title{flex-grow:1;overflow:hidden;position:relative;text-overflow:ellipsis;white-space:nowrap}#timeStatus{background-color:var(--color-new-tab-page-module-calendar-event-time-status-background);border-radius:100px;color:var(--color-new-tab-page-secondary-foreground);display:inline-block;flex-basis:content;flex-shrink:0;font-size:var(--ntp-module-secondary-text-size);font-weight:400;line-height:var(--ntp-module-secondary-line-height);padding:2px 8px;position:relative}.cr-icon{--cr-icon-color:var(--color-new-tab-page-secondary-foreground);--cr-icon-size:18px;height:20px;margin:0;width:20px}#expandedInfo{padding:0 16px}#location{padding:4px 0}#attachmentList,#attachments,#location{column-gap:8px;display:flex;width:100%}#location-icon{--cr-icon-image:url(modules/v2/calendar/icons/location.svg)}#location p{color:var(--color-new-tab-page-secondary-foreground);font-size:12px;line-height:var(--ntp-module-secondary-line-height);margin:0;overflow:hidden;padding:2px 0;text-overflow:ellipsis;white-space:nowrap}#attachments{position:relative}#attachmentList.scrollable-right{mask-image:linear-gradient(to right,#000 calc(100% - 16px),transparent 100%)}#attachmentList.scrollable-left{mask-image:linear-gradient(to right,transparent 0,#000 16px)}#attachmentList.scrollable{mask-image:linear-gradient(to right,transparent 0,#000 16px,#000 calc(100% - 16px),transparent 100%)}#attachmentList{margin-inline-end:-4px;overflow-x:auto;overflow-y:hidden;padding:4px}#attachmentList::-webkit-scrollbar{background:0 0;height:8px}#attachmentList::-webkit-scrollbar-thumb{background:var(--color-new-tab-page-module-calendar-attachment-scrollbar-thumb);background-clip:content-box;border:solid 1.5px transparent;border-radius:100px}#attachment-icon{--cr-icon-image:url(modules/v2/calendar/icons/attachment.svg);margin:6px -4px 6px 0}#attachments cr-chip{--cr-chip-color:var(--color-new-tab-page-link);--cr-chip-border-radius:100px;--cr-chip-font-size:var(--ntp-module-secondary-text-size);--cr-chip-height:24px}#attachments img{height:14px;width:14px}.attachment-text{max-width:13ch;overflow:hidden;text-overflow:ellipsis}#conference{margin-bottom:4px;margin-top:8px}`])}function getHtml$d(){return html`<!--_html_template_start_--><a id="header" href="${this.event.url.url}" @click="${this.recordHeaderClick_}">
  <div id="hoverContainer"></div>
  <span id="startTime">${this.formattedStartTime_}</span>
  <span id="title">${this.event.title}</span>
  <span id="timeStatus" ?hidden="${!this.timeStatus_}">
    ${this.timeStatus_}
  </span>
</a>
${this.expanded?html`
  <div id="expandedInfo">
    <div id="location" ?hidden="${!this.showLocation_()}">
      <div id="location-icon" class="cr-icon"></div>
      <p>${this.event.location}</p>
    </div>
    <div id="attachments" ?hidden="${!this.showAttachments_()}">
      <div id="attachment-icon" class="cr-icon"></div>
      <div id="attachmentList" class="${this.attachmentListClass_}">
        ${this.event.attachments.map(((item,index)=>html`
          <cr-chip data-index="${index}" @click="${this.openAttachment_}" chip-role="link" class="attachment" title="${item.title}">
            <img is="cr-auto-img" auto-src="${item.iconUrl.url}" alt="">
            <div class="attachment-text">${item.title}</div>
          </cr-chip>
        `))}
      </div>
    </div>
    <div id="conference" ?hidden="${!this.showConferenceButton_()}">
      <cr-button role="link" @click="${this.openVideoConference_}" class="action-button">
        РџСЂРёСЃРѕРµРґРёРЅРёС‚СЊСЃСЏ Рє РІСЃС‚СЂРµС‡Рµ
      </cr-button>
    </div>
  </div>
`:""}
<!--_html_template_end_-->`}const kWindowsToUnixEpochOffset=11644473600000000n;var CalendarAction;(function(CalendarAction){CalendarAction[CalendarAction["EXPANDED_EVENT_HEADER_CLICKED"]=0]="EXPANDED_EVENT_HEADER_CLICKED";CalendarAction[CalendarAction["DOUBLE_BOOKED_EVENT_HEADER_CLICKED"]=1]="DOUBLE_BOOKED_EVENT_HEADER_CLICKED";CalendarAction[CalendarAction["BASIC_EVENT_HEADER_CLICKED"]=2]="BASIC_EVENT_HEADER_CLICKED";CalendarAction[CalendarAction["ATTACHMENT_CLICKED"]=3]="ATTACHMENT_CLICKED";CalendarAction[CalendarAction["CONFERENCE_CALL_CLICKED"]=4]="CONFERENCE_CALL_CLICKED";CalendarAction[CalendarAction["SEE_MORE_CLICKED"]=5]="SEE_MORE_CLICKED";CalendarAction[CalendarAction["MAX_VALUE"]=5]="MAX_VALUE"})(CalendarAction||(CalendarAction={}));function recordCalendarAction(action,moduleName){chrome.metricsPrivate.recordEnumerationValue(`NewTabPage.${moduleName}.UserAction`,action,CalendarAction.MAX_VALUE+1)}function toJsTimestamp(time){return Number((time.internalValue-kWindowsToUnixEpochOffset)/1000n)}const kAttachmentScrollFadeBuffer=4;const kMillisecondsInMinute=6e4;const kMinutesInHour=60;const CalendarEventElementBase=I18nMixinLit(CrLitElement);class CalendarEventElement extends CalendarEventElementBase{static get is(){return"ntp-calendar-event"}static get styles(){return getCss$e()}render(){return getHtml$d.bind(this)()}static get properties(){return{doubleBooked:{type:Boolean},event:{type:Object},expanded:{type:Boolean,reflect:true},index:{type:Number},moduleName:{type:String},attachmentListClass_:{type:String},formattedStartTime_:{type:String},timeStatus_:{type:String}}}updated(changedProperties){if((changedProperties.has("event")||changedProperties.has("expanded"))&&(this.expanded&&this.showAttachments_())){const attachmentList=this.renderRoot.querySelector("#attachmentList");if(attachmentList&&attachmentList.children.length>1){this.intersectionObserver_=new IntersectionObserver((()=>this.updateAttachmentListClass_()),{root:attachmentList,threshold:1});this.intersectionObserver_.observe(attachmentList.children[0]);this.intersectionObserver_.observe(attachmentList.children[attachmentList.children.length-1])}}}willUpdate(changedProperties){super.willUpdate(changedProperties);if(changedProperties.has("event")){this.formattedStartTime_=this.computeFormattedStartTime_()}if(changedProperties.has("event")||changedProperties.has("expanded")){this.timeStatus_=this.computeTimeStatus_()}}computeFormattedStartTime_(){const offsetDate=toJsTimestamp(this.event.startTime);const dateObj=new Date(offsetDate);let timeStr=Intl.DateTimeFormat(undefined,{timeStyle:"short"}).format(dateObj);timeStr=timeStr.replace(" AM","am").replace(" PM","pm");return timeStr}computeTimeStatus_(){if(!this.expanded){return""}const startTime=toJsTimestamp(this.event.startTime);const now=WindowProxy.getInstance().now().valueOf();const minutesUntilMeeting=Math.round((startTime-now)/kMillisecondsInMinute);if(minutesUntilMeeting<=0){return this.i18n("modulesCalendarInProgress")}if(minutesUntilMeeting<kMinutesInHour){return this.i18n("modulesCalendarInXMin",minutesUntilMeeting.toString())}const hoursUntilMeeting=minutesUntilMeeting/kMinutesInHour;return this.i18n("modulesCalendarInXHr",Math.round(hoursUntilMeeting).toString())}openAttachment_(e){this.dispatchEvent(new Event("usage",{composed:true,bubbles:true}));recordCalendarAction(CalendarAction.ATTACHMENT_CLICKED,this.moduleName);const currentTarget=e.currentTarget;const index=Number(currentTarget.dataset["index"]);WindowProxy.getInstance().navigate(this.event.attachments[index].resourceUrl.url)}openVideoConference_(){this.dispatchEvent(new Event("usage",{composed:true,bubbles:true}));recordCalendarAction(CalendarAction.CONFERENCE_CALL_CLICKED,this.moduleName);WindowProxy.getInstance().navigate(this.event.conferenceUrl.url)}recordHeaderClick_(){this.dispatchEvent(new Event("usage",{composed:true,bubbles:true}));let action=CalendarAction.BASIC_EVENT_HEADER_CLICKED;if(this.expanded){action=CalendarAction.EXPANDED_EVENT_HEADER_CLICKED}else if(this.doubleBooked){action=CalendarAction.DOUBLE_BOOKED_EVENT_HEADER_CLICKED}recordCalendarAction(action,this.moduleName);chrome.metricsPrivate.recordSmallCount(`NewTabPage.${this.moduleName}.EventClickIndex`,this.index)}showConferenceButton_(){return!!this.event.conferenceUrl?.url}showAttachments_(){return this.event.attachments.length>0}showLocation_(){return!!this.event.location}updateAttachmentListClass_(){const attachmentList=this.renderRoot.querySelector("#attachmentList");if(!attachmentList){this.attachmentListClass_="";return}const scrollableRight=attachmentList.scrollWidth-attachmentList.scrollLeft-kAttachmentScrollFadeBuffer>attachmentList.clientWidth;const scrollableLeft=attachmentList.scrollLeft-kAttachmentScrollFadeBuffer>0;if(scrollableRight&&scrollableLeft){this.attachmentListClass_="scrollable"}else if(scrollableRight){this.attachmentListClass_="scrollable-right"}else if(scrollableLeft){this.attachmentListClass_="scrollable-left"}else{this.attachmentListClass_=""}}}customElements.define(CalendarEventElement.is,CalendarEventElement);let instance$j=null;function getCss$d(){return instance$j||(instance$j=[...[],css`:host{--calendar-event-group-gutter-size:8px;display:block;padding:0 8px}.divider,.row{background-color:var(--color-new-tab-page-module-item-background);box-sizing:border-box;display:block;width:100%}.row:first-child,.row[double-booked]+.row:not([double-booked]),.row[expanded],.row[expanded]+.row:not([double-booked]){border-top-left-radius:12px;border-top-right-radius:12px;margin-top:8px;padding-top:var(--calendar-event-group-gutter-size)}.row:has(+.row[expanded]),.row:last-child,.row[double-booked]:has(+.row:not([double-booked])),.row[expanded]:has(+.row){border-bottom-left-radius:12px;border-bottom-right-radius:12px;margin-bottom:8px;padding-bottom:var(--calendar-event-group-gutter-size)}.row[expanded]{padding-bottom:var(--calendar-event-group-gutter-size)}.divider+.row[double-booked]{padding-top:var(--calendar-event-group-gutter-size)}.divider{padding:0 16px}hr{background:var(--color-side-panel-divider);border:none;height:1px;margin:0}#seeMore a{box-sizing:border-box;color:var(--color-new-tab-page-link);display:block;font-size:var(--ntp-module-text-size);font-weight:var(--ntp-module-see-more-font-weight);line-height:var(--ntp-module-line-height);overflow:hidden;padding:4px 16px;position:relative;text-decoration:none;width:100%}#seeMore #hoverContainer{background:var(--color-new-tab-page-module-item-background-hovered);display:none;height:100%;inset:0;position:absolute;width:100%}#seeMore:hover #hoverContainer{display:block}:host-context(.focus-outline-visible) a:focus,a:focus-visible{box-shadow:var(--ntp-focus-shadow);outline:0}@media (forced-colors:active){:host-context(.focus-outline-visible) a:focus,a:focus-visible{outline:var(--cr-border-hcm)}.row{border-color:var(--cr-border-hcm);border-style:none solid;border-width:2px}.row[double-booked]+.row,.row[expanded]+.row,ntp-calendar-event:first-of-type{border-style:solid solid none}.row:has(+.row[double-booked]),.row:has(+.row[expanded]),.row:last-child{border-style:none solid solid}.row[double-booked],.row[expanded]{border-style:solid}}`])}function getHtml$c(){return html`<!--_html_template_start_-->${this.events.map(((item,index)=>html`
  <ntp-calendar-event class="row" ?double-booked="${this.isDoubleBooked_(index)?"double-booked":""}" ?expanded="${this.isExpanded_(index)}" .event="${item}" .index="${index}" .moduleName="${this.moduleName}">
  </ntp-calendar-event>
  ${this.isExpanded_(index)&&this.hasDoubleBooked_()?html`
    <div class="divider"><hr></div>
  `:""}
`))}
<div id="seeMore" class="row">
  <a href="${this.calendarLink}" @click="${this.recordSeeMoreClick_}">
    Р•С‰С‘
    <div id="hoverContainer"></div>
  </a>
</div>
<!--_html_template_end_-->`}class CalendarElement extends CrLitElement{constructor(){super(...arguments);this.events=[];this.doubleBookedIndices_=[]}static get is(){return"ntp-calendar"}static get styles(){return getCss$d()}render(){return getHtml$c.bind(this)()}static get properties(){return{calendarLink:{type:String},events:{type:Object},moduleName:{type:String},doubleBookedIndices_:{type:Object},expandedEventIndex_:{type:Number}}}willUpdate(changedProperties){super.willUpdate(changedProperties);if(changedProperties.has("events")){chrome.metricsPrivate.recordSmallCount(`NewTabPage.${this.moduleName}.ShownEvents`,this.events.length);this.expandedEventIndex_=this.computeExpandedEventIndex_();if(this.expandedEventIndex_!==-1){this.sortEvents_();this.doubleBookedIndices_=this.computeDoubleBookedIndices_()}}}computeDoubleBookedIndices_(){const results=[];for(let i=this.expandedEventIndex_+1;i<this.events.length;i++){if(this.events[i].startTime.internalValue===this.events[this.expandedEventIndex_].startTime.internalValue){results.push(i)}else{break}}return results}compareEventPriority_(eventAIndex,eventBIndex,soon){const eventA=this.events[eventAIndex];const eventB=this.events[eventBIndex];const eventAStartTime=toJsTimestamp(eventA.startTime);const eventBStartTime=toJsTimestamp(eventB.startTime);const eventAInProgress=eventAStartTime<=soon;const eventBInProgress=eventBStartTime<=soon;if(eventAInProgress!==eventBInProgress){return+eventBInProgress-+eventAInProgress}const eventAEndsSoon=toJsTimestamp(eventA.endTime)<=soon;const eventBEndsSoon=toJsTimestamp(eventB.endTime)<=soon;if(eventAEndsSoon!==eventBEndsSoon){return+eventAEndsSoon-+eventBEndsSoon}if(!eventAInProgress&&!eventBInProgress&&eventAStartTime!==eventBStartTime){return eventAStartTime-eventBStartTime}if(eventA.isAccepted!==eventB.isAccepted){return+eventB.isAccepted-+eventA.isAccepted}if(eventA.hasOtherAttendee!==eventB.hasOtherAttendee){return+eventB.hasOtherAttendee-+eventA.hasOtherAttendee}return eventAIndex-eventBIndex}computeExpandedEventIndex_(){const now=WindowProxy.getInstance().now();let expandableEventIndices=this.events.map(((_,i)=>i));expandableEventIndices=expandableEventIndices.filter((eventIndex=>{const endTimeMs=toJsTimestamp(this.events[eventIndex].endTime);return endTimeMs>now}));if(expandableEventIndices.length===0){return-1}const in5Minutes=now+5*60*1e3;expandableEventIndices.sort(((a,b)=>this.compareEventPriority_(a,b,in5Minutes)));return expandableEventIndices[0]}hasDoubleBooked_(){return this.doubleBookedIndices_.length>0}isDoubleBooked_(index){return this.doubleBookedIndices_.includes(index)}isExpanded_(index){return index===this.expandedEventIndex_}recordSeeMoreClick_(){this.dispatchEvent(new Event("usage",{composed:true,bubbles:true}));recordCalendarAction(CalendarAction.SEE_MORE_CLICKED,this.moduleName)}sortEvents_(){const expandedEvent=this.events[this.expandedEventIndex_];const firstDoubleBookedEventIndex=this.events.findIndex((calendarEvent=>calendarEvent.startTime.internalValue===expandedEvent.startTime.internalValue));if(firstDoubleBookedEventIndex<this.expandedEventIndex_){this.events.splice(this.expandedEventIndex_,1);this.expandedEventIndex_=firstDoubleBookedEventIndex;this.events.splice(this.expandedEventIndex_,0,expandedEvent)}}}customElements.define(CalendarElement.is,CalendarElement);let instance$i=null;function getCss$c(){return instance$i||(instance$i=[...[],css`ntp-module-header-v2{background-color:var(--color-new-tab-page-module-background);margin:8px}@media (forced-colors:active){ntp-module-header-v2{border-radius:var(--ntp-module-item-border-radius);outline:var(--cr-border-hcm)}}`])}function getHtml$b(){return html`<!--_html_template_start_--><ntp-module-header-v2 id="moduleHeaderElementV2" header-text="Google РљР°Р»РµРЅРґР°СЂСЊ" .menuItemGroups="${this.getMenuItemGroups_()}" more-actions-text="Р”СЂСѓРіРёРµ РґРµР№СЃС‚РІРёСЏ РґР»СЏ Google РљР°Р»РµРЅРґР°СЂСЏ" @disable-button-click="${this.onDisableButtonClick_}" @dismiss-button-click="${this.onDismissButtonClick_}" @info-button-click="${this.onInfoButtonClick_}" @menu-button-click="${this.onMenuButtonClick_}">
</ntp-module-header-v2>
<ntp-calendar id="calendar" .events="${this.events_}" calendar-link="https://calendar.google.com" module-name="GoogleCalendar">
</ntp-calendar>
${this.showInfoDialog_?html`
  <ntp-info-dialog show-on-attach .innerHTML="${this.i18nAdvanced("moduleGoogleCalendarInfo")}" @close="${this.onInfoDialogClose_}">
  </ntp-info-dialog>
`:""}
<!--_html_template_end_-->`}class GoogleCalendarProxyImpl{constructor(handler){this.handler=handler}static getInstance(){return instance$h||(instance$h=new GoogleCalendarProxyImpl(GoogleCalendarPageHandler.getRemote()))}static setInstance(newInstance){instance$h=newInstance}}let instance$h=null;const GoogleCalendarModuleElementBase=I18nMixinLit(CrLitElement);class GoogleCalendarModuleElement extends GoogleCalendarModuleElementBase{static get is(){return"ntp-google-calendar-module"}static get styles(){return getCss$c()}render(){return getHtml$b.bind(this)()}static get properties(){return{events_:{type:Object},showInfoDialog_:{type:Boolean}}}constructor(events){super();this.handler_=GoogleCalendarProxyImpl.getInstance().handler;this.events_=events}getMenuItemGroups_(){return[[{action:"dismiss",icon:"modules:visibility_off",text:this.i18nRecursive("","modulesDismissForHoursButtonText","calendarModuleDismissHours")},{action:"disable",icon:"modules:block",text:this.i18n("modulesGoogleCalendarDisableButtonText")},{action:"info",icon:"modules:info",text:this.i18n("moduleInfoButtonTitle")}],[{action:"customize-module",icon:"modules:tune",text:this.i18n("modulesCustomizeButtonText")}]]}onDisableButtonClick_(){const disableEvent=new CustomEvent("disable-module",{composed:true,detail:{message:this.i18n("modulesGoogleCalendarDisableToastMessage")}});this.dispatchEvent(disableEvent)}onDismissButtonClick_(){this.handler_.dismissModule();this.dispatchEvent(new CustomEvent("dismiss-module-instance",{bubbles:true,composed:true,detail:{message:this.i18n("modulesGoogleCalendarDismissToastMessage"),restoreCallback:this.handler_.restoreModule}}))}onInfoButtonClick_(){this.showInfoDialog_=true}onInfoDialogClose_(){this.showInfoDialog_=false}onMenuButtonClick_(e){this.$.moduleHeaderElementV2.showAt(e)}}customElements.define(GoogleCalendarModuleElement.is,GoogleCalendarModuleElement);async function createGoogleCalendarElement(){const{events:events}=await GoogleCalendarProxyImpl.getInstance().handler.getEvents();return events.length>0?new GoogleCalendarModuleElement(events):null}const googleCalendarDescriptor=new ModuleDescriptor("google_calendar",createGoogleCalendarElement);function getHtml$a(){return html`<!--_html_template_start_--><ntp-module-header-v2 id="moduleHeaderElementV2" header-text="РљР°Р»РµРЅРґР°СЂСЊ Outlook" .menuItemGroups="${this.getMenuItemGroups_()}" more-actions-text="${this.i18nRecursive("","modulesMoreActions","modulesOutlookCalendarTitle")}" @disable-button-click="${this.onDisableButtonClick_}" @menu-button-click="${this.onMenuButtonClick_}">
</ntp-module-header-v2>
<ntp-calendar id="outlook-calendar" .events="${this.events_}" module-name="OutlookCalendar">
</ntp-calendar><!--_html_template_end_-->`}class OutlookCalendarProxyImpl{constructor(handler){this.handler=handler}static getInstance(){return instance$g||(instance$g=new OutlookCalendarProxyImpl(OutlookCalendarPageHandler.getRemote()))}static setInstance(newInstance){instance$g=newInstance}}let instance$g=null;const OutlookCalendarModuleElementBase=I18nMixinLit(CrLitElement);class OutlookCalendarModuleElement extends OutlookCalendarModuleElementBase{static get is(){return"ntp-outlook-calendar-module"}render(){return getHtml$a.bind(this)()}static get properties(){return{events_:{type:Object}}}constructor(events){super();this.handler_=OutlookCalendarProxyImpl.getInstance().handler;this.events_=events}getMenuItemGroups_(){return[[{action:"disable",icon:"modules:block",text:this.i18n("modulesOutlookCalendarDisableButtonText")}],[{action:"customize-module",icon:"modules:tune",text:this.i18n("modulesCustomizeButtonText")}]]}onDisableButtonClick_(){const disableEvent=new CustomEvent("disable-module",{composed:true,detail:{message:loadTimeData.getStringF("disableModuleToastMessage",loadTimeData.getString("modulesOutlookCalendarTitle"))}});this.dispatchEvent(disableEvent)}onMenuButtonClick_(e){this.$.moduleHeaderElementV2.showAt(e)}}customElements.define(OutlookCalendarModuleElement.is,OutlookCalendarModuleElement);async function createOutlookCalendarElement(){const{events:events}=await OutlookCalendarProxyImpl.getInstance().handler.getEvents();return events.length>0?new OutlookCalendarModuleElement(events):null}const outlookCalendarDescriptor=new ModuleDescriptor("outlook_calendar",createOutlookCalendarElement);let instance$f=null;function getCss$b(){return instance$f||(instance$f=[...[],css`cr-dialog::part(dialog){max-width:100%;position:fixed}cr-dialog [slot=body]{line-height:20px}`])}function getHtml$9(){return html`<!--_html_template_start_--><cr-dialog id="dialog" consume-keydown-event ?show-on-attach="${this.showOnAttach}">
  <div slot="title">РћР± СЌС‚РѕР№ РєР°СЂС‚РѕС‡РєРµ</div>
  <div slot="body">
    <slot></slot>
  </div>
  <div slot="button-container">
    <cr-button id="closeButton" class="action-button" @click="${this.onCloseClick_}">
      Р—Р°РєСЂС‹С‚СЊ
    </cr-button>
  </div>
</cr-dialog>
<!--_html_template_end_-->`}class InfoDialogElement extends CrLitElement{constructor(){super(...arguments);this.showOnAttach=false}static get is(){return"ntp-info-dialog"}static get styles(){return getCss$b()}render(){return getHtml$9.bind(this)()}static get properties(){return{showOnAttach:{type:Boolean}}}showModal(){this.$.dialog.showModal()}onCloseClick_(){this.$.dialog.close()}}customElements.define(InfoDialogElement.is,InfoDialogElement);let instance$e=null;function getCss$a(){return instance$e||(instance$e=[...[],css`:host{background-color:var(--color-new-tab-page-module-background);border-radius:var(--ntp-module-border-radius)}@media (forced-colors:active){a{border-radius:var(--ntp-module-item-border-radius);outline:var(--cr-border-hcm)}.file{overflow:visible}}:host-context(.focus-outline-visible) a:focus,a:focus-visible{box-shadow:var(--ntp-focus-shadow);outline:0}#files{background-color:var(--color-new-tab-page-module-item-background);border-radius:var(--ntp-module-item-border-radius);margin:8px}.file{align-items:center;display:flex;height:56px;position:relative;text-decoration:none;overflow:hidden}.file:hover #hover-layer{background:var(--color-new-tab-page-module-item-background-hovered);display:block;inset:0;pointer-events:none;position:absolute}#hover-layer{display:none}.file:first-of-type{border-radius:var(--ntp-module-item-border-radius) var(--ntp-module-item-border-radius) 0 0;padding-top:var(--ntp-module-first-element-top-padding)}.file:last-of-type{border-radius:0 0 var(--ntp-module-item-border-radius) var(--ntp-module-item-border-radius);padding-bottom:var(--ntp-module-first-element-top-padding)}.icon-container{align-items:center;background-color:var(--color-new-tab-page-module-icon-background);border-radius:8px;display:flex;flex-shrink:0;height:var(--ntp-module-icon-size);justify-content:center;margin-inline:8px;position:relative;width:var(--ntp-module-icon-size)}.file-icon{height:24px;width:24px}.file-info{min-width:0;padding-inline-end:16px}.file-description,.file-title{overflow:hidden;position:relative;text-overflow:ellipsis;white-space:nowrap}.file-title{color:var(--color-new-tab-page-primary-foreground);font-size:var(--ntp-module-text-size);line-height:var(--ntp-module-line-height)}.file-description{color:var(--color-new-tab-page-secondary-foreground);font-size:var(--ntp-module-secondary-text-size);line-height:var(--ntp-module-secondary-line-height)}`])}function getHtml$8(){return html`<!--_html_template_start_--><div id="files">
  ${this.files.map(((item,index)=>html`
    <a class="file" href="${item.itemUrl.url}" data-index="${index}" @click="${this.onFileClick_}">
      <div id="hover-layer"></div>
      <icon-container class="icon-container">
        <img is="cr-auto-img" class="file-icon" draggable="false" .autoSrc="${this.getImageSrc_(item)}">
      </icon-container>
      <div class="file-info">
        <div class="file-title">${item.title}</div>
        <div class="file-description">${item.justificationText}</div>
      </div>
    </a>
  `))}
</div>
<!--_html_template_end_-->`}class FileSuggestionElement extends CrLitElement{constructor(){super(...arguments);this.files=[]}static get is(){return"ntp-file-suggestion"}static get styles(){return getCss$a()}render(){return getHtml$8.bind(this)()}static get properties(){return{files:{type:Array},imageSourceBaseUrl:{type:String},moduleName:{type:String}}}getImageSrc_(file){return this.imageSourceBaseUrl+file.mimeType}onFileClick_(e){const clickFileEvent=new Event("usage",{composed:true,bubbles:true});this.dispatchEvent(clickFileEvent);const currentTarget=e.currentTarget;const index=Number(currentTarget.dataset["index"]);chrome.metricsPrivate.recordSmallCount(`NewTabPage.${this.moduleName}.FileClick`,index)}}customElements.define(FileSuggestionElement.is,FileSuggestionElement);let instance$d=null;function getCss$9(){return instance$d||(instance$d=[...[],css`@media (forced-colors:active){ntp-module-header-v2{border-radius:var(--ntp-module-item-border-radius);outline:var(--cr-border-hcm)}}ntp-module-header-v2{background-color:var(--color-new-tab-page-module-background);margin:8px}`])}function getHtml$7(){return html`<!--_html_template_start_--><ntp-module-header-v2 id="moduleHeaderElementV2" header-text="РЎ РІР°С€РµРіРѕ Р”РёСЃРєР°" .menuItemGroups="${this.getMenuItemGroups_()}" more-actions-text="${this.i18nRecursive("","modulesMoreActions","modulesDriveSentence")}" @disable-button-click="${this.onDisableButtonClick_}" @dismiss-button-click="${this.onDismissButtonClick_}" @info-button-click="${this.onInfoButtonClick_}" @menu-button-click="${this.onMenuButtonClick_}">
</ntp-module-header-v2>
<ntp-file-suggestion id="fileSuggestion" module-name="Drive" .files="${this.files}" .imageSourceBaseUrl="${this.imageSourceBaseUrl_}">
  </ntp-file-suggestion>
${this.showInfoDialog_?html`
  <ntp-info-dialog show-on-attach .innerHTML="${this.i18nAdvanced("modulesDriveInfo")}" @close="${this.onInfoDialogClose_}">
  </ntp-info-dialog>
`:""}
<!--_html_template_end_-->`}const DRIVE_ICON_BASE_URL="https://drive-thirdparty.googleusercontent.com/32/type/";const DriveModuleElementBase=I18nMixinLit(CrLitElement);class DriveModuleElement extends DriveModuleElementBase{constructor(){super(...arguments);this.files=[];this.imageSourceBaseUrl_=DRIVE_ICON_BASE_URL;this.showInfoDialog_=false}static get is(){return"ntp-drive-module-redesigned"}static get styles(){return getCss$9()}render(){return getHtml$7.bind(this)()}static get properties(){return{files:{type:Array},imageSourceBaseUrl_:{type:String},showInfoDialog_:{type:Boolean}}}getMenuItemGroups_(){return[[{action:"dismiss",icon:"modules:visibility_off",text:this.i18n("modulesDriveDismissButtonText")},{action:"disable",icon:"modules:block",text:this.i18n("modulesDriveDisableButtonTextV2")},{action:"info",icon:"modules:info",text:this.i18n("moduleInfoButtonTitle")}],[{action:"customize-module",icon:"modules:tune",text:this.i18n("modulesCustomizeButtonText")}]]}onDisableButtonClick_(){const disableEvent=new CustomEvent("disable-module",{composed:true,detail:{message:loadTimeData.getStringF("disableModuleToastMessage",loadTimeData.getString("modulesDriveSentence2"))}});this.dispatchEvent(disableEvent)}onDismissButtonClick_(){FileProxy.getHandler().dismissModule();this.dispatchEvent(new CustomEvent("dismiss-module-instance",{bubbles:true,composed:true,detail:{message:loadTimeData.getStringF("dismissModuleToastMessage",loadTimeData.getString("modulesDriveFilesSentence")),restoreCallback:()=>FileProxy.getHandler().restoreModule()}}))}onInfoButtonClick_(){this.showInfoDialog_=true}onInfoDialogClose_(){this.showInfoDialog_=false}onMenuButtonClick_(e){this.$.moduleHeaderElementV2.showAt(e)}}customElements.define(DriveModuleElement.is,DriveModuleElement);async function createDriveElement(){const{files:files}=await FileProxy.getHandler().getFiles();if(files.length===0){return null}const element=new DriveModuleElement;element.files=files;return element}const driveModuleV2Descriptor=new ModuleDescriptor("drive",createDriveElement);let instance$c=null;function getCss$8(){return instance$c||(instance$c=[...[],css`@media (forced-colors:active){ntp-module-header-v2{border-radius:var(--ntp-module-item-border-radius);outline:var(--cr-border-hcm)}}ntp-module-header-v2{background-color:var(--color-new-tab-page-module-background);margin:8px}`])}function getHtml$6(){return html`<!--_html_template_start_--><ntp-module-header-v2 id="moduleHeaderElementV2" header-text="From your Microsoft Sharepoint" .menuItemGroups="${this.getMenuItemGroups_()}" more-actions-text="${this.i18nRecursive("","modulesMoreActions","modulesSharePointSentence")}" @disable-button-click="${this.onDisableButtonClick_}" @dismiss-button-click="${this.onDismissButtonClick_}" @info-button-click="${this.onInfoButtonClick_}" @menu-button-click="${this.onMenuButtonClick_}">
</ntp-module-header-v2>

<ntp-file-suggestion module-name="Sharepoint">
</ntp-file-suggestion>
${this.showInfoDialog_?html`
  <ntp-info-dialog show-on-attach .innerHTML="${this.i18nAdvanced("modulesSharepointInfo")}" @close="${this.onInfoDialogClose_}">
  </ntp-info-dialog>
`:""}
<!--_html_template_end_-->`}const SharepointModuleElementBase=I18nMixinLit(CrLitElement);class SharepointModuleElement extends SharepointModuleElementBase{constructor(){super(...arguments);this.showInfoDialog_=false}static get is(){return"ntp-sharepoint-module"}static get styles(){return getCss$8()}render(){return getHtml$6.bind(this)()}static get properties(){return{showInfoDialog_:{type:Boolean}}}getMenuItemGroups_(){return[[{action:"dismiss",icon:"modules:visibility_off",text:this.i18n("modulesDriveDismissButtonText")},{action:"disable",icon:"modules:block",text:this.i18n("modulesDriveDisableButtonTextV2")},{action:"info",icon:"modules:info",text:this.i18n("moduleInfoButtonTitle")}],[{action:"customize-module",icon:"modules:tune",text:this.i18n("modulesCustomizeButtonText")}]]}onDisableButtonClick_(){}onDismissButtonClick_(){}onInfoButtonClick_(){this.showInfoDialog_=true}onInfoDialogClose_(){this.showInfoDialog_=false}onMenuButtonClick_(e){this.$.moduleHeaderElementV2.showAt(e)}}customElements.define(SharepointModuleElement.is,SharepointModuleElement);async function createSharepointElement(){return new SharepointModuleElement}const sharepointModuleDescriptor=new ModuleDescriptor("sharepoint",createSharepointElement);const div$1=document.createElement("div");div$1.innerHTML=getTrustedHTML`<cr-iconset name="tab_resumption" size="20">
  <svg>
    <defs>
      <g id="computer" viewBox="0 -960 960 960">
        <path d="M320-120v-80h80v-80H160q-33 0-56.5-23.5T80-360v-400q0-33 23.5-56.5T160-840h640q33 0 56.5 23.5T880-760v400q0 33-23.5 56.5T800-280H560v80h80v80H320ZM160-360h640v-400H160v400Zm0 0v-400 400Z">
        </path>
      </g>
      <g id="globe" viewBox="0 -960 960 960">
        <path d="M480-80q-83 0-156-31.5T197-197q-54-54-85.5-127T80-480q0-83 31.5-156T197-763q54-54 127-85.5T480-880q83 0 156 31.5T763-763q54 54 85.5 127T880-480q0 83-31.5 156T763-197q-54 54-127 85.5T480-80Zm-40-82v-78q-33 0-56.5-23.5T360-320v-40L168-552q-3 18-5.5 36t-2.5 36q0 121 79.5 212T440-162Zm276-102q20-22 36-47.5t26.5-53q10.5-27.5 16-56.5t5.5-59q0-98-54.5-179T600-776v16q0 33-23.5 56.5T520-680h-80v80q0 17-11.5 28.5T400-560h-80v80h240q17 0 28.5 11.5T600-440v120h40q26 0 47 15.5t29 40.5Z">
        </path>
      </g>
      <g id="phone" viewBox="0 -960 960 960">
        <path d="M400-160h160v-40H400v40ZM280-40q-33 0-56.5-23.5T200-120v-720q0-33 23.5-56.5T280-920h400q33 0 56.5 23.5T760-840v720q0 33-23.5 56.5T680-40H280Zm0-200v120h400v-120H280Zm0-80h400v-400H280v400Zm0-480h400v-40H280v40Zm0 560v120-120Zm0-560v-40 40Z">
        </path>
      </g>
      <g id="tablet" viewBox="0 -960 960 960">
        <path d="M200-40q-33 0-56.5-23.5T120-120v-720q0-33 23.5-56.5T200-920h560q33 0 56.5 23.5T840-840v720q0 33-23.5 56.5T760-40H200Zm0-200v120h560v-120H200Zm200 80h160v-40H400v40ZM200-320h560v-400H200v400Zm0-480h560v-40H200v40Zm0 0v-40 40Zm0 560v120-120Z">
        </path>
      </g>
      <g id="automotive" viewBox="0 0 24 24">
        <path d="M6 19V20C6 20.2833 5.9 20.525 5.7 20.725C5.51667 20.9083 5.28333 21 5 21H4C3.71667 21 3.475 20.9083 3.275 20.725C3.09167 20.525 3 20.2833 3 20V12L5.1 6C5.2 5.7 5.375 5.45833 5.625 5.275C5.89167 5.09167 6.18333 5 6.5 5H17.5C17.8167 5 18.1 5.09167 18.35 5.275C18.6167 5.45833 18.8 5.7 18.9 6L21 12V20C21 20.2833 20.9 20.525 20.7 20.725C20.5167 20.9083 20.2833 21 20 21H19C18.7167 21 18.475 20.9083 18.275 20.725C18.0917 20.525 18 20.2833 18 20V19H6ZM5.8 10H18.2L17.15 7H6.85L5.8 10ZM5 12V17V12ZM7.5 16C7.91667 16 8.26667 15.8583 8.55 15.575C8.85 15.275 9 14.9167 9 14.5C9 14.0833 8.85 13.7333 8.55 13.45C8.26667 13.15 7.91667 13 7.5 13C7.08333 13 6.725 13.15 6.425 13.45C6.14167 13.7333 6 14.0833 6 14.5C6 14.9167 6.14167 15.275 6.425 15.575C6.725 15.8583 7.08333 16 7.5 16ZM16.5 16C16.9167 16 17.2667 15.8583 17.55 15.575C17.85 15.275 18 14.9167 18 14.5C18 14.0833 17.85 13.7333 17.55 13.45C17.2667 13.15 16.9167 13 16.5 13C16.0833 13 15.725 13.15 15.425 13.45C15.1417 13.7333 15 14.0833 15 14.5C15 14.9167 15.1417 15.275 15.425 15.575C15.725 15.8583 16.0833 16 16.5 16ZM5 17H19V12H5V17Z" fill="#444746">
        </path>
      </g>
      <g id="wearable" viewBox="0 0 14 20">
        <path d="M5.5 2H8.5C8.36667 2 8.15833 2 7.875 2C7.60833 2 7.31667 2 7 2C6.68333 2 6.38333 2 6.1 2C5.83333 2 5.63333 2 5.5 2ZM5.5 18C5.63333 18 5.83333 18 6.1 18C6.38333 18 6.68333 18 7 18C7.31667 18 7.60833 18 7.875 18C8.15833 18 8.36667 18 8.5 18H5.5ZM4 20L2.65 15.45C1.85 14.8167 1.20833 14.025 0.725 13.075C0.241667 12.125 2.38419e-07 11.1 2.38419e-07 10C2.38419e-07 8.9 0.241667 7.875 0.725 6.925C1.20833 5.975 1.85 5.18333 2.65 4.55L4 -4.76837e-07H10L11.35 4.55C12.15 5.18333 12.7917 5.975 13.275 6.925C13.7583 7.875 14 8.9 14 10C14 11.1 13.7583 12.125 13.275 13.075C12.7917 14.025 12.15 14.8167 11.35 15.45L10 20H4ZM7 15C8.38333 15 9.55833 14.5167 10.525 13.55C11.5083 12.5667 12 11.3833 12 10C12 8.61667 11.5083 7.44167 10.525 6.475C9.55833 5.49167 8.38333 5 7 5C5.61667 5 4.43333 5.49167 3.45 6.475C2.48333 7.44167 2 8.61667 2 10C2 11.3833 2.48333 12.5667 3.45 13.55C4.43333 14.5167 5.61667 15 7 15ZM5.1 3.25C5.43333 3.16667 5.75 3.1 6.05 3.05C6.36667 3 6.68333 2.975 7 2.975C7.31667 2.975 7.625 3 7.925 3.05C8.24167 3.1 8.56667 3.16667 8.9 3.25L8.5 2H5.5L5.1 3.25ZM5.5 18H8.5L8.9 16.75C8.56667 16.8333 8.24167 16.9 7.925 16.95C7.625 16.9833 7.31667 17 7 17C6.68333 17 6.36667 16.9833 6.05 16.95C5.75 16.9 5.43333 16.8333 5.1 16.75L5.5 18Z" fill="#444746">
        </path>
      </g>
      <g id="tv" viewBox="0 0 24 24">
        <path d="M8 16H10V10H11.75L14 16H16L19 8H16.5L15 12.5L13.5 8H5V10H8V16ZM5 21C4.45 21 3.975 20.8083 3.575 20.425C3.19167 20.025 3 19.55 3 19V5C3 4.45 3.19167 3.98333 3.575 3.6C3.975 3.2 4.45 3 5 3H19C19.55 3 20.0167 3.2 20.4 3.6C20.8 3.98333 21 4.45 21 5V19C21 19.55 20.8 20.025 20.4 20.425C20.0167 20.8083 19.55 21 19 21H5ZM5 19H19V5H5V19ZM5 5V19V5Z" fill="#444746">
        </path>
      </g>
    </defs>
  </svg>
</cr-iconset>
`;const iconsets$1=div$1.querySelectorAll("cr-iconset");for(const iconset of iconsets$1){document.head.appendChild(iconset)}let instance$b=null;function getCss$7(){return instance$b||(instance$b=[...[],css`:host{align-items:center;background-position:center;background-repeat:no-repeat;border-radius:5px;display:flex;flex-shrink:0;height:36px;justify-content:center;margin-inline:0 12px;width:36px}@media (forced-colors:active){:host{forced-color-adjust:none}}`])}class PageFavicon extends CrLitElement{constructor(){super(...arguments);this.isKnownToSync=false;this.size=16}static get is(){return"page-favicon"}static get styles(){return getCss$7()}render(){return html``}static get properties(){return{url:{type:Object},isKnownToSync:{type:Boolean},size:{type:Number}}}willUpdate(changedProperties){super.willUpdate(changedProperties);if(changedProperties.has("url")){if(!this.url){this.style.setProperty("background-image","")}else{this.style.setProperty("background-image",getFaviconForPageURL(this.url.url,this.isKnownToSync,"",this.size))}}}}customElements.define(PageFavicon.is,PageFavicon);const div=document.createElement("div");div.innerHTML=getTrustedHTML`<cr-iconset name="modules" size="20">
  <svg>
    <defs>
      <g id="block" viewBox="0 -960 960 960">
        <path d="M480-87.87q-80.674 0-152.109-30.717T202.761-203q-53.696-53.696-84.294-125.25T87.869-480.478q0-81.674 30.598-152.489 30.598-70.816 84.294-124.392 53.695-53.576 125.13-84.174Q399.326-872.131 480-872.131q81.674 0 152.609 30.598t124.63 84.174q53.696 53.576 84.294 124.392 30.598 70.815 30.598 152.489 0 80.674-30.598 152.228T757.239-203q-53.695 53.696-124.63 84.413Q561.674-87.869 480-87.869Zm0-83q53.087 0 100.652-16.804t86.13-47.609L234.804-667.022q-30.326 39.044-47.13 86.37-16.804 47.326-16.804 100.174 0 128.804 90.282 219.206Q351.435-170.87 480-170.87Zm245.435-123.065q30.087-39.043 46.891-86.369t16.804-100.174q0-128.565-90.282-218.609Q608.565-789.13 480-789.13q-52.848 0-100.054 16.565-47.207 16.565-86.25 46.652l431.739 431.978Z">
        </path>
      </g>
      <g id="dock_to_left" viewBox="0 -960 960 960">
        <path d="M213.87-135.869q-32.421 0-55.211-22.79t-22.79-55.211v-532.26q0-32.421 22.79-55.211t55.211-22.79h532.26q32.421 0 55.211 22.79t22.79 55.211v532.26q0 32.421-22.79 55.211t-55.211 22.79H213.87Zm329.043-83.001v-522.26H218.87v522.26h324.043Z">
        </path>
      </g>
      <g id="done" viewBox="0 -960 960 960">
        <path d="M395-277.348 218.348-455l57.891-57.891L395-395.131l288.761-287.76L741.652-624 395-277.348Z">
        </path>
      </g>
      <g id="info" viewBox="0 -960 960 960">
        <path d="M440.413-284.413h79.174V-528h-79.174v243.587Zm39.376-310.804q17.244 0 29.119-11.665 11.875-11.664 11.875-28.907 0-17.244-11.665-29.119-11.664-11.875-28.907-11.875-17.244 0-29.119 11.665-11.875 11.664-11.875 28.907 0 17.244 11.665 29.119 11.664 11.875 28.907 11.875Zm.487 507.348q-81.189 0-152.621-30.618-71.432-30.618-124.991-84.177-53.559-53.559-84.177-124.949-30.618-71.391-30.618-152.845 0-81.455 30.618-152.387t84.177-124.491q53.559-53.559 124.949-84.177 71.391-30.618 152.845-30.618 81.455 0 152.387 30.618t124.491 84.177q53.559 53.559 84.177 124.716 30.618 71.156 30.618 152.344 0 81.189-30.618 152.621-30.618 71.432-84.177 124.991-53.559 53.559-124.716 84.177-71.156 30.618-152.344 30.618ZM480-170.87q129.043 0 219.087-90.043Q789.13-350.957 789.13-480t-90.043-219.087Q609.043-789.13 480-789.13t-219.087 90.043Q170.87-609.043 170.87-480t90.043 219.087Q350.957-170.87 480-170.87ZM480-480Z">
        </path>
      </g>
      <g id="thumb_down" viewBox="0 -960 960 960">
        <path d="M240.957-807.63h457.434v489.087L413.978-34.13l-38.293-25.776q-17.881-12.529-27.479-32.224-9.597-19.696-5.597-41.131l1-2.369 37.282-182.913H120q-34.065 0-58.533-24.468Q37-367.478 37-401.543v-42.413q0-8.582 1.5-15.748 1.5-7.165 4.978-14.404l120.435-283.066q9.196-22.869 30.685-36.663 21.489-13.793 46.359-13.793Zm378.021 83H240.957L120.478-443.956v42.413h358.218l-46.131 231.282 186.413-186.413V-724.63Zm0 367.956V-724.63v367.956Zm79.413 38.131v-83h136.587V-724.63H698.391v-83h219.587v489.087H698.391Z">
        </path>
      </g>
      <g id="tune" viewBox="0 -960 960 960">
        <path d="M454.087-136.587V-384H533.5v84h288v79.413h-288v84h-79.413Zm-315.587-84V-300h247.413v79.413H138.5Zm144-135.826v-84h-144v-79.174h144v-84h79.413v247.174H282.5Zm147.587-84v-79.174H821.5v79.174H430.087Zm144-135.587v-247.413H653.5v84h168V-660h-168v84h-79.413ZM138.5-660v-79.413h391.413V-660H138.5Z">
        </path>
      </g>
      <g id="visibility_off" viewBox="0 -960 960 960">
        <path d="m638.435-429.065-72.283-72.283q2.326-29.391-18.337-49.717t-48.38-18l-70.37-70.37q12.283-4.282 25.446-6.424Q467.674-648 480-648q70 0 119 49t49 119q0 11.848-2.141 25.489-2.142 13.641-7.424 25.446ZM777.652-289.37l-56.782-57.26q34.326-27.522 62.75-60.185 28.423-32.663 48.902-73.185-49.479-100.761-144.5-158.38Q593-696 480-696q-26 0-49.685 2.761-23.685 2.761-46.011 9.043l-64.217-64.217q38-15 78.456-21 40.457-6 81.457-6 144.435 0 264.967 78.695Q865.5-618.022 919.413-480q-22 57.478-58.978 104.935-36.978 47.456-82.783 85.695ZM765.13-87.13 639.435-213.065q-37.522 14.239-77.5 21.359-39.978 7.119-81.935 7.119-144.674 0-265.207-78.935Q94.261-342.456 40.587-480q21.76-56.522 58-104.359 36.239-47.837 83.761-86.793l-99.044-98.565 53.631-53.631 681.587 682.826L765.13-87.13ZM238.848-614.37q-34.522 28.479-63.207 60.544-28.684 32.065-47.924 73.826 49 101 144.142 158.5Q367-264 480-264q23.848 0 47.772-3.141 23.924-3.142 48.924-9.142l-45-45q-12.805 4.761-25.848 7.022Q492.804-312 480-312q-70 0-119-49t-49-119q0-12.565 3.141-25.728 3.142-13.163 5.663-25.968l-81.956-82.674Zm292.739 84.457Zm-102.935 99.587Z">
        </path>
      </g>
    </defs>
  </svg>
</cr-iconset>
`;const iconsets=div.querySelectorAll("cr-iconset");for(const iconset of iconsets){document.head.appendChild(iconset)}let instance$a=null;function getCss$6(){return instance$a||(instance$a=[...[getCss$l()],css`:host{background-color:var(--color-new-tab-page-module-background);border-radius:var(--ntp-module-border-radius)}@media (forced-colors:active){a,ntp-module-header-v2{border-radius:var(--ntp-module-item-border-radius);outline:var(--cr-border-hcm)}.url-visit{overflow:visible}}ntp-module-header-v2{background-color:var(--color-new-tab-page-module-background);margin:8px}:host-context(.focus-outline-visible) a:focus,a:focus-visible{box-shadow:var(--ntp-focus-shadow);outline:0}#urlVisits{background-color:var(--color-new-tab-page-module-item-background);border-radius:var(--ntp-module-item-border-radius);overflow:hidden;margin:8px}.url-visit{align-items:center;display:flex;height:56px;position:relative;text-decoration:none;overflow:hidden}.url-visit:hover #hoverLayer{background:var(--color-new-tab-page-module-item-background-hovered);display:block;inset:0;pointer-events:none;position:absolute}#hoverLayer{display:none}.url-visit:first-of-type{border-radius:var(--ntp-module-item-border-radius) var(--ntp-module-item-border-radius) 0 0;padding-top:var(--ntp-module-first-element-top-padding)}.icon{background-color:var(--color-new-tab-page-module-icon-background);border-radius:8px;height:var(--ntp-module-icon-size);margin-inline:8px;position:relative;width:var(--ntp-module-icon-size)}.url-visit-info{color:var(--color-new-tab-page-secondary-foreground);min-width:0;padding-inline-end:16px;position:relative}.url-visit-device,.url-visit-domain,.url-visit-title{overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.url-visit-title{color:var(--color-new-tab-page-primary-foreground);font-size:var(--ntp-module-text-size);line-height:var(--ntp-module-line-height)}.url-visit-description{display:flex;flex-direction:row;font-size:var(--ntp-module-secondary-text-size);line-height:var(--ntp-module-secondary-line-height)}.url-visit-reason{white-space:nowrap}:host([should-show-device-icon_]) .url-visit-device{flex-shrink:0;height:14px;margin-bottom:auto;margin-inline:0 4px;margin-top:auto;width:14px}cr-icon-button{--cr-icon-button-fill-color:var(--color-new-tab-page-primary-foreground);--cr-icon-button-hover-background-color:var(--color-new-tab-page-active-background);display:none;justify-content:flex-end;margin-left:auto;margin-right:16px}.url-visit:hover cr-icon-button{display:block}#seeMoreButtonContainer{padding:4px 0 8px 0}#seeMoreButtonContainer a{color:var(--color-new-tab-page-link);font-size:13px;display:block;font-weight:var(--ntp-module-see-more-font-weight);line-height:20px;padding:4px 16px 4px 16px;position:relative;text-decoration:none}#seeMoreButtonContainer:hover #hoverContainer{background:var(--color-new-tab-page-module-item-background-hovered);display:block;inset:0;pointer-events:none;position:absolute}#seeMoreButtonContainer #hoverContainer{display:none}`])}function getHtml$5(){return html`<!--_html_template_start_--><ntp-module-header-v2 id="moduleHeaderElementV2" header-text="${this.i18n("modulesMostRelevantTabResumptionTitle")}" .menuItemGroups="${this.getMenuItemGroups_()}" more-actions-text="${this.i18nRecursive("","modulesMoreActions","modulesTabResumptionTitle")}" @disable-button-click="${this.onDisableButtonClick_}" @dismiss-button-click="${this.onDismissAllButtonClick_}" @info-button-click="${this.onInfoButtonClick_}" @menu-button-click="${this.onMenuButtonClick_}">
</ntp-module-header-v2>
<div id="urlVisits">
  ${this.getVisibleUrlVisits_().map(((item,index)=>html`
    <a class="url-visit" href="${item.url.url}" @click="${this.onUrlVisitClick_}" data-index="${index}">
      <div id="hoverLayer"></div>
      <page-favicon class="icon" .url="${item.url}" size="24">
      </page-favicon>
      <div class="url-visit-info">
        <div class="url-visit-title">${item.title}</div>
        <div class="url-visit-description">
          <cr-icon class="url-visit-device" ?hidden="${!this.shouldShowDeviceIcon_}" icon="${this.computeIcon_(item)}">
          </cr-icon>
          <div class="url-visit-domain">${this.computeDomain_(item)}</div>
          <span class="dot" ?hidden="${!this.computeShouldShowDeviceName_(item)}">
            &nbsp&#8226&nbsp
          </span>
          <div class="url-visit-device" ?hidden="${!this.computeShouldShowDeviceName_(item)}">
            ${this.computeDeviceName_(item)}
          </div>
          <span class="dot">
            &nbsp&#8226&nbsp
          </span>
          <span class="url-visit-reason">
            ${item.decoration.displayString}
          </span>
        </div>
      </div>
      <cr-icon-button iron-icon="modules:done" @click="${this.onDismissButtonClick_}" title="РћС‚РјРµС‚РёС‚СЊ РєР°Рє РІС‹РїРѕР»РЅРµРЅРЅСѓСЋ Рё СЃРєСЂС‹С‚СЊ">
      </cr-icon-button>
    </a>
  `))}
  <div id="seeMoreButtonContainer">
    <a href="chrome://history/syncedTabs" @click="${this.onSeeMoreButtonClick_}">
      Р•С‰С‘
      <div id="hoverContainer"></div>
    </a>
  </div>
</div>
${this.showInfoDialog_?html`
    <ntp-info-dialog show-on-attach .innerHTML="${this.i18nAdvanced("modulesTabResumptionInfo")}" @close="${this.onInfoDialogClose_}">>
    </ntp-info-dialog>
`:""}
<!--_html_template_end_-->`}class MostRelevantTabResumptionProxyImpl{constructor(handler){this.handler=handler}static getInstance(){if(instance$9){return instance$9}const handler=PageHandler.getRemote();return instance$9=new MostRelevantTabResumptionProxyImpl(handler)}static setInstance(obj){instance$9=obj}}let instance$9=null;const MAX_URL_VISITS=5;class ModuleElement extends(I18nMixinLit(CrLitElement)){constructor(){super(...arguments);this.format="wide";this.urlVisits=[];this.shouldShowDeviceIcon_=loadTimeData.getBoolean("mostRelevantTabResumptionDeviceIconEnabled");this.showInfoDialog_=false}static get is(){return"ntp-most-relevant-tab-resumption"}static get styles(){return getCss$6()}render(){return getHtml$5.bind(this)()}static get properties(){return{format:{type:String,reflect:true},urlVisits:{type:Object},shouldShowDeviceIcon_:{type:Boolean,reflect:true},showInfoDialog_:{type:Boolean}}}getMenuItemGroups_(){return[[{action:"dismiss",icon:"modules:thumb_down",text:this.i18n("modulesMostRelevantTabResumptionDismissAll")},{action:"disable",icon:"modules:block",text:this.i18nRecursive("","modulesDisableButtonTextV2","modulesTabResumptionTitle")},{action:"info",icon:"modules:info",text:this.i18n("moduleInfoButtonTitle")}],[{action:"customize-module",icon:"modules:tune",text:this.i18n("modulesCustomizeButtonText")}]]}onDisableButtonClick_(){this.fire("disable-module",{message:loadTimeData.getStringF("modulesDisableToastMessage",loadTimeData.getString("modulesThisTypeOfCardText"))})}onDismissAllButtonClick_(){MostRelevantTabResumptionProxyImpl.getInstance().handler.dismissModule(this.urlVisits);this.fire("dismiss-module-instance",{message:loadTimeData.getStringF("dismissModuleToastMessage",loadTimeData.getString("modulesTabResumptionSentence")),restoreCallback:()=>MostRelevantTabResumptionProxyImpl.getInstance().handler.restoreModule(this.urlVisits)})}onSeeMoreButtonClick_(){this.fire("usage");recordOccurence("NewTabPage.TabResumption.SeeMoreClick")}onDismissButtonClick_(e){e.preventDefault();e.stopPropagation();const urlVisit=e.target.parentElement;const index=Number(urlVisit.dataset["index"]);chrome.metricsPrivate.recordSmallCount("NewTabPage.TabResumption.VisitDismissIndex",index);urlVisit.remove();MostRelevantTabResumptionProxyImpl.getInstance().handler.dismissURLVisit(this.urlVisits[index]);this.fire("dismiss-module-element",{message:loadTimeData.getStringF("dismissModuleToastMessage",loadTimeData.getString("modulesTabResumptionSentence")),restoreCallback:()=>{chrome.metricsPrivate.recordSmallCount("NewTabPage.TabResumption.VisitRestoreIndex",index);this.$.urlVisits.insertBefore(urlVisit,this.$.urlVisits.childNodes[index]);MostRelevantTabResumptionProxyImpl.getInstance().handler.restoreURLVisit(this.urlVisits[index])}})}onMenuButtonClick_(e){this.$.moduleHeaderElementV2.showAt(e)}onUrlVisitClick_(e){this.fire("usage");const currentTarget=e.currentTarget;const index=Number(currentTarget.dataset["index"]);const urlVisit=this.urlVisits[index];chrome.metricsPrivate.recordSmallCount("NewTabPage.TabResumption.ClickIndex",index);chrome.metricsPrivate.recordEnumerationValue("NewTabPage.TabResumption.Visit.ClickSource",urlVisit.source,VisitSource.MAX_VALUE);chrome.metricsPrivate.recordValue({metricName:"NewTabPage.TabResumption.TimeElapsedSinceLastVisit",type:chrome.metricsPrivate.MetricTypeType.HISTOGRAM_LOG,min:60*1e3,max:4*24*60*60*1e3,buckets:50},Number(urlVisit.relativeTime.microseconds/1000n));MostRelevantTabResumptionProxyImpl.getInstance().handler.recordAction(ScoredURLUserAction.kActivated,urlVisit.urlKey,urlVisit.trainingRequestId)}computeDomain_(urlVisit){let domain=new URL(urlVisit.url.url).hostname;domain=domain.replace("www.","");return domain}computeIcon_(urlVisit){switch(urlVisit.formFactor){case FormFactor.kDesktop:return"tab_resumption:computer";case FormFactor.kPhone:return"tab_resumption:phone";case FormFactor.kTablet:return"tab_resumption:tablet";case FormFactor.kAutomotive:return"tab_resumption:automotive";case FormFactor.kWearable:return"tab_resumption:wearable";case FormFactor.kTv:return"tab_resumption:tv";default:return"tab_resumption:globe"}}computeDeviceName_(urlVisit){return loadTimeData.getBoolean("modulesRedesignedEnabled")?urlVisit.sessionName:this.i18n("modulesTabResumptionDevicePrefix")+` ${urlVisit.sessionName}`}computeShouldShowDeviceName_(urlVisit){return!this.shouldShowDeviceIcon_&&!!this.computeDeviceName_(urlVisit)}getVisibleUrlVisits_(){return this.urlVisits.slice(0,MAX_URL_VISITS)}onInfoButtonClick_(){this.showInfoDialog_=true}onInfoDialogClose_(){this.showInfoDialog_=false}}customElements.define(ModuleElement.is,ModuleElement);async function createElement(){const{urlVisits:urlVisits}=await MostRelevantTabResumptionProxyImpl.getInstance().handler.getURLVisits();if(!urlVisits||urlVisits.length===0){return null}const element=new ModuleElement;element.urlVisits=urlVisits;urlVisits.slice(0,MAX_URL_VISITS).forEach((urlVisit=>{MostRelevantTabResumptionProxyImpl.getInstance().handler.recordAction(ScoredURLUserAction.kSeen,urlVisit.urlKey,urlVisit.trainingRequestId)}));return element}const mostRelevantTabResumptionDescriptor=new ModuleDescriptor("tab_resumption",createElement);const modulesRedesignedEnabled=loadTimeData.getBoolean("modulesRedesignedEnabled");const descriptors=[];descriptors.push(modulesRedesignedEnabled?driveModuleV2Descriptor:driveDescriptor);descriptors.push(sharepointModuleDescriptor);descriptors.push(mostRelevantTabResumptionDescriptor);descriptors.push(googleCalendarDescriptor);descriptors.push(outlookCalendarDescriptor);async function counterfactualLoad(){if(!loadTimeData.getBoolean("modulesEnabled")&&loadTimeData.getBoolean("modulesLoadEnabled")){const modules=await ModuleRegistry.getInstance().initializeModules(loadTimeData.getInteger("modulesLoadTimeout"));if(modules){NewTabPageProxy.getInstance().handler.onModulesLoadedWithData(modules.map((module=>module.descriptor.id)))}}}counterfactualLoad();let instance$8=null;function getCss$5(){return instance$8||(instance$8=[...[],css`:host{--cr-toast-background:var(--color-toast-background,
      var(--cr-fallback-color-inverse-surface));--cr-toast-button-color:var(--color-toast-button,
      var(--cr-fallback-color-inverse-primary));--cr-toast-text-color:var(--color-toast-foreground,
      var(--cr-fallback-color-inverse-on-surface))}:host{align-items:center;background:var(--cr-toast-background);border-radius:8px;bottom:0;box-shadow:0 2px 4px 0 rgba(0,0,0,.28);box-sizing:border-box;display:flex;line-height:20px;margin:24px;max-width:var(--cr-toast-max-width,568px);min-height:52px;min-width:288px;opacity:0;padding:0 16px;position:fixed;transform:translateY(100px);transition:opacity .3s,transform .3s;visibility:hidden;z-index:1}:host-context([dir=ltr]){left:0}:host-context([dir=rtl]){right:0}:host([open]){opacity:1;transform:translateY(0);visibility:visible}:host ::slotted(*){color:var(--cr-toast-text-color)}:host ::slotted(cr-button){background-color:transparent!important;border:none!important;color:var(--cr-toast-button-color)!important;margin-inline-start:32px!important;min-width:52px!important;padding:8px!important}:host ::slotted(cr-button:hover){background-color:transparent!important}::slotted(cr-button:last-of-type){margin-inline-end:-8px}`])}function getHtml$4(){return html`<slot></slot>`}class CrToastElement extends CrLitElement{constructor(){super(...arguments);this.duration=0;this.open=false;this.hideTimeoutId_=null}static get is(){return"cr-toast"}static get styles(){return getCss$5()}render(){return getHtml$4.bind(this)()}static get properties(){return{duration:{type:Number},open:{type:Boolean,reflect:true}}}willUpdate(changedProperties){super.willUpdate(changedProperties);if(changedProperties.has("duration")||changedProperties.has("open")){this.resetAutoHide_()}}resetAutoHide_(){if(this.hideTimeoutId_!==null){window.clearTimeout(this.hideTimeoutId_);this.hideTimeoutId_=null}if(this.open&&this.duration!==0){this.hideTimeoutId_=window.setTimeout((()=>{this.hide()}),this.duration)}}async show(){const shouldResetAutohide=this.open;this.removeAttribute("role");this.removeAttribute("aria-hidden");this.open=true;await this.updateComplete;this.setAttribute("role","alert");if(shouldResetAutohide){this.resetAutoHide_()}}async hide(){this.setAttribute("aria-hidden","true");this.open=false;await this.updateComplete}}customElements.define(CrToastElement.is,CrToastElement);class MostVisitedBrowserProxy{constructor(handler,callbackRouter){this.handler=handler;this.callbackRouter=callbackRouter}static getInstance(){if(instance$7){return instance$7}const callbackRouter=new MostVisitedPageCallbackRouter;const handler=new MostVisitedPageHandlerRemote;const factory=MostVisitedPageHandlerFactory.getRemote();factory.createPageHandler(callbackRouter.$.bindNewPipeAndPassRemote(),handler.$.bindNewPipeAndPassReceiver());instance$7=new MostVisitedBrowserProxy(handler,callbackRouter);return instance$7}static setInstance(obj){instance$7=obj}}let instance$7=null;let instance$6=null;function getCss$4(){return instance$6||(instance$6=[...[getCss$j(),getCss$k()],css`:host{--icon-button-color-active:var(--google-grey-700);--icon-button-color:var(--google-grey-600);--icon-size:48px;--tile-background-color:rgb(229, 231, 232);--tile-hover-color:rgba(var(--google-grey-900-rgb), .1);--tile-size:112px;--title-height:32px}@media (prefers-color-scheme:dark){:host{--tile-background-color:var(--google-grey-100)}}:host([is-dark_]){--icon-button-color-active:var(--google-grey-300);--icon-button-color:white;--tile-hover-color:rgba(255, 255, 255, .1)}#container{--content-width:calc(var(--column-count) * var(--tile-size)
    
    + 1px);display:flex;flex-wrap:wrap;height:calc(var(--row-count) * var(--tile-size));justify-content:center;margin-bottom:8px;opacity:0;overflow:hidden;padding:2px;transition:opacity .3s ease-in-out;width:calc(var(--content-width) + 12px)}:host([visible_]) #container{opacity:1}#addShortcutIcon,.query-tile-icon{-webkit-mask-repeat:no-repeat;-webkit-mask-size:100%;height:24px;width:24px}#addShortcutIconContainer{background-color:var(--add-shortcut-background-color,var(--tile-background-color));margin-inline-start:auto;margin-inline-end:auto}#addShortcutIcon{-webkit-mask-image:url(chrome://resources/images/add.svg);background-color:var(--add-shortcut-foreground-color,var(--google-grey-900))}.query-tile-icon{-webkit-mask-image:url(chrome://resources/images/icon_search.svg);background-color:var(--google-grey-700)}@media (forced-colors:active){#addShortcutIcon,.query-tile-icon{background-color:ButtonText}}:host([use-white-tile-icon_]) #addShortcutIcon{background-color:#fff}:host([use-white-tile-icon_]) .query-tile-icon{background-color:var(--google-grey-400)}#addShortcut,.tile{-webkit-tap-highlight-color:transparent;align-items:center;border-radius:4px;box-sizing:border-box;cursor:pointer;display:flex;flex-direction:column;height:var(--tile-size);opacity:1;outline:0;position:relative;text-decoration:none;transition-duration:.3s;transition-property:left,top;transition-timing-function:ease-in-out;user-select:none;width:var(--tile-size)}.tile a{border-radius:4px;display:inline-block;height:100%;outline:0;position:absolute;touch-action:none;width:100%}:host-context(.focus-outline-visible) #addShortcut:focus,:host-context(.focus-outline-visible) .tile a:focus{box-shadow:var(--most-visited-focus-shadow)}@media (forced-colors:active){:host-context(.focus-outline-visible) #addShortcut:focus,:host-context(.focus-outline-visible) .tile a:focus{outline:var(--cr-focus-outline-hcm)}}#addShortcut{background-color:transparent;border:none;box-shadow:none;justify-content:unset;padding:0}.force-hover,:host(:not([reordering_])) #addShortcut:hover,:host(:not([reordering_])) .tile:hover{background-color:var(--tile-hover-color)}.tile-icon{align-items:center;background-color:var(--tile-background-color);border-radius:50%;display:flex;flex-shrink:0;height:var(--icon-size);justify-content:center;margin-top:16px;width:var(--icon-size)}.tile-icon img{height:24px;width:24px}.tile-title{align-items:center;border-radius:calc(var(--title-height)/ 2 + 2px);color:var(--most-visited-text-color);display:flex;height:var(--title-height);line-height:calc(var(--title-height)/ 2);margin-top:6px;padding:2px 8px;width:88px}.tile-title span{font-weight:400;overflow:hidden;text-align:center;text-overflow:ellipsis;text-shadow:var(--most-visited-text-shadow);white-space:nowrap;width:100%}.tile[query-tile] .tile-title span{-webkit-box-orient:vertical;-webkit-line-clamp:2;display:-webkit-box;white-space:initial}.title-rtl{direction:rtl}.title-ltr{direction:ltr}.tile.dragging{background-color:var(--tile-hover-color);transition-property:none;z-index:2}cr-icon-button{--cr-icon-button-fill-color:var(--icon-button-color);--cr-icon-button-size:28px;--cr-icon-button-transition:none;margin:4px 2px;opacity:0;position:absolute;right:0;top:0;transition:opacity .1s ease-in-out}:host-context([dir=rtl]) cr-icon-button{left:0;right:unset}.force-hover cr-icon-button,:host(:not([reordering_])) .tile:hover cr-icon-button{opacity:1;transition-delay:.4s}:host(:not([reordering_])) cr-icon-button:active,:host(:not([reordering_])) cr-icon-button:hover,:host-context(.focus-outline-visible):host(:not([reordering_])) cr-icon-button:focus{--cr-icon-button-fill-color:var(--icon-button-color-active);opacity:1;transition-delay:0s}#dialogContent{height:160px}`])}function getHtml$3(){return html`<!--_html_template_start_-->
<div id="container" ?hidden="${!this.visible_}"
    .style="--tile-background-color: ${this.getBackgroundColorStyle_()};
            --column-count: ${this.columnCount_};
            --row-count: ${this.rowCount_};">
  ${this.tiles_.map(((item,index)=>html`
    <div class="tile" ?query-tile="${item.isQueryTile}"
      ?hidden="${this.isHidden_(index)}"
      title="${item.title}" @dragstart="${this.onDragStart_}"
      @touchstart="${this.onTouchStart_}" @click="${this.onTileClick_}"
      @mouseenter="${this.onTileHover_}" @mouseleave="${this.onTileExit_}"
      @mousedown="${this.onTileMouseDown_}" @keydown="${this.onTileKeyDown_}"
      draggable="true" data-index="${index}">
      <a href="${item.url.url}" aria-label="${item.title}"
          draggable="false">
      </a>
      <cr-icon-button id="actionMenuButton" class="icon-more-vert"
          title="${this.getMoreActionText_(item.title)}"
          @click="${this.onTileActionButtonClick_}" tabindex="0"
          ?hidden="${!this.customLinksEnabled_}"
          data-index="${index}"></cr-icon-button>
      <cr-icon-button id="removeButton" class="icon-clear"
          title="${this.i18n("linkRemove")}"
          @click="${this.onTileRemoveButtonClick_}" tabindex="0"
          ?hidden="${this.customLinksEnabled_}"
          data-index="${index}"></cr-icon-button>
      <div class="tile-icon">
        <img src="${this.getFaviconUrl_(item.url)}" draggable="false"
            ?hidden="${item.isQueryTile}" alt=""></img>
        <div class="query-tile-icon" draggable="false"
            ?hidden="${!item.isQueryTile}"></div>
      </div>
      <div class="tile-title ${this.getTileTitleDirectionClass_(item)}">
        <span>${item.title}</span>
      </div>
    </div>
  `))}
  <cr-button id="addShortcut" tabindex="0" @click="${this.onAdd_}"
      ?hidden="${!this.showAdd_}" @keydown="${this.onAddShortcutKeyDown_}"
      aria-label="${this.i18n("addLinkTitle")}"
      title="${this.i18n("addLinkTitle")}" noink>
    <div id="addShortcutIconContainer" class="tile-icon">
      <div id="addShortcutIcon" draggable="false"></div>
    </div>
    <div class="tile-title">
      <span>${this.i18n("addLinkTitle")}</span>
    </div>
  </cr-button>
  <cr-dialog id="dialog" @close="${this.onDialogClose_}">
    <div slot="title">${this.dialogTitle_}</div>
    <div slot="body" id="dialogContent">
      <cr-input id="dialogInputName" label="${this.i18n("nameField")}"
          .value="${this.dialogTileTitle_}" spellcheck="false" autofocus
          @value-changed="${this.onDialogTileNameChange_}"></cr-input>
      <cr-input id="dialogInputUrl" label="${this.i18n("urlField")}"
          .value="${this.dialogTileUrl_}"
          ?invalid="${this.dialogTileUrlInvalid_}"
          .errorMessage="${this.dialogTileUrlError_}" spellcheck="false"
          type="url" @blur="${this.onDialogTileUrlBlur_}"
          @value-changed="${this.onDialogTileUrlChange_}">
      </cr-input>
    </div>
    <div slot="button-container">
      <cr-button class="cancel-button" @click="${this.onDialogCancel_}">
        ${this.i18n("linkCancel")}
      </cr-button>
      <cr-button class="action-button" @click="${this.onSave_}"
          ?disabled="${this.dialogSaveDisabled_}">
        ${this.i18n("linkDone")}
      </cr-button>
    </div>
  </cr-dialog>
  <cr-action-menu id="actionMenu">
    <button id="actionMenuEdit" class="dropdown-item" @click="${this.onEdit_}">
      ${this.i18n("editLinkTitle")}
    </button>
    <button id="actionMenuRemove" class="dropdown-item"
        @click="${this.onRemove_}">
      ${this.i18n("linkRemove")}
    </button>
  </cr-action-menu>
</div>
<cr-toast id="toast" duration="10000">
  <div>${this.toastContent_}</div>
  ${this.showToastButtons_?html`
    <cr-button id="undo" aria-label="${this.i18n("undoDescription")}"
        @click="${this.onUndoClick_}">
      ${this.i18n("undo")}
    </cr-button>
    <cr-button id="restore"
        aria-label="${this.getRestoreButtonText_()}"
        @click="${this.onRestoreDefaultsClick_}">
      ${this.getRestoreButtonText_()}
    </cr-button>`:""}
</cr-toast>
<!--_html_template_end_-->`}class MostVisitedWindowProxy{matchMedia(query){return window.matchMedia(query)}now(){return Date.now()}static getInstance(){return instance$5||(instance$5=new MostVisitedWindowProxy)}static setInstance(obj){instance$5=obj}}let instance$5=null;function resetTilePosition(tile){tile.style.position="";tile.style.left="";tile.style.top=""}function setTilePosition(tile,{x:x,y:y}){tile.style.position="fixed";tile.style.left=`${x}px`;tile.style.top=`${y}px`}function getHitIndex(rects,x,y){return rects.findIndex((r=>x>=r.left&&x<=r.right&&y>=r.top&&y<=r.bottom))}function normalizeUrl(urlString){try{const url=new URL(urlString.includes("://")?urlString:`https://${urlString}/`);if(["http:","https:"].includes(url.protocol)){return url}}catch(e){}return null}const MostVisitedElementBase=I18nMixinLit(CrLitElement);class MostVisitedElement extends MostVisitedElementBase{static get is(){return"cr-most-visited"}static get styles(){return getCss$4()}render(){return getHtml$3.bind(this)()}static get properties(){return{theme:{type:Object},singleRow:{type:Boolean},reflowOnOverflow:{type:Boolean},useWhiteTileIcon_:{type:Boolean,reflect:true},columnCount_:{type:Number,state:true},rowCount_:{type:Number,state:true},customLinksEnabled_:{type:Boolean,reflect:true},dialogTileTitle_:{type:String,state:true},dialogTileUrl_:{type:String,state:true},dialogTileUrlInvalid_:{type:Boolean,state:true},dialogTitle_:{type:String,state:true},dialogSaveDisabled_:{type:Boolean,state:true},dialogShortcutAlreadyExists_:{type:Boolean,state:true},dialogTileUrlError_:{type:String,state:true},info_:{type:Object,state:true},isDark_:{type:Boolean,reflect:true},reordering_:{type:Boolean,reflect:true},maxTiles_:{type:Number,state:true},maxVisibleTiles_:{type:Number,state:true},showAdd_:{type:Boolean,state:true},showToastButtons_:{type:Boolean,state:true},maxVisibleColumnCount_:{type:Number,state:true},tiles_:{type:Array,state:true},toastContent_:{type:String,state:true},visible_:{type:Boolean,reflect:true}}}get tileElements_(){return Array.from(this.shadowRoot.querySelectorAll(".tile:not([hidden])"))}constructor(){performance.mark("most-visited-creation-start");super();this.theme=null;this.reflowOnOverflow=false;this.singleRow=false;this.useWhiteTileIcon_=false;this.columnCount_=3;this.rowCount_=1;this.customLinksEnabled_=false;this.dialogTileTitle_="";this.dialogTileUrl_="";this.dialogTileUrlInvalid_=false;this.dialogTitle_="";this.dialogSaveDisabled_=true;this.dialogShortcutAlreadyExists_=false;this.dialogTileUrlError_="";this.isDark_=false;this.reordering_=false;this.maxTiles_=0;this.maxVisibleTiles_=0;this.showAdd_=false;this.showToastButtons_=false;this.maxVisibleColumnCount_=0;this.tiles_=[];this.toastContent_="";this.visible_=false;this.adding_=false;this.actionMenuTargetIndex_=-1;this.tileRects_=[];this.isRtl_=false;this.boundOnDocumentKeyDown_=_e=>null;this.prerenderTimer_=null;this.preconnectTimer_=null;this.info_=null;this.callbackRouter_=MostVisitedBrowserProxy.getInstance().callbackRouter;this.pageHandler_=MostVisitedBrowserProxy.getInstance().handler;this.windowProxy_=MostVisitedWindowProxy.getInstance();this.dragOffset_=null;this.dragImage_=new Image(1,1);this.dragImage_.src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAA"+"ABAAEAAAICTAEAOw==";this.mediaEventTracker_=new EventTracker;this.eventTracker_=new EventTracker}connectedCallback(){super.connectedCallback();this.isRtl_=window.getComputedStyle(this)["direction"]==="rtl";this.onSingleRowChange_();this.callbackRouter_.setMostVisitedInfo.addListener((info=>{performance.measure("most-visited-mojo","most-visited-mojo-start");this.info_=info}));performance.mark("most-visited-mojo-start");this.eventTracker_.add(document,"visibilitychange",(()=>{if(document.visibilityState==="visible"){this.pageHandler_.updateMostVisitedInfo()}}));this.pageHandler_.updateMostVisitedInfo();FocusOutlineManager.forDocument(document)}disconnectedCallback(){super.disconnectedCallback();this.mediaEventTracker_.removeAll();this.eventTracker_.removeAll();this.ownerDocument.removeEventListener("keydown",this.boundOnDocumentKeyDown_)}willUpdate(changedProperties){super.willUpdate(changedProperties);const changedPrivateProperties=changedProperties;if(changedProperties.has("theme")){this.useWhiteTileIcon_=this.computeUseWhiteTileIcon_();this.isDark_=this.computeIsDark_()}if(changedPrivateProperties.has("info_")&&this.info_!==null){this.visible_=this.info_.visible;this.customLinksEnabled_=this.info_.customLinksEnabled;this.maxTiles_=this.customLinksEnabled_?10:8;this.tiles_=this.info_.tiles.slice(0,this.maxTiles_)}this.showAdd_=this.computeShowAdd_();this.columnCount_=this.computeColumnCount_();this.rowCount_=this.computeRowCount_();if(changedPrivateProperties.has("tiles_")||changedPrivateProperties.has("dialogTileUrl_")){this.dialogShortcutAlreadyExists_=this.computeDialogShortcutAlreadyExists_()}if(changedPrivateProperties.has("dialogShortcutAlreadyExists_")){this.dialogTileUrlError_=this.computeDialogTileUrlError_()}if(changedPrivateProperties.has("dialogTitle_")||changedPrivateProperties.has("dialogTileUrl_")){this.dialogSaveDisabled_=this.computeDialogSaveDisabled_()}}firstUpdated(){this.boundOnDocumentKeyDown_=e=>this.onDocumentKeyDown_(e);this.ownerDocument.addEventListener("keydown",this.boundOnDocumentKeyDown_);performance.measure("most-visited-creation","most-visited-creation-start")}updated(changedProperties){super.updated(changedProperties);this.maxVisibleTiles_=this.computeMaxVisibleTiles_();const changedPrivateProperties=changedProperties;if(changedProperties.has("singleRow")){this.onSingleRowChange_()}if(changedPrivateProperties.has("tiles_")){if(this.tiles_.length>0){this.onTilesRendered_()}}}getBackgroundColorStyle_(){const skColor=this.theme?this.theme.backgroundColor:null;return skColor?skColorToRgba(skColor):"inherit"}enableForceHover_(index){this.tileElements_[index].classList.add("force-hover")}clearForceHover_(){const forceHover=this.shadowRoot.querySelector(".force-hover");if(forceHover){forceHover.classList.remove("force-hover")}}computeColumnCount_(){const shortcutCount=this.tiles_?this.tiles_.length:0;const canShowAdd=this.maxTiles_>shortcutCount;const tileCount=Math.min(this.maxTiles_,shortcutCount+(canShowAdd?1:0));const columnCount=tileCount<=this.maxVisibleColumnCount_?tileCount:Math.min(this.maxVisibleColumnCount_,Math.ceil(tileCount/(this.singleRow?1:2)));return columnCount||3}computeRowCount_(){if(this.columnCount_===0){return 0}if(this.reflowOnOverflow&&this.tiles_){return Math.ceil((this.tiles_.length+(this.showAdd_?1:0))/this.columnCount_)}if(this.singleRow){return 1}const shortcutCount=this.tiles_?this.tiles_.length:0;return this.columnCount_<=shortcutCount?2:1}computeMaxVisibleTiles_(){if(this.reflowOnOverflow){return this.maxTiles_}return this.columnCount_*this.rowCount_}computeShowAdd_(){return this.customLinksEnabled_&&this.tiles_&&this.tiles_.length<this.maxVisibleTiles_}computeDialogSaveDisabled_(){return!this.dialogTileUrl_.trim()||normalizeUrl(this.dialogTileUrl_)===null||this.dialogShortcutAlreadyExists_}computeDialogShortcutAlreadyExists_(){const dialogTileHref=(normalizeUrl(this.dialogTileUrl_)||{}).href;if(!dialogTileHref){return false}return(this.tiles_||[]).some((({url:{url:url}},index)=>{if(index===this.actionMenuTargetIndex_){return false}const otherUrl=normalizeUrl(url);return otherUrl&&otherUrl.href===dialogTileHref}))}computeDialogTileUrlError_(){return loadTimeData.getString(this.dialogShortcutAlreadyExists_?"shortcutAlreadyExists":"invalidUrl")}computeIsDark_(){return this.theme?this.theme.isDark:false}computeUseWhiteTileIcon_(){return this.theme?this.theme.useWhiteTileIcon:false}dragEnd_(){if(!this.customLinksEnabled_){this.reordering_=false;return}this.dragOffset_=null;const dragElement=this.shadowRoot.querySelector(".tile.dragging");const droppedElement=this.shadowRoot.querySelector(".tile.dropped");if(!dragElement&&!droppedElement){this.reordering_=false;return}if(dragElement){dragElement.classList.remove("dragging");this.tileElements_.forEach((el=>resetTilePosition(el)));resetTilePosition(this.$.addShortcut)}else if(droppedElement){droppedElement.classList.remove("dropped")}}drop_(x,y){if(!this.customLinksEnabled_){return}const dragElement=this.shadowRoot.querySelector(".tile.dragging");if(!dragElement){return}const dragIndex=Number(dragElement.dataset["index"]);const dropIndex=getHitIndex(this.tileRects_,x,y);if(dragIndex!==dropIndex&&dropIndex>-1){const[draggingTile]=this.tiles_.splice(dragIndex,1);assert(draggingTile);this.tiles_.splice(dropIndex,0,draggingTile);this.requestUpdate();this.pageHandler_.reorderMostVisitedTile(draggingTile.url,dropIndex);dragElement.classList.remove("dragging");dragElement.classList.add("dropped");this.tileElements_.forEach((el=>resetTilePosition(el)));resetTilePosition(this.$.addShortcut)}}dragOver_(x,y){const dragElement=this.shadowRoot.querySelector(".tile.dragging");if(!dragElement){this.reordering_=false;return}const dragIndex=Number(dragElement.dataset["index"]);setTilePosition(dragElement,{x:x-this.dragOffset_.x,y:y-this.dragOffset_.y});const dropIndex=getHitIndex(this.tileRects_,x,y);this.tileElements_.forEach(((element,i)=>{let positionIndex;if(i===dragIndex){return}else if(dropIndex===-1){positionIndex=i}else if(dragIndex<dropIndex&&dragIndex<=i&&i<=dropIndex){positionIndex=i-1}else if(dragIndex>dropIndex&&dragIndex>=i&&i>=dropIndex){positionIndex=i+1}else{positionIndex=i}setTilePosition(element,this.tileRects_[positionIndex])}))}dragStart_(dragElement,x,y){this.clearForceHover_();dragElement.classList.add("dragging");const dragElementRect=dragElement.getBoundingClientRect();this.dragOffset_={x:x-dragElementRect.x,y:y-dragElementRect.y};const tileElements=this.tileElements_;this.tileRects_=tileElements.map((t=>t.getBoundingClientRect()));if(this.showAdd_){const element=this.$.addShortcut;setTilePosition(element,element.getBoundingClientRect())}tileElements.forEach(((tile,i)=>{setTilePosition(tile,this.tileRects_[i])}));this.reordering_=true}getFaviconUrl_(url){const faviconUrl=new URL("chrome://favicon2/");faviconUrl.searchParams.set("size","24");faviconUrl.searchParams.set("scaleFactor","1x");faviconUrl.searchParams.set("showFallbackMonogram","");faviconUrl.searchParams.set("pageUrl",url.url);return faviconUrl.href}getRestoreButtonText_(){return loadTimeData.getString(this.customLinksEnabled_?"restoreDefaultLinks":"restoreThumbnailsShort")}getTileTitleDirectionClass_(tile){return tile.titleDirection===TextDirection.RIGHT_TO_LEFT?"title-rtl":"title-ltr"}isHidden_(index){if(this.reflowOnOverflow){return false}return index>=this.maxVisibleTiles_}onSingleRowChange_(){if(!this.isConnected){return}this.mediaEventTracker_.removeAll();const queryLists=[];const updateCount=()=>{const index=queryLists.findIndex((listener=>listener.matches));this.maxVisibleColumnCount_=3+(index>-1?queryLists.length-index:0)};const maxColumnCount=this.singleRow?10:5;for(let i=maxColumnCount;i>=4;i--){const query=`(min-width: ${112*(i+1)}px)`;const queryList=this.windowProxy_.matchMedia(query);this.mediaEventTracker_.add(queryList,"change",updateCount);queryLists.push(queryList)}updateCount()}onAdd_(){this.dialogTitle_=loadTimeData.getString("addLinkTitle");this.dialogTileTitle_="";this.dialogTileUrl_="";this.dialogTileUrlInvalid_=false;this.adding_=true;this.$.dialog.showModal()}onAddShortcutKeyDown_(e){if(hasKeyModifiers(e)){return}if(!this.tiles_||this.tiles_.length===0){return}const backKey=this.isRtl_?"ArrowRight":"ArrowLeft";if(e.key===backKey||e.key==="ArrowUp"){this.tileFocus_(this.tiles_.length-1)}}onDialogCancel_(){this.actionMenuTargetIndex_=-1;this.$.dialog.cancel()}onDialogClose_(){this.dialogTileUrl_="";if(this.adding_){this.$.addShortcut.focus()}this.adding_=false}onDialogTileUrlBlur_(){if(this.dialogTileUrl_.length>0&&(normalizeUrl(this.dialogTileUrl_)===null||this.dialogShortcutAlreadyExists_)){this.dialogTileUrlInvalid_=true}}onDialogTileUrlChange_(e){this.dialogTileUrl_=e.target.value;this.dialogTileUrlInvalid_=false}onDialogTileNameChange_(e){this.dialogTileTitle_=e.target.value}onDocumentKeyDown_(e){if(e.altKey||e.shiftKey){return}const modifier=isMac?e.metaKey&&!e.ctrlKey:e.ctrlKey&&!e.metaKey;if(modifier&&e.key==="z"){e.preventDefault();this.onUndoClick_()}}onDragStart_(e){if(!this.customLinksEnabled_){return}if(e.dataTransfer){e.dataTransfer.setDragImage(this.dragImage_,0,0)}this.dragStart_(e.target,e.x,e.y);const dragOver=e=>{e.preventDefault();e.dataTransfer.dropEffect="move";this.dragOver_(e.x,e.y)};const drop=e=>{this.drop_(e.x,e.y);const dropIndex=getHitIndex(this.tileRects_,e.x,e.y);if(dropIndex!==-1){this.enableForceHover_(dropIndex)}};this.ownerDocument.addEventListener("dragover",dragOver);this.ownerDocument.addEventListener("drop",drop);this.ownerDocument.addEventListener("dragend",(_=>{this.ownerDocument.removeEventListener("dragover",dragOver);this.ownerDocument.removeEventListener("drop",drop);this.dragEnd_();this.addEventListener("pointermove",(()=>{this.clearForceHover_();this.reordering_=false}),{once:true})}),{once:true})}onEdit_(){this.$.actionMenu.close();this.dialogTitle_=loadTimeData.getString("editLinkTitle");const tile=this.tiles_[this.actionMenuTargetIndex_];this.dialogTileTitle_=tile.title;this.dialogTileUrl_=tile.url.url;this.dialogTileUrlInvalid_=false;this.$.dialog.showModal()}onRestoreDefaultsClick_(){if(!this.$.toast.open||!this.showToastButtons_){return}this.$.toast.hide();this.pageHandler_.restoreMostVisitedDefaults()}async onRemove_(){this.$.actionMenu.close();await this.tileRemove_(this.actionMenuTargetIndex_);this.actionMenuTargetIndex_=-1}async onSave_(){const newUrl={url:normalizeUrl(this.dialogTileUrl_).href};this.$.dialog.close();let newTitle=this.dialogTileTitle_.trim();if(newTitle.length===0){newTitle=this.dialogTileUrl_}if(this.adding_){const{success:success}=await this.pageHandler_.addMostVisitedTile(newUrl,newTitle);this.toast_(success?"linkAddedMsg":"linkCantCreate",success)}else{const{url:url,title:title}=this.tiles_[this.actionMenuTargetIndex_];if(url.url!==newUrl.url||title!==newTitle){const{success:success}=await this.pageHandler_.updateMostVisitedTile(url,newUrl,newTitle);this.toast_(success?"linkEditedMsg":"linkCantEdit",success)}this.actionMenuTargetIndex_=-1}}getCurrentTargetIndex_(e){const target=e.currentTarget;return Number(target.dataset["index"])}onTileActionButtonClick_(e){e.preventDefault();this.actionMenuTargetIndex_=this.getCurrentTargetIndex_(e);this.$.actionMenu.showAt(e.target)}onTileRemoveButtonClick_(e){e.preventDefault();this.tileRemove_(this.getCurrentTargetIndex_(e))}onTileClick_(e){if(e.defaultPrevented){return}e.preventDefault();const index=this.getCurrentTargetIndex_(e);const item=this.tiles_[index];this.pageHandler_.onMostVisitedTileNavigation(item,index,e.button||0,e.altKey,e.ctrlKey,e.metaKey,e.shiftKey)}onTileKeyDown_(e){if(hasKeyModifiers(e)){return}if(e.key!=="ArrowLeft"&&e.key!=="ArrowRight"&&e.key!=="ArrowUp"&&e.key!=="ArrowDown"&&e.key!=="Delete"){return}const index=this.getCurrentTargetIndex_(e);if(e.key==="Delete"){this.tileRemove_(index);return}const advanceKey=this.isRtl_?"ArrowLeft":"ArrowRight";const delta=e.key===advanceKey||e.key==="ArrowDown"?1:-1;this.tileFocus_(Math.max(0,index+delta))}onTileHover_(e){if(e.defaultPrevented){return}const item=this.tiles_[this.getCurrentTargetIndex_(e)];assert(item);if(loadTimeData.getBoolean("prerenderOnHoverEnabled")&&loadTimeData.getInteger("prerenderStartTimeThreshold")>=0){this.prerenderTimer_=setTimeout((()=>{this.pageHandler_.prerenderMostVisitedTile(item,true)}),loadTimeData.getInteger("prerenderStartTimeThreshold"))}if((loadTimeData.getBoolean("prerenderOnHoverEnabled")||loadTimeData.getBoolean("prerenderOnPressEnabled"))&&loadTimeData.getInteger("preconnectStartTimeThreshold")>=0){this.preconnectTimer_=setTimeout((()=>{this.pageHandler_.preconnectMostVisitedTile(item)}),loadTimeData.getInteger("preconnectStartTimeThreshold"))}}onTileMouseDown_(e){if(e.defaultPrevented){return}if(loadTimeData.getBoolean("prerenderOnPressEnabled")){const item=this.tiles_[this.getCurrentTargetIndex_(e)];assert(item);this.pageHandler_.prerenderMostVisitedTile(item,false)}}onTileExit_(e){if(e.defaultPrevented){return}if(this.prerenderTimer_){clearTimeout(this.prerenderTimer_)}if(this.preconnectTimer_){clearTimeout(this.preconnectTimer_)}if(loadTimeData.getBoolean("prerenderOnHoverEnabled")||loadTimeData.getBoolean("prerenderOnPressEnabled")){this.pageHandler_.cancelPrerender()}}onUndoClick_(){if(!this.$.toast.open||!this.showToastButtons_){return}this.$.toast.hide();this.pageHandler_.undoMostVisitedTileAction()}onTouchStart_(e){if(this.reordering_||!this.customLinksEnabled_){return}const tileElement=e.composedPath().find((el=>el.classList&&el.classList.contains("tile")));if(!tileElement){return}const{clientX:clientX,clientY:clientY}=e.changedTouches[0];this.dragStart_(tileElement,clientX,clientY);const touchMove=e=>{const{clientX:clientX,clientY:clientY}=e.changedTouches[0];this.dragOver_(clientX,clientY)};const touchEnd=e=>{this.ownerDocument.removeEventListener("touchmove",touchMove);tileElement.removeEventListener("touchend",touchEnd);tileElement.removeEventListener("touchcancel",touchEnd);const{clientX:clientX,clientY:clientY}=e.changedTouches[0];this.drop_(clientX,clientY);this.dragEnd_();this.reordering_=false};this.ownerDocument.addEventListener("touchmove",touchMove);tileElement.addEventListener("touchend",touchEnd,{once:true});tileElement.addEventListener("touchcancel",touchEnd,{once:true})}tileFocus_(index){if(index<0){return}const tileElements=this.tileElements_;if(index<tileElements.length){tileElements[index].querySelector("a").focus()}else if(this.showAdd_&&index===tileElements.length){this.$.addShortcut.focus()}}toast_(msgId,showButtons){this.toastContent_=loadTimeData.getString(msgId);this.showToastButtons_=showButtons;this.$.toast.show()}async tileRemove_(index){const{url:url,isQueryTile:isQueryTile}=this.tiles_[index];this.pageHandler_.deleteMostVisitedTile(url);this.toast_("linkRemovedMsg",this.customLinksEnabled_||!isQueryTile);await this.updateComplete;this.tileFocus_(index)}onTilesRendered_(){performance.measure("most-visited-rendered");assert(this.maxVisibleTiles_>0);this.pageHandler_.onMostVisitedTilesRendered(this.tiles_.slice(0,this.maxVisibleTiles_),this.windowProxy_.now())}getMoreActionText_(title){return loadTimeData.getString("shortcutMoreActions")?loadTimeData.getStringF("shortcutMoreActions",title):""}}customElements.define(MostVisitedElement.is,MostVisitedElement);class PageImageServiceBrowserProxy{handler;constructor(handler){this.handler=handler}static getInstance(){return instance$4||(instance$4=new PageImageServiceBrowserProxy(PageImageServiceHandler.getRemote()))}static setInstance(obj){instance$4=obj}}let instance$4=null;let instance$3=null;function getCss$3(){return instance$3||(instance$3=[...[],css`:host{display:none}`])}function getHtml$2(){return html`<!--_html_template_start_--><form id="fileForm" .action="${this.uploadFileAction_}" enctype="multipart/form-data" method="POST">
  <input id="fileInput" name="encoded_image" type="file" .accept="${this.supportedFileTypes_}" @change="${this.handleFileInputChange_}">
</form>
<form id="urlForm" .action="${this.uploadUrlAction_}" method="GET">
  <input name="url" .value="${this.uploadUrl_}">
  <input name="ep" .value="${this.uploadUrlEntrypoint_}">
  <input name="hl" .value="${this.language_}">
  <input name="st" .value="${this.startTime_}"><input>
  <input name="cd" .value="${this.clientData_}"><input>
  <input name="re" .value="${this.renderingEnvironment_}">
  <input name="s" .value="${this.chromiumSurface_}">
</form>

<iframe src="https://lens.google.com/gen204" style="display:none" alt="">
</iframe>
<!--_html_template_end_-->`}const SCOTTY_UPLOAD_FILE_ACTION="https://lens.google.com/upload";const DIRECT_UPLOAD_FILE_ACTION="https://lens.google.com/v3/upload";const UPLOAD_FILE_ENTRYPOINT="cntpubb";const UPLOAD_BY_URL_ACTION="https://lens.google.com/uploadbyurl";const UPLOAD_URL_ENTRYPOINT="cntpubu";const RENDERING_ENVIRONMENT="df";const CHROMIUM_SURFACE="4";const MAX_URL_LENGTH=2e3;const MAX_FILE_SIZE_BYTES=20*1024*1024;var LensErrorType;(function(LensErrorType){LensErrorType[LensErrorType["MULTIPLE_FILES"]=0]="MULTIPLE_FILES";LensErrorType[LensErrorType["NO_FILE"]=1]="NO_FILE";LensErrorType[LensErrorType["FILE_TYPE"]=2]="FILE_TYPE";LensErrorType[LensErrorType["FILE_SIZE"]=3]="FILE_SIZE";LensErrorType[LensErrorType["INVALID_SCHEME"]=4]="INVALID_SCHEME";LensErrorType[LensErrorType["INVALID_URL"]=5]="INVALID_URL";LensErrorType[LensErrorType["LENGTH_TOO_GREAT"]=6]="LENGTH_TOO_GREAT"})(LensErrorType||(LensErrorType={}));var LensSubmitType;(function(LensSubmitType){LensSubmitType[LensSubmitType["FILE"]=0]="FILE";LensSubmitType[LensSubmitType["URL"]=1]="URL"})(LensSubmitType||(LensSubmitType={}));class LensFormElement extends CrLitElement{constructor(){super(...arguments);this.supportedFileTypes_=SUPPORTED_FILE_TYPES.join(",");this.renderingEnvironment_=RENDERING_ENVIRONMENT;this.chromiumSurface_=CHROMIUM_SURFACE;this.language_=window.navigator.language;this.uploadFileAction_=SCOTTY_UPLOAD_FILE_ACTION;this.uploadUrlAction_=UPLOAD_BY_URL_ACTION;this.uploadUrl_="";this.uploadUrlEntrypoint_=UPLOAD_URL_ENTRYPOINT;this.startTime_=null;this.clientData_=loadTimeData.getString("searchboxLensVariations");this.useDirectUpload_=loadTimeData.getBoolean("searchboxLensDirectUpload")}static get is(){return"ntp-lens-form"}static get styles(){return getCss$3()}render(){return getHtml$2.bind(this)()}static get properties(){return{supportedFileTypes_:{type:String},renderingEnvironment_:{type:String},chromiumSurface_:{type:String},useDirectUpload_:{type:Boolean},uploadFileAction_:{type:String},uploadUrlAction_:{type:String},uploadUrl_:{type:String},uploadUrlEntrypoint_:{type:String},language_:{type:String},clientData_:{type:String},startTime_:{type:String}}}openSystemFilePicker(){this.$.fileInput.click()}handleFileInputChange_(){const fileList=this.$.fileInput.files;if(fileList){this.submitFileList(fileList)}}submitFileList(files){if(files.length>1){this.dispatchError_(LensErrorType.MULTIPLE_FILES);return}const file=files[0];if(!file){this.dispatchError_(LensErrorType.NO_FILE);return}return this.submitFile_(file)}async submitFile_(file){if(!SUPPORTED_FILE_TYPES.includes(file.type)){this.dispatchError_(LensErrorType.FILE_TYPE);return}if(file.size>MAX_FILE_SIZE_BYTES){this.dispatchError_(LensErrorType.FILE_SIZE);return}if(this.useDirectUpload_){this.uploadFileAction_=DIRECT_UPLOAD_FILE_ACTION}this.startTime_=Date.now().toString();let processedFile={processedFile:file};if(this.useDirectUpload_){processedFile=await processFile(file)}const dataTransfer=new DataTransfer;dataTransfer.items.add(processedFile.processedFile);this.$.fileInput.files=dataTransfer.files;const action=new URL(this.uploadFileAction_);action.searchParams.set("ep",UPLOAD_FILE_ENTRYPOINT);action.searchParams.set("hl",this.language_);action.searchParams.set("st",this.startTime_.toString());action.searchParams.set("cd",this.clientData_);action.searchParams.set("re",RENDERING_ENVIRONMENT);action.searchParams.set("s",CHROMIUM_SURFACE);action.searchParams.set("vph",processedFile.imageHeight?processedFile.imageHeight.toString():"");action.searchParams.set("vpw",processedFile.imageWidth?processedFile.imageWidth.toString():"");this.uploadFileAction_=action.toString();await this.updateComplete;this.dispatchLoading_(LensSubmitType.FILE);this.$.fileForm.submit()}async submitUrl(urlString){if(!urlString.startsWith("http://")&&!urlString.startsWith("https://")){this.dispatchError_(LensErrorType.INVALID_SCHEME);return}let encodedUri;try{encodedUri=encodeURI(urlString);new URL(urlString)}catch(e){this.dispatchError_(LensErrorType.INVALID_URL);return}if(encodedUri.length>MAX_URL_LENGTH){this.dispatchError_(LensErrorType.LENGTH_TOO_GREAT);return}this.uploadUrl_=encodedUri;this.startTime_=Date.now().toString();await this.updateComplete;this.dispatchLoading_(LensSubmitType.URL);this.$.urlForm.submit()}dispatchLoading_(submitType){this.dispatchEvent(new CustomEvent("loading",{bubbles:false,composed:false,detail:submitType}))}dispatchError_(errorType){this.dispatchEvent(new CustomEvent("error",{bubbles:false,composed:false,detail:errorType}))}}customElements.define(LensFormElement.is,LensFormElement);let instance$2=null;function getCss$2(){return instance$2||(instance$2=[...[],css`.spinner{--cr-spinner-size:28px;mask-image:url(//resources/images/throbber_small.svg);mask-position:center;mask-repeat:no-repeat;mask-size:var(--cr-spinner-size) var(--cr-spinner-size);background-color:var(--cr-spinner-color,var(--google-blue-500));height:var(--cr-spinner-size);width:var(--cr-spinner-size)}@media (prefers-color-scheme:dark){.spinner{background-color:var(--cr-spinner-color,var(--google-blue-300))}}`])}let instance$1=null;function getCss$1(){return instance$1||(instance$1=[...[getCss$k(),getCss$2()],css`:host{--upload-dialog-background:var(--color-new-tab-page-background-override);--upload-dialog-divider-line-border-top:1px solid var(--google-grey-200);--upload-dialog-divider-line-or-label-color:var(--color-new-tab-page-secondary-foreground);--upload-dialog-drag-drop-background:var(--google-grey-50);--upload-dialog-drag-drop-border:1px dashed var(--google-grey-400);--upload-dialog-drag-drop-error-background-color:var(--google-red-50);--upload-dialog-drag-drop-title-color:var(--color-new-tab-page-secondary-foreground);--upload-dialog-drag-drop-upload-text-color:var(--google-blue-700);--upload-dialog-error-message-color:var(--google-red-800);--upload-dialog-input-box-background:var(--color-new-tab-page-background-override);--upload-dialog-input-box-border-color:var(--google-grey-300);--upload-dialog-input-box-color:var(--google-grey-800);--upload-dialog-input-box-placeholder-color:var(--google-grey-700);--upload-dialog-input-submit-background:var(--color-new-tab-page-background-override);--upload-dialog-input-submit-border-color:var(--google-grey-300);--upload-dialog-input-submit-color:var(--google-blue-600);--upload-dialog-shadow:var(--cr-elevation-3);--upload-dialog-title-color:var(--google-grey-800);font-family:inherit;width:100%}:host([is-dragging_]),:host([is-loading_]){--upload-dialog-drag-drop-background:var(--google-blue-50)}@media (prefers-color-scheme:dark){:host{--upload-dialog-background:var(--google-grey-850);--upload-dialog-divider-line-border-top:1px solid var(--google-grey-800);--upload-dialog-drag-drop-background:rgba(var(--google-grey-900-rgb), .68);--upload-dialog-drag-drop-border:1px dashed var(--google-grey-800);--upload-dialog-drag-drop-error-background-color:var(--google-red-300);--upload-dialog-drag-drop-upload-text-color:var(--google-blue-300);--upload-dialog-error-message-color:var(--google-grey-900);--upload-dialog-input-box-background:transparent;--upload-dialog-input-box-border-color:var(--google-grey-800);--upload-dialog-input-box-color:var(--google-grey-100);--upload-dialog-input-box-placeholder-color:var(--google-grey-300);--upload-dialog-input-submit-background:transparent;--upload-dialog-input-submit-border-color:var(--google-grey-800);--upload-dialog-input-submit-color:var(--google-blue-300);--upload-dialog-title-color:var(--google-grey-100)}:host([is-dragging_]),:host([is-loading_]){--upload-dialog-drag-drop-background:rgba(var(--google-blue-300-rgb), .24);--upload-dialog-drag-drop-border:1px dashed var(--google-blue-300);--upload-dialog-drag-drop-title-color:var(--google-blue-300)}}#dialog{background:var(--upload-dialog-background);border-radius:22px;box-shadow:var(--upload-dialog-shadow);box-sizing:border-box;left:unset;padding:20px;position:relative;right:unset}:host-context([dir=rtl]) #closeButton{left:20px;right:initial}#closeButton{--cr-icon-button-fill-color:var(--color-new-tab-page-overlay-secondary-foreground);align-self:flex-end;cursor:pointer;display:flex;position:absolute;right:20px;top:15px}#title{color:var(--upload-dialog-title-color);font-size:16px;letter-spacing:.1px;line-height:28px;margin-bottom:14px;text-align:center}#dragDropArea{background:var(--upload-dialog-drag-drop-background);border:var(--upload-dialog-drag-drop-border);border-radius:8px;box-sizing:border-box;display:flex;flex-direction:column;flex-grow:1;height:280px;padding:20px;position:relative;width:100%}#dragDropError{align-items:center;background-color:var(--upload-dialog-drag-drop-error-background-color);border-top-left-radius:8px;border-top-right-radius:8px;justify-content:space-between;left:0;position:absolute;right:0;top:0}#dragDropErrorMessage{color:var(--upload-dialog-error-message-color);flex:1;font-size:12px;padding:5px;text-align:center}.drag-drop-title-container{align-items:center;display:inline-flex;flex-direction:row;flex-grow:1;justify-content:center}#dragDropIllustration{background:url(icons/drag_drop_illustration.svg) no-repeat center;display:inline-flex;height:45px;margin-inline-end:18px;vertical-align:middle;width:59px}.drag-drop-title{color:var(--upload-dialog-drag-drop-title-color);font-size:16px;line-height:25px;max-width:300px}#dragText{display:inline-block;margin-inline-end:4px}#uploadText{color:var(--upload-dialog-drag-drop-upload-text-color);cursor:pointer;display:inline-block;white-space:nowrap}#uploadText:focus,#uploadText:hover{text-decoration:underline}@media (forced-colors:active){#uploadText{color:LinkText}}#urlUploadContainer{box-sizing:border-box;display:flex;flex-direction:column;width:100%}#sectionDivider{align-items:center;display:flex}.divider-line{border-top:var(--upload-dialog-divider-line-border-top);flex-grow:1;height:0}#orLabel{color:var(--upload-dialog-divider-line-or-label-color);cursor:default;flex-shrink:0;font-size:14px;margin-inline-end:20px;margin-inline-start:20px}#inputContainer{display:flex;margin-top:14px}#inputBox{background:var(--upload-dialog-input-box-background);border:1px solid var(--upload-dialog-input-box-border-color);border-radius:36px;color:var(--upload-dialog-input-box-color);display:inline-flex;flex-grow:1;font-size:14px;height:40px;outline:0;padding:0 24px;width:100%}#inputBox::placeholder{color:var(--upload-dialog-input-box-placeholder-color)}#inputBox:hover{--upload-dialog-input-box-border-color:var(--google-grey-800)}#inputBox:focus{--upload-dialog-input-box-border-color:var(--google-blue-700)}#inputBox:active{--upload-dialog-input-box-border-color:var(--google-blue-700)}@media (prefers-color-scheme:dark){#inputBox:hover{--upload-dialog-input-box-border-color:var(--google-grey-700)}#inputBox:focus{--upload-dialog-input-box-border-color:var(--google-blue-300)}#inputBox:active{--upload-dialog-input-box-border-color:var(--google-blue-300)}}#inputSubmit{align-items:center;background:var(--upload-dialog-input-submit-background);border:1px solid var(--upload-dialog-input-submit-border-color);border-radius:32px;color:var(--upload-dialog-input-submit-color);cursor:pointer;display:inline-flex;flex-shrink:0;font-size:14px;justify-content:center;letter-spacing:.25px;margin-inline-start:8px;outline:0;padding:8px 24px}#inputSubmit:hover{--upload-dialog-input-submit-background:rgba(var(--google-blue-700-rgb), 0.08);--upload-dialog-input-submit-border-color:var(--google-grey-300);--upload-dialog-input-submit-color:var(--google-blue-600)}#inputSubmit:focus{--upload-dialog-input-submit-background:rgba(var(--google-blue-700-rgb), 0.08);--upload-dialog-input-submit-border-color:var(--google-blue-700);--upload-dialog-input-submit-color:var(--google-blue-600)}#inputSubmit:active{--upload-dialog-input-submit-background:rgba(var(--google-blue-700-rgb), 0.14);--upload-dialog-input-submit-border-color:var(--google-grey-300);--upload-dialog-input-submit-color:var(--google-blue-600)}@media (prefers-color-scheme:dark){#inputSubmit:hover{--upload-dialog-input-submit-background:rgba(var(--google-blue-300-rgb), 0.04);--upload-dialog-input-submit-border-color:var(--google-grey-800);--upload-dialog-input-submit-color:var(--google-blue-100)}#inputSubmit:focus{--upload-dialog-input-submit-background:rgba(var(--google-blue-300-rgb), 0.12);--upload-dialog-input-submit-border-color:var(--google-blue-100);--upload-dialog-input-submit-color:var(--google-blue-100)}#inputSubmit:active{--upload-dialog-input-submit-background:rgba(var(--google-blue-300-rgb), 0.10);--upload-dialog-input-submit-border-color:var(--google-grey-800);--upload-dialog-input-submit-color:var(--google-blue-100)}}#loadingContainer,#offlineContainer{align-items:center;display:flex;flex-direction:column;flex-grow:1;justify-content:center}#loadingContainer .spinner{margin-bottom:12px}#offlineTitle{color:var(--upload-dialog-title-color);text-align:center}#offlineImage{background:url(icons/offline_dialog.svg) no-repeat center;height:51px;margin-bottom:24px;width:55px}#offlineSubtitle{color:var(--upload-dialog-drag-drop-title-color);font-size:16px;margin-top:6px}#offlineRetryButton{margin-top:21px}`])}function getHtml$1(){return html`<!--_html_template_start_--><div id="dialog" ?hidden="${this.isHidden_}" tabindex="-1" lang="ru" role="dialog" aria-modal="true" @focusout="${this.onFocusOut_}">
  <ntp-lens-form id="lensForm" @loading="${this.handleFormLoading_}" @error="${this.handleFormError_}">
  </ntp-lens-form>
  <div id="container">
    <cr-icon-button id="closeButton" class="icon-clear" title="Р—Р°РєСЂС‹С‚СЊ" @click="${this.onCloseButtonClick_}" @keydown="${this.onCloseButtonKeydown_}">
    </cr-icon-button>
    <div id="title">РџРѕРёСЃРє РїРѕ РёР·РѕР±СЂР°Р¶РµРЅРёСЋ СЃ РїРѕРјРѕС‰СЊСЋ РћР±СЉРµРєС‚РёРІР°</div>
    <div id="dragDropArea" @dragenter="${this.onDragEnter_}" @dragover="${this.onDragOver_}" @dragleave="${this.onDragLeave_}" @drop="${this.onDrop_}">
      
      ${this.isError_?html`
        <div id="dragDropError">
          <div id="dragDropErrorMessage">${this.getErrorString_()}</div>
        </div>
      `:""}
      
      ${this.isNormalOrError_?html`
        <div class="drag-drop-title-container">
          <div id="dragDropIllustration"></div>
          <div class="drag-drop-title">
            <span id="dragText">РџРµСЂРµС‚Р°С‰РёС‚Рµ РёР·РѕР±СЂР°Р¶РµРЅРёРµ СЃСЋРґР° РёР»Рё</span>
            <span tabindex="0" role="button" id="uploadText" @click="${this.onUploadFileClick_}" @keydown="${this.onUploadFileKeyDown_}" @touchend="${this.onUploadFileTouchEnd_}">
              РІС‹Р±РµСЂРёС‚Рµ С„Р°Р№Р»
            </span>
          </div>
        </div>
        <div id="urlUploadContainer">
          <div id="sectionDivider">
            <div class="divider-line"></div>
            <div id="orLabel">РР›Р</div>
            <div class="divider-line"></div>
          </div>
          <div id="inputContainer">
            <input id="inputBox" autocomplete="false" autocorrect="false" placeholder="Р’СЃС‚Р°РІСЊС‚Рµ СЃСЃС‹Р»РєСѓ РЅР° РёР·РѕР±СЂР°Р¶РµРЅРёРµ" text="text" .value="${this.uploadUrl_}" @input="${this.onInputBoxInput_}" @keydown="${this.onUrlKeyDown_}">
            <div id="inputSubmit" tabindex="0" role="button" @click="${this.onSubmitUrl_}" @keydown="${this.onInputSubmitKeyDown_}">
              РџРѕРёСЃРє
            </div>
          </div>
        </div>
      `:""}
      
      ${this.isDragging_?html`
        <div class="drag-drop-title-container">
          <div class="drag-drop-title">
            РџРµСЂРµС‚Р°С‰РёС‚Рµ РёР·РѕР±СЂР°Р¶РµРЅРёРµ СЃСЋРґР°
          </div>
        </div>
      `:""}
      
      ${this.isLoading_?html`
        <div id="loadingContainer">
          <div class="spinner"></div>
          <div class="drag-drop-title">
            Р—Р°РіСЂСѓР·РєР°вЂ¦
          </div>
        </div>
      `:""}
      
      ${this.isOffline_?html`
        <div id="offlineContainer">
          <div id="offlineImage"></div>
          <div id="offlineTitle" class="drag-drop-title">
            РќРµС‚ РїРѕРґРєР»СЋС‡РµРЅРёСЏ Рє СЃРµС‚Рё
          </div>
          <div id="offlineSubtitle">
            РџСЂРѕРІРµСЂСЊС‚Рµ РїРѕРґРєР»СЋС‡РµРЅРёРµ Рє РёРЅС‚РµСЂРЅРµС‚Сѓ Рё РїРѕРІС‚РѕСЂРёС‚Рµ РїРѕРїС‹С‚РєСѓ.
          </div>
          <cr-button id="offlineRetryButton" class="action-button" @click="${this.onOfflineRetryButtonClick_}" @keydown="${this.onOfflineRetryButtonKeydown_}">
            РџРѕРІС‚РѕСЂРёС‚СЊ РїРѕРїС‹С‚РєСѓ
          </cr-button>
        </div>
      `:""}
    </div>
  </div>
</div>
<!--_html_template_end_-->`}var DialogState;(function(DialogState){DialogState[DialogState["HIDDEN"]=0]="HIDDEN";DialogState[DialogState["NORMAL"]=1]="NORMAL";DialogState[DialogState["DRAGGING"]=2]="DRAGGING";DialogState[DialogState["LOADING"]=3]="LOADING";DialogState[DialogState["ERROR"]=4]="ERROR";DialogState[DialogState["OFFLINE"]=5]="OFFLINE"})(DialogState||(DialogState={}));var LensErrorMessage;(function(LensErrorMessage){LensErrorMessage[LensErrorMessage["NONE"]=0]="NONE";LensErrorMessage[LensErrorMessage["FILE_TYPE"]=1]="FILE_TYPE";LensErrorMessage[LensErrorMessage["FILE_SIZE"]=2]="FILE_SIZE";LensErrorMessage[LensErrorMessage["MULTIPLE_FILES"]=3]="MULTIPLE_FILES";LensErrorMessage[LensErrorMessage["SCHEME"]=4]="SCHEME";LensErrorMessage[LensErrorMessage["CONFORMANCE"]=5]="CONFORMANCE";LensErrorMessage[LensErrorMessage["MULTIPLE_URLS"]=6]="MULTIPLE_URLS"})(LensErrorMessage||(LensErrorMessage={}));const EventKeys={ENTER:"Enter",ESCAPE:"Escape",SPACE:" ",TAB:"Tab"};var LensUploadDialogAction;(function(LensUploadDialogAction){LensUploadDialogAction[LensUploadDialogAction["URL_SUBMITTED"]=0]="URL_SUBMITTED";LensUploadDialogAction[LensUploadDialogAction["FILE_SUBMITTED"]=1]="FILE_SUBMITTED";LensUploadDialogAction[LensUploadDialogAction["IMAGE_DROPPED"]=2]="IMAGE_DROPPED";LensUploadDialogAction[LensUploadDialogAction["DIALOG_OPENED"]=3]="DIALOG_OPENED";LensUploadDialogAction[LensUploadDialogAction["DIALOG_CLOSED"]=4]="DIALOG_CLOSED";LensUploadDialogAction[LensUploadDialogAction["ERROR_SHOWN"]=5]="ERROR_SHOWN"})(LensUploadDialogAction||(LensUploadDialogAction={}));var LensUploadDialogError;(function(LensUploadDialogError){LensUploadDialogError[LensUploadDialogError["FILE_SIZE"]=0]="FILE_SIZE";LensUploadDialogError[LensUploadDialogError["FILE_TYPE"]=1]="FILE_TYPE";LensUploadDialogError[LensUploadDialogError["MULTIPLE_FILES"]=2]="MULTIPLE_FILES";LensUploadDialogError[LensUploadDialogError["MULTIPLE_URLS"]=3]="MULTIPLE_URLS";LensUploadDialogError[LensUploadDialogError["LENGTH_TOO_GREAT"]=4]="LENGTH_TOO_GREAT";LensUploadDialogError[LensUploadDialogError["INVALID_SCHEME"]=5]="INVALID_SCHEME";LensUploadDialogError[LensUploadDialogError["INVALID_URL"]=6]="INVALID_URL";LensUploadDialogError[LensUploadDialogError["NETWORK_ERROR"]=7]="NETWORK_ERROR"})(LensUploadDialogError||(LensUploadDialogError={}));function recordLensUploadDialogAction(action){chrome.metricsPrivate.recordEnumerationValue("NewTabPage.Lens.UploadDialog.DialogAction",action,Object.keys(LensUploadDialogAction).length)}function recordLensUploadDialogError(action){chrome.metricsPrivate.recordEnumerationValue("NewTabPage.Lens.UploadDialog.DialogError",action,Object.keys(LensUploadDialogError).length)}const LensUploadDialogElementBase=I18nMixinLit(CrLitElement);class LensUploadDialogElement extends LensUploadDialogElementBase{constructor(){super(...arguments);this.dialogState_=DialogState.HIDDEN;this.lensErrorMessage_=LensErrorMessage.NONE;this.outsideHandlerAttached_=false;this.uploadUrl_="";this.dragCount=0;this.outsideKeyHandler_=event=>{if(event.key===EventKeys.ESCAPE){this.closeDialog()}}}static get is(){return"ntp-lens-upload-dialog"}static get styles(){return getCss$1()}render(){return getHtml$1.bind(this)()}static get properties(){return{dialogState_:{type:DialogState},lensErrorMessage_:{type:Number},isHidden_:{type:Boolean},isNormalOrError_:{type:Boolean},isDragging_:{type:Boolean,reflect:true},isLoading_:{type:Boolean,reflect:true},isError_:{type:Boolean},isOffline_:{type:Boolean},uploadUrl_:{type:String}}}willUpdate(changedProperties){super.willUpdate(changedProperties);const changedPrivateProperties=changedProperties;if(changedPrivateProperties.has("dialogState_")){this.isHidden_=this.computeIsHidden_();this.isNormalOrError_=this.computeIsNormalOrError_();this.isDragging_=this.computeIsDragging_();this.isLoading_=this.computeIsLoading_();this.isError_=this.computeIsError_();this.isOffline_=this.computeIsOffline_()}}computeIsHidden_(){return this.dialogState_===DialogState.HIDDEN}computeIsNormalOrError_(){return this.dialogState_===DialogState.NORMAL||this.dialogState_===DialogState.ERROR}computeIsDragging_(){return this.dialogState_===DialogState.DRAGGING}computeIsLoading_(){return this.dialogState_===DialogState.LOADING}computeIsError_(){return this.dialogState_===DialogState.ERROR}computeIsOffline_(){return this.dialogState_===DialogState.OFFLINE}connectedCallback(){super.connectedCallback();this.openDialog()}disconnectedCallback(){super.disconnectedCallback();this.detachOutsideHandler_()}openDialog(){this.setOnlineState_();this.updateComplete.then((()=>{this.attachOutsideHandler_();if(this.isOffline_){this.shadowRoot.getElementById("offlineRetryButton").focus()}else{this.shadowRoot.getElementById("uploadText").focus()}}));recordLensUploadDialogAction(LensUploadDialogAction.DIALOG_OPENED)}closeDialog(){if(this.isHidden_){return}this.dialogState_=DialogState.HIDDEN;this.detachOutsideHandler_();this.dispatchEvent(new Event("close-lens-search"));recordLensUploadDialogAction(LensUploadDialogAction.DIALOG_CLOSED)}getErrorString_(){switch(this.lensErrorMessage_){case LensErrorMessage.FILE_TYPE:return this.i18n("lensSearchUploadDialogErrorFileType");case LensErrorMessage.FILE_SIZE:return this.i18n("lensSearchUploadDialogErrorFileSize");case LensErrorMessage.MULTIPLE_FILES:return this.i18n("lensSearchUploadDialogErrorMultipleFiles");case LensErrorMessage.SCHEME:return this.i18n("lensSearchUploadDialogValidationErrorScheme");case LensErrorMessage.CONFORMANCE:return this.i18n("lensSearchUploadDialogValidationErrorConformance");case LensErrorMessage.MULTIPLE_URLS:return this.i18n("lensSearchUploadDialogErrorMultipleUrls");default:return""}}setOnlineState_(){this.dialogState_=WindowProxy.getInstance().onLine?DialogState.NORMAL:DialogState.OFFLINE}attachOutsideHandler_(){if(!this.outsideHandlerAttached_){document.addEventListener("keydown",this.outsideKeyHandler_);this.outsideHandlerAttached_=true}}detachOutsideHandler_(){if(this.outsideHandlerAttached_){document.removeEventListener("keydown",this.outsideKeyHandler_);this.outsideHandlerAttached_=false}}onCloseButtonKeydown_(event){if(event.key===EventKeys.TAB&&(this.isDragging_||this.isLoading_)){event.preventDefault()}else if(event.key===EventKeys.TAB&&event.shiftKey){event.preventDefault();if(this.isNormalOrError_){this.shadowRoot.getElementById("inputSubmit").focus()}else if(this.isOffline_){this.shadowRoot.getElementById("offlineRetryButton").focus()}}}onOfflineRetryButtonKeydown_(event){if(event.key===EventKeys.TAB&&!event.shiftKey){event.preventDefault();this.$.closeButton.focus()}}onCloseButtonClick_(){this.closeDialog()}onOfflineRetryButtonClick_(){this.setOnlineState_()}onUploadFileKeyDown_(event){if(event.key===EventKeys.ENTER||event.key===EventKeys.SPACE){this.$.lensForm.openSystemFilePicker()}}onUploadFileClick_(){this.$.lensForm.openSystemFilePicker()}onUploadFileTouchEnd_(e){e.stopPropagation()}handleFormLoading_(event){this.dialogState_=DialogState.LOADING;switch(event.detail){case LensSubmitType.FILE:recordLensUploadDialogAction(LensUploadDialogAction.FILE_SUBMITTED);break;case LensSubmitType.URL:recordLensUploadDialogAction(LensUploadDialogAction.URL_SUBMITTED);break}}handleFormError_(event){switch(event.detail){case LensErrorType.MULTIPLE_FILES:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.MULTIPLE_FILES;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.MULTIPLE_FILES);break;case LensErrorType.NO_FILE:this.dialogState_=DialogState.NORMAL;this.lensErrorMessage_=LensErrorMessage.NONE;break;case LensErrorType.FILE_TYPE:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.FILE_TYPE;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.FILE_TYPE);break;case LensErrorType.FILE_SIZE:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.FILE_SIZE;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.FILE_SIZE);break;case LensErrorType.INVALID_SCHEME:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.SCHEME;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.INVALID_SCHEME);break;case LensErrorType.INVALID_URL:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.CONFORMANCE;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.INVALID_URL);break;case LensErrorType.LENGTH_TOO_GREAT:this.dialogState_=DialogState.ERROR;this.lensErrorMessage_=LensErrorMessage.CONFORMANCE;recordLensUploadDialogAction(LensUploadDialogAction.ERROR_SHOWN);recordLensUploadDialogError(LensUploadDialogError.LENGTH_TOO_GREAT);break;default:this.dialogState_=DialogState.NORMAL;this.lensErrorMessage_=LensErrorMessage.NONE}}onUrlKeyDown_(event){if(event.key===EventKeys.ENTER){event.preventDefault();this.onSubmitUrl_()}}onInputSubmitKeyDown_(event){if(event.key===EventKeys.ENTER||event.key===EventKeys.SPACE){this.onSubmitUrl_()}else if(event.key===EventKeys.TAB&&!event.shiftKey){event.preventDefault();this.$.closeButton.focus()}}onSubmitUrl_(){const url=this.uploadUrl_.trim();if(url.length>0){this.$.lensForm.submitUrl(url)}}onDragEnter_(e){e.preventDefault();this.dragCount+=1;if(this.dragCount===1){this.dialogState_=DialogState.DRAGGING}}onDragOver_(e){e.preventDefault()}onDragLeave_(e){e.preventDefault();this.dragCount-=1;if(this.dragCount===0){this.dialogState_=DialogState.NORMAL}}onDrop_(e){e.preventDefault();this.dragCount=0;if(e.dataTransfer){this.$.lensForm.submitFileList(e.dataTransfer.files);recordLensUploadDialogAction(LensUploadDialogAction.IMAGE_DROPPED)}}onFocusOut_(event){if(this.dragCount===1){return}const outsideDialog=document.hasFocus()&&(!event.relatedTarget||!this.$.dialog.contains(event.relatedTarget));if(outsideDialog){this.closeDialog()}}onInputBoxInput_(e){this.uploadUrl_=e.target.value}}customElements.define(LensUploadDialogElement.is,LensUploadDialogElement);function getTemplate$2(){return html$1`<!--_html_template_start_--><style>:host{background-color:var(--color-new-tab-page-background-override);border:solid var(--color-new-tab-page-border) 1px;border-radius:var(--ntp-module-border-radius);box-sizing:border-box;display:block;overflow:hidden;position:relative}#impressionProbe{height:27px;pointer-events:none;position:absolute;width:100%}#moduleElement{align-items:center;background:var(--color-new-tab-page-module-background);display:flex;height:100%;justify-content:center}:host([modules-redesigned-enabled_]){background-color:var(--color-new-tab-page-module-background);border:none;height:fit-content;overflow:visible}:host([modules-redesigned-enabled_]) #moduleElement{border-radius:var(--ntp-module-border-radius)}</style>
<div id="impressionProbe"></div>
<div id="moduleElement"></div>
<!--_html_template_end_-->`}class ModuleWrapperElement extends PolymerElement{static get is(){return"ntp-module-wrapper"}static get template(){return getTemplate$2()}static get properties(){return{module:{observer:"onModuleChange_",type:Object},modulesRedesignedEnabled_:{type:Boolean,value:()=>loadTimeData.getBoolean("modulesRedesignedEnabled"),reflectToAttribute:true}}}onModuleChange_(_newValue,oldValue){assert(!oldValue);this.$.moduleElement.appendChild(this.module.element);this.$.moduleElement.addEventListener("usage",(e=>{e.stopPropagation();if(this.modulesRedesignedEnabled_){NewTabPageProxy.getInstance().handler.onModuleUsed(this.module.descriptor.id)}recordOccurence("NewTabPage.Modules.Usage");recordOccurence(`NewTabPage.Modules.Usage.${this.module.descriptor.id}`)}),{once:true});this.$.moduleElement.addEventListener("menu-button-click",(e=>{e.stopPropagation();if(this.modulesRedesignedEnabled_){NewTabPageProxy.getInstance().handler.onModuleUsed(this.module.descriptor.id)}}),{once:true});this.module.element.addEventListener("info-button-click",(()=>{chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.InfoButtonClicked",this.module.descriptor.id)}),{once:true});const headerObserver=new IntersectionObserver((([{intersectionRatio:intersectionRatio}])=>{if(intersectionRatio>=1){headerObserver.disconnect();const time=WindowProxy.getInstance().now();recordLoadDuration("NewTabPage.Modules.Impression",time);recordLoadDuration(`NewTabPage.Modules.Impression.${this.module.descriptor.id}`,time);this.dispatchEvent(new Event("detect-impression"));this.module.element.dispatchEvent(new Event("detect-impression"))}}),{threshold:1});let intersectionPerdecage=0;const moduleObserver=new IntersectionObserver((([{intersectionRatio:intersectionRatio}])=>{intersectionPerdecage=Math.floor(Math.max(intersectionPerdecage,intersectionRatio*10))}),{threshold:[.1,.2,.3,.4,.5,.6,.7,.8,.9,1]});window.addEventListener("pagehide",(()=>{recordPerdecage("NewTabPage.Modules.ImpressionRatio",intersectionPerdecage);recordPerdecage(`NewTabPage.Modules.ImpressionRatio.${this.module.descriptor.id}`,intersectionPerdecage)}));microTask.run((()=>{headerObserver.observe(this.$.impressionProbe);moduleObserver.observe(this)}));this.addEventListener("mouseover",(()=>{chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Hover",this.module.descriptor.id)}),{capture:true,once:true})}}customElements.define(ModuleWrapperElement.is,ModuleWrapperElement);function getTemplate$1(){return html$1`<!--_html_template_start_--><style include="cr-hidden-style">:host{display:flex;justify-content:center;--ntp-module-container-padding-top:16px}.action-button{--cr-button-text-color:var(--color-new-tab-page-action-button-foreground);--cr-button-background-color:var(--color-new-tab-page-action-button-background);margin-inline-end:8px;margin-top:18px}.cancel-button{--cr-button-text-color:var(--color-new-tab-page-button-foreground)}ntp-module-wrapper{width:var(--ntp-module-width)}.module-container+.module-container{padding-top:var(--ntp-module-container-padding-top)}#modules{max-width:100%;width:fit-content}#removeModuleToastMessage{flex-grow:1}:host([drag-enabled_]) ntp-module-wrapper{cursor:grab}[dragging]{pointer-events:none;position:fixed;z-index:2}</style>
<div id="modules"></div>
<cr-toast id="removeModuleToast" duration="10000">
  <div id="removeModuleToastMessage">[[removedModuleData_.message]]</div>
  <template is="dom-if" if="[[removedModuleData_.undo]]">
    <cr-button id="undoRemoveModuleButton" aria-label="Р§С‚РѕР±С‹ РѕС‚РјРµРЅРёС‚СЊ РґРµР№СЃС‚РІРёРµ, РЅР°Р¶РјРёС‚Рµ CtrlВ +В Z" on-click="onUndoRemoveModuleButtonClick_">
      РћС‚РјРµРЅР°
    </cr-button>
  </template>
</cr-toast>
<!--_html_template_end_-->`}class ModulesElement extends PolymerElement{constructor(){super(...arguments);this.setDisabledModulesListenerId_=null;this.eventTracker_=new EventTracker}static get is(){return"ntp-modules"}static get template(){return getTemplate$1()}static get properties(){return{disabledModules_:{type:Object,value:()=>({all:true,ids:[]})},dismissedModules_:{type:Array,value:()=>[]},dragEnabled_:{type:Boolean,value:()=>loadTimeData.getBoolean("modulesDragAndDropEnabled"),reflectToAttribute:true},modulesLoaded_:Boolean,modulesLoadedAndVisibilityDetermined_:{type:Boolean,computed:`computeModulesLoadedAndVisibilityDetermined_(\n          modulesLoaded_,\n          modulesVisibilityDetermined_)`,observer:"onModulesLoadedAndVisibilityDeterminedChange_"},modulesShownToUser:{type:Boolean,notify:true},modulesVisibilityDetermined_:Boolean,removedModuleData_:{type:Object,value:null}}}static get observers(){return["onRemovedModulesChange_(dismissedModules_.*, disabledModules_)"]}connectedCallback(){super.connectedCallback();this.setDisabledModulesListenerId_=NewTabPageProxy.getInstance().callbackRouter.setDisabledModules.addListener(((all,ids)=>{this.disabledModules_={all:all,ids:ids};this.modulesVisibilityDetermined_=true}));NewTabPageProxy.getInstance().handler.updateDisabledModules();this.eventTracker_.add(window,"keydown",this.onWindowKeydown_.bind(this))}disconnectedCallback(){super.disconnectedCallback();assert(this.setDisabledModulesListenerId_);NewTabPageProxy.getInstance().callbackRouter.removeListener(this.setDisabledModulesListenerId_);this.eventTracker_.removeAll()}ready(){super.ready();this.renderModules_()}appendModuleContainers_(moduleContainers){this.$.modules.innerHTML=window.trustedTypes.emptyHTML;this.modulesShownToUser=false;moduleContainers.forEach((moduleContainer=>{if(!moduleContainer.hidden){this.modulesShownToUser=!moduleContainer.hidden}this.$.modules.appendChild(moduleContainer)}))}async renderModules_(){this.modulesIdNames_=(await NewTabPageProxy.getInstance().handler.getModulesIdNames()).data;const modules=await ModuleRegistry.getInstance().initializeModulesHavingIds(this.modulesIdNames_.map((m=>m.id)),loadTimeData.getInteger("modulesLoadTimeout"));if(modules){NewTabPageProxy.getInstance().handler.onModulesLoadedWithData(modules.map((module=>module.descriptor.id)));const moduleContainers=modules.map((module=>module.elements.map((element=>{const moduleWrapper=new ModuleWrapperElement;moduleWrapper.module={element:element,descriptor:module.descriptor};if(this.dragEnabled_){moduleWrapper.addEventListener("mousedown",(e=>this.onDragStart_(e)))}moduleWrapper.addEventListener("dismiss-module",(e=>this.onDismissModule_(e)));moduleWrapper.addEventListener("disable-module",(e=>this.onDisableModule_(e)));const moduleContainer=this.ownerDocument.createElement("div");moduleContainer.classList.add("module-container");moduleContainer.hidden=this.moduleDisabled_(module.descriptor.id);moduleContainer.appendChild(moduleWrapper);return moduleContainer})))).flat();chrome.metricsPrivate.recordSmallCount("NewTabPage.Modules.LoadedModulesCount",modules.length);this.logModuleLoadedWithModules_(modules);this.appendModuleContainers_(moduleContainers);this.onModulesLoaded_()}}logModuleLoadedWithModules_(modules){const moduleDescriptorIds=modules.map((m=>m.descriptor.id));for(const moduleDescriptorId of moduleDescriptorIds){moduleDescriptorIds.forEach((id=>{if(id!==moduleDescriptorId){chrome.metricsPrivate.recordSparseValueWithPersistentHash(`NewTabPage.Modules.LoadedWith.${moduleDescriptorId}`,id)}}))}}onWindowKeydown_(e){let ctrlKeyPressed=e.ctrlKey;if(ctrlKeyPressed&&e.key==="z"){this.onUndoRemoveModuleButtonClick_()}}onModulesLoaded_(){this.modulesLoaded_=true}computeModulesLoadedAndVisibilityDetermined_(){return this.modulesLoaded_&&this.modulesVisibilityDetermined_}onModulesLoadedAndVisibilityDeterminedChange_(){if(this.modulesLoadedAndVisibilityDetermined_){this.modulesIdNames_.forEach((({id:id})=>{chrome.metricsPrivate.recordBoolean(`NewTabPage.Modules.EnabledOnNTPLoad.${id}`,!this.disabledModules_.all&&!this.disabledModules_.ids.includes(id))}));chrome.metricsPrivate.recordBoolean("NewTabPage.Modules.VisibleOnNTPLoad",!this.disabledModules_.all);this.dispatchEvent(new Event("modules-loaded"))}}onDismissModule_(e){const id=e.target.module.descriptor.id;const restoreCallback=e.detail.restoreCallback;this.removedModuleData_={message:e.detail.message,undo:restoreCallback?()=>{this.splice("dismissedModules_",this.dismissedModules_.indexOf(id),1);restoreCallback();NewTabPageProxy.getInstance().handler.onRestoreModule(id)}:undefined};if(!this.dismissedModules_.includes(id)){this.push("dismissedModules_",id)}this.$.removeModuleToast.show();NewTabPageProxy.getInstance().handler.onDismissModule(id)}onDisableModule_(e){const id=e.target.module.descriptor.id;const restoreCallback=e.detail.restoreCallback;this.removedModuleData_={message:e.detail.message,undo:()=>{if(restoreCallback){restoreCallback()}NewTabPageProxy.getInstance().handler.setModuleDisabled(id,false);chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Enabled",id);chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Enabled.Toast",id)}};NewTabPageProxy.getInstance().handler.setModuleDisabled(id,true);this.$.removeModuleToast.show();chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Disabled",id);chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Disabled.ModuleRequest",id)}moduleDisabled_(id){return this.disabledModules_.all||this.dismissedModules_.includes(id)||this.disabledModules_.ids.includes(id)}onUndoRemoveModuleButtonClick_(){if(!this.removedModuleData_){return}this.removedModuleData_.undo();this.$.removeModuleToast.hide();this.removedModuleData_=null}onRemovedModulesChange_(){this.shadowRoot.querySelectorAll("ntp-module-wrapper").forEach((moduleWrapper=>{moduleWrapper.parentElement.hidden=this.moduleDisabled_(moduleWrapper.module.descriptor.id)}));const moduleContainers=[...this.shadowRoot.querySelectorAll(".module-container")];this.appendModuleContainers_(moduleContainers)}onCustomizeModuleFre_(){this.dispatchEvent(new Event("customize-module",{bubbles:true,composed:true}))}onDragStart_(e){assert(loadTimeData.getBoolean("modulesDragAndDropEnabled"));const dragElement=e.target;const dragElementRect=dragElement.getBoundingClientRect();const dragOffset={x:e.x-dragElementRect.x,y:e.y-dragElementRect.y};dragElement.parentElement.style.width=`${dragElementRect.width}px`;dragElement.parentElement.style.height=`${dragElementRect.height}px`;const undraggedModuleWrappers=[...this.shadowRoot.querySelectorAll("ntp-module-wrapper")].filter((moduleWrapper=>moduleWrapper!==dragElement));const dragOver=e=>{e.preventDefault();dragElement.setAttribute("dragging","");dragElement.style.left=`${e.x-dragOffset.x}px`;dragElement.style.top=`${e.y-dragOffset.y}px`};const dragEnter=e=>{const moduleContainers=[...this.shadowRoot.querySelectorAll(".module-container:not([hidden])"),...this.shadowRoot.querySelectorAll(".module-container[hidden]")];const dragIndex=moduleContainers.indexOf(dragElement.parentElement);const dropIndex=moduleContainers.indexOf(e.target.parentElement);const dragContainer=moduleContainers[dragIndex];const firstRects=undraggedModuleWrappers.map((moduleWrapper=>moduleWrapper.getBoundingClientRect()));moduleContainers.splice(dragIndex,1);moduleContainers.splice(dropIndex,0,dragContainer);this.appendModuleContainers_(moduleContainers);undraggedModuleWrappers.forEach(((moduleWrapper,i)=>{const lastRect=moduleWrapper.getBoundingClientRect();const invertX=firstRects[i].left-lastRect.left;const invertY=firstRects[i].top-lastRect.top;moduleWrapper.animate([{transform:`translate(${invertX}px, ${invertY}px)`,zIndex:0},{transform:"translate(0)",zIndex:0}],{duration:800,easing:"ease"})}))};undraggedModuleWrappers.forEach((moduleWrapper=>{moduleWrapper.addEventListener("mouseover",dragEnter)}));this.ownerDocument.addEventListener("mousemove",dragOver);this.ownerDocument.addEventListener("mouseup",(()=>{this.ownerDocument.removeEventListener("mousemove",dragOver);undraggedModuleWrappers.forEach((moduleWrapper=>{moduleWrapper.removeEventListener("mouseover",dragEnter)}));const firstRect=dragElement.getBoundingClientRect();dragElement.removeAttribute("dragging");dragElement.style.removeProperty("left");dragElement.style.removeProperty("top");const lastRect=dragElement.getBoundingClientRect();const invertX=firstRect.left-lastRect.left;const invertY=firstRect.top-lastRect.top;dragElement.animate([{transform:`translate(${invertX}px, ${invertY}px)`,zIndex:2},{transform:"translate(0)",zIndex:2}],{duration:800,easing:"ease"});const moduleIds=[...this.shadowRoot.querySelectorAll("ntp-module-wrapper")].map((moduleWrapper=>moduleWrapper.module.descriptor.id));NewTabPageProxy.getInstance().handler.setModulesOrder(moduleIds)}),{once:true})}}customElements.define(ModulesElement.is,ModulesElement);let instance=null;function getCss(){return instance||(instance=[...[getCss$k()],css`:host{--menu-item-margin:12px;background-color:var(--color-new-tab-page-module-item-background);border-radius:var(--ntp-module-item-border-radius);display:flex;flex-direction:column}#titleContainer{align-items:center;display:flex;height:20px;padding:12px 12px 8px 12px}#title{color:var(--color-new-tab-page-primary-foreground);font-size:13px;font-weight:400;line-height:20px;margin-block-start:0;margin-block-end:0}#headerSpacer{flex-grow:1}#menuButton{--cr-icon-button-icon-size:20px;--cr-icon-button-fill-color:var(--color-new-tab-page-primary-foreground);--cr-icon-button-hover-background-color:var(--color-new-tab-page-control-background-hovered);margin-inline:0 -6px}#actionMenu{--cr-menu-shadow:var(--ntp-menu-shadow)}.action-menu-icon{--cr-icon-ripple-size:16px;background-color:transparent;margin-inline-start:calc(-1 * var(--menu-item-margin));margin-inline-end:var(--menu-item-margin)}#actionMenuDivider{background-color:var(--color-new-tab-page-module-context-menu-divider);border:none;height:1px;margin:8px 0}`])}function getHtml(){return html`<!--_html_template_start_--><div id="titleContainer">
  <h2 id="title">${this.headerText}</h2>
  <div id="headerSpacer"></div>
  <slot name="title-actions"></slot>
  <cr-icon-button id="menuButton" title="${this.moreActionsText}" class="icon-more-vert" @click="${this.onMenuButtonClick_}">
  </cr-icon-button>
</div>

<cr-action-menu id="actionMenu" role-description="Р”СЂСѓРіРёРµ РґРµР№СЃС‚РІРёСЏ">
  ${this.menuItemGroups.map(((group,index)=>html`
    ${group.map((item=>html`
      <button id="${item.action}" class="dropdown-item" @click="${this.onButtonClick_}" data-action="${item.action}">
        <cr-icon class="action-menu-icon cr-icon" icon="${item.icon}"></cr-icon>
        ${item.text}
      </button>
    `))}
    <hr id="actionMenuDivider" ?hidden="${!this.showDivider_(index)}">
  `))}
</cr-action-menu>
<!--_html_template_end_-->`}class ModuleHeaderElement extends CrLitElement{constructor(){super(...arguments);this.menuItemGroups=[]}static get is(){return"ntp-module-header-v2"}static get styles(){return getCss()}render(){return getHtml.bind(this)()}static get properties(){return{headerText:{type:String},moreActionsText:{type:String},menuItemGroups:{type:Array}}}showAt(e){this.$.actionMenu.showAt(e.target)}onButtonClick_(e){const action=e.currentTarget.dataset["action"];assert(action);e.stopPropagation();this.$.actionMenu.close();if(action==="customize-module"){this.dispatchEvent(new Event("customize-module",{bubbles:true,composed:true}))}else{this.dispatchEvent(new Event(`${action}-button-click`,{bubbles:true,composed:true}))}}onMenuButtonClick_(e){e.stopPropagation();this.dispatchEvent(new Event("menu-button-click",{bubbles:true,composed:true}))}showDivider_(index){return index===0}}customElements.define(ModuleHeaderElement.is,ModuleHeaderElement);const HelpBubbleMixin=dedupingMixin((superClass=>{class HelpBubbleMixin extends superClass{constructor(...args){super(...args);this.helpBubbleControllerById_=new Map;this.helpBubbleListenerIds_=[];this.helpBubbleFixedAnchorObserver_=null;this.helpBubbleResizeObserver_=null;this.helpBubbleDismissedEventTracker_=new EventTracker;this.debouncedAnchorMayHaveChangedCallback_=null;this.helpBubbleHandler_=HelpBubbleProxyImpl.getInstance().getHandler();this.helpBubbleCallbackRouter_=HelpBubbleProxyImpl.getInstance().getCallbackRouter()}connectedCallback(){super.connectedCallback();const router=this.helpBubbleCallbackRouter_;this.helpBubbleListenerIds_.push(router.showHelpBubble.addListener(this.onShowHelpBubble_.bind(this)),router.toggleFocusForAccessibility.addListener(this.onToggleHelpBubbleFocusForAccessibility_.bind(this)),router.hideHelpBubble.addListener(this.onHideHelpBubble_.bind(this)),router.externalHelpBubbleUpdated.addListener(this.onExternalHelpBubbleUpdated_.bind(this)));const isVisible=element=>{const rect=element.getBoundingClientRect();return rect.height>0&&rect.width>0};this.debouncedAnchorMayHaveChangedCallback_=debounceEnd(this.onAnchorBoundsMayHaveChanged_.bind(this),50);this.helpBubbleResizeObserver_=new ResizeObserver((entries=>entries.forEach((({target:target})=>{if(target===document.body){if(this.debouncedAnchorMayHaveChangedCallback_){this.debouncedAnchorMayHaveChangedCallback_()}}else{this.onAnchorVisibilityChanged_(target,isVisible(target))}}))));this.helpBubbleFixedAnchorObserver_=new IntersectionObserver((entries=>entries.forEach((({target:target,isIntersecting:isIntersecting})=>this.onAnchorVisibilityChanged_(target,isIntersecting)))),{root:null});document.addEventListener("scroll",this.debouncedAnchorMayHaveChangedCallback_,{passive:true});this.helpBubbleResizeObserver_.observe(document.body);this.controllers.forEach((ctrl=>this.observeControllerAnchor_(ctrl)))}get controllers(){return Array.from(this.helpBubbleControllerById_.values())}disconnectedCallback(){super.disconnectedCallback();for(const listenerId of this.helpBubbleListenerIds_){this.helpBubbleCallbackRouter_.removeListener(listenerId)}this.helpBubbleListenerIds_=[];assert(this.helpBubbleResizeObserver_);this.helpBubbleResizeObserver_.disconnect();this.helpBubbleResizeObserver_=null;assert(this.helpBubbleFixedAnchorObserver_);this.helpBubbleFixedAnchorObserver_.disconnect();this.helpBubbleFixedAnchorObserver_=null;this.helpBubbleDismissedEventTracker_.removeAll();this.helpBubbleControllerById_.clear();if(this.debouncedAnchorMayHaveChangedCallback_){document.removeEventListener("scroll",this.debouncedAnchorMayHaveChangedCallback_);this.debouncedAnchorMayHaveChangedCallback_=null}}registerHelpBubble(nativeId,trackable,options={}){if(this.helpBubbleControllerById_.has(nativeId)){const ctrl=this.helpBubbleControllerById_.get(nativeId);if(ctrl&&ctrl.isBubbleShowing()){return null}this.unregisterHelpBubble(nativeId)}const controller=new HelpBubbleController(nativeId,this.shadowRoot);controller.track(trackable,parseOptions(options));this.helpBubbleControllerById_.set(nativeId,controller);if(this.helpBubbleResizeObserver_){this.observeControllerAnchor_(controller)}return controller}unregisterHelpBubble(nativeId){const ctrl=this.helpBubbleControllerById_.get(nativeId);if(ctrl&&ctrl.hasAnchor()){this.onAnchorVisibilityChanged_(ctrl.getAnchor(),false);this.unobserveControllerAnchor_(ctrl)}this.helpBubbleControllerById_.delete(nativeId)}observeControllerAnchor_(controller){const anchor=controller.getAnchor();assert(anchor,"Help bubble does not have anchor");if(controller.isAnchorFixed()){assert(this.helpBubbleFixedAnchorObserver_);this.helpBubbleFixedAnchorObserver_.observe(anchor)}else{assert(this.helpBubbleResizeObserver_);this.helpBubbleResizeObserver_.observe(anchor)}}unobserveControllerAnchor_(controller){const anchor=controller.getAnchor();assert(anchor,"Help bubble does not have anchor");if(controller.isAnchorFixed()){assert(this.helpBubbleFixedAnchorObserver_);this.helpBubbleFixedAnchorObserver_.unobserve(anchor)}else{assert(this.helpBubbleResizeObserver_);this.helpBubbleResizeObserver_.unobserve(anchor)}}isHelpBubbleShowing(){return this.controllers.some((ctrl=>ctrl.isBubbleShowing()))}isHelpBubbleShowingForTesting(id){const ctrls=this.controllers.filter(this.filterMatchingIdForTesting_(id));return!!ctrls[0]}getHelpBubbleForTesting(id){const ctrls=this.controllers.filter(this.filterMatchingIdForTesting_(id));return ctrls[0]?ctrls[0].getBubble():null}filterMatchingIdForTesting_(anchorId){return ctrl=>ctrl.isBubbleShowing()&&ctrl.getAnchor()!==null&&ctrl.getAnchor().id===anchorId}getSortedAnchorStatusesForTesting(){return this.controllers.sort(((a,b)=>a.getNativeId().localeCompare(b.getNativeId()))).map((ctrl=>[ctrl.getNativeId(),ctrl.hasAnchor()]))}canShowHelpBubble(controller){if(!this.helpBubbleControllerById_.has(controller.getNativeId())){return false}if(!controller.canShowBubble()){return false}const anchor=controller.getAnchor();const anchorIsUsed=this.controllers.some((otherCtrl=>otherCtrl.isBubbleShowing()&&otherCtrl.getAnchor()===anchor));return!anchorIsUsed}showHelpBubble(controller,params){assert(this.canShowHelpBubble(controller),"Can't show help bubble");const bubble=controller.createBubble(params);this.helpBubbleDismissedEventTracker_.add(bubble,HELP_BUBBLE_DISMISSED_EVENT,this.onHelpBubbleDismissed_.bind(this));this.helpBubbleDismissedEventTracker_.add(bubble,HELP_BUBBLE_TIMED_OUT_EVENT,this.onHelpBubbleTimedOut_.bind(this));controller.show()}hideHelpBubble(nativeId){const ctrl=this.helpBubbleControllerById_.get(nativeId);if(!ctrl||!ctrl.hasBubble()){return false}this.helpBubbleDismissedEventTracker_.remove(ctrl.getBubble(),HELP_BUBBLE_DISMISSED_EVENT);this.helpBubbleDismissedEventTracker_.remove(ctrl.getBubble(),HELP_BUBBLE_TIMED_OUT_EVENT);ctrl.hide();return true}notifyHelpBubbleAnchorActivated(nativeId){const ctrl=this.helpBubbleControllerById_.get(nativeId);if(!ctrl||!ctrl.isBubbleShowing()){return false}this.helpBubbleHandler_.helpBubbleAnchorActivated(nativeId);return true}notifyHelpBubbleAnchorCustomEvent(nativeId,customEvent){const ctrl=this.helpBubbleControllerById_.get(nativeId);if(!ctrl||!ctrl.isBubbleShowing()){return false}this.helpBubbleHandler_.helpBubbleAnchorCustomEvent(nativeId,customEvent);return true}onAnchorVisibilityChanged_(target,isVisible){const nativeId=target.dataset["nativeId"];assert(nativeId);const ctrl=this.helpBubbleControllerById_.get(nativeId);const hidden=this.hideHelpBubble(nativeId);if(hidden){this.helpBubbleHandler_.helpBubbleClosed(nativeId,HelpBubbleClosedReason.kPageChanged)}const bounds=isVisible?this.getElementBounds_(target):{x:0,y:0,width:0,height:0};if(!ctrl||ctrl.updateAnchorVisibility(isVisible,bounds)){this.helpBubbleHandler_.helpBubbleAnchorVisibilityChanged(nativeId,isVisible,bounds)}}onAnchorBoundsMayHaveChanged_(){for(const ctrl of this.controllers){if(ctrl.hasAnchor()&&ctrl.getAnchorVisibility()){const bounds=this.getElementBounds_(ctrl.getAnchor());if(ctrl.updateAnchorVisibility(true,bounds)){this.helpBubbleHandler_.helpBubbleAnchorVisibilityChanged(ctrl.getNativeId(),true,bounds)}}}}getElementBounds_(element){const rect={x:0,y:0,width:0,height:0};const bounds=element.getBoundingClientRect();rect.x=bounds.x;rect.y=bounds.y;rect.width=bounds.width;rect.height=bounds.height;const nativeId=element.dataset["nativeId"];if(!nativeId){return rect}const ctrl=this.helpBubbleControllerById_.get(nativeId);if(ctrl){const padding=ctrl.getPadding();rect.x-=padding.left;rect.y-=padding.top;rect.width+=padding.left+padding.right;rect.height+=padding.top+padding.bottom}return rect}onShowHelpBubble_(params){if(!this.helpBubbleControllerById_.has(params.nativeIdentifier)){return}const ctrl=this.helpBubbleControllerById_.get(params.nativeIdentifier);this.showHelpBubble(ctrl,params)}onToggleHelpBubbleFocusForAccessibility_(nativeId){if(!this.helpBubbleControllerById_.has(nativeId)){return}const ctrl=this.helpBubbleControllerById_.get(nativeId);if(ctrl){const anchor=ctrl.getAnchor();if(anchor){anchor.focus()}}}onHideHelpBubble_(nativeId){this.hideHelpBubble(nativeId)}onExternalHelpBubbleUpdated_(nativeId,shown){if(!this.helpBubbleControllerById_.has(nativeId)){return}const ctrl=this.helpBubbleControllerById_.get(nativeId);ctrl.updateExternalShowingStatus(shown)}onHelpBubbleDismissed_(e){const nativeId=e.detail.nativeId;assert(nativeId);const hidden=this.hideHelpBubble(nativeId);assert(hidden);if(nativeId){if(e.detail.fromActionButton){this.helpBubbleHandler_.helpBubbleButtonPressed(nativeId,e.detail.buttonIndex)}else{this.helpBubbleHandler_.helpBubbleClosed(nativeId,HelpBubbleClosedReason.kDismissedByUser)}}}onHelpBubbleTimedOut_(e){const nativeId=e.detail.nativeId;const ctrl=this.helpBubbleControllerById_.get(nativeId);assert(ctrl);const hidden=this.hideHelpBubble(nativeId);assert(hidden);if(nativeId){this.helpBubbleHandler_.helpBubbleClosed(nativeId,HelpBubbleClosedReason.kTimedOut)}}}return HelpBubbleMixin}));function parseOptions(options){const padding={top:0,bottom:0,left:0,right:0};padding.top=clampPadding(options.anchorPaddingTop);padding.left=clampPadding(options.anchorPaddingLeft);padding.bottom=clampPadding(options.anchorPaddingBottom);padding.right=clampPadding(options.anchorPaddingRight);return{padding:padding,fixed:!!options.fixed}}function clampPadding(n=0){return Math.max(0,Math.min(20,n))}function getTemplate(){return html$1`<!--_html_template_start_--><style include="cr-hidden-style">#container{display:flex;flex-flow:row wrap;gap:var(--container-gap);justify-content:center;margin-top:8px;max-width:var(--container-max-width,inherit)}#undoToastMessage{flex-grow:1}</style>
<div id="container">
</div>
<template>
  <ntp-module-wrapper module="[[item]]" hidden="[[moduleDisabled_(disabledModules_, item)]]" on-disable-module="onDisableModule_" on-dismiss-module-element="onDismissModuleElement_" on-dismiss-module-instance="onDismissModuleInstance_">
  </ntp-module-wrapper>
</template>
<cr-toast id="undoToast" duration="10000">
  <div id="undoToastMessage">[[undoData_.message]]</div>
  <template is="dom-if" if="[[undoData_.undo]]">
    <cr-button id="undoButton" aria-label="Р§С‚РѕР±С‹ РѕС‚РјРµРЅРёС‚СЊ РґРµР№СЃС‚РІРёРµ, РЅР°Р¶РјРёС‚Рµ CtrlВ +В Z" on-click="onUndoButtonClick_">
      РћС‚РјРµРЅР°
    </cr-button>
  </template>
</cr-toast>
<!--_html_template_end_-->`}const SUPPORTED_MODULE_WIDTHS=[{name:"narrow",value:312},{name:"medium",value:360},{name:"wide",value:728}];const CONTAINER_GAP_WIDTH=8;const MARGIN_WIDTH=48;const METRIC_NAME_MODULE_DISABLED="NewTabPage.Modules.Disabled";const MODULE_CUSTOMIZE_ELEMENT_ID="NewTabPageUI::kModulesCustomizeIPHAnchorElement";const AppElementBase=HelpBubbleMixin(PolymerElement);class ModulesV2Element extends AppElementBase{constructor(){super(...arguments);this.eventTracker_=new EventTracker;this.setDisabledModulesListenerId_=null;this.containerObserver_=null;this.templateInstances_=[]}static get is(){return"ntp-modules-v2"}static get template(){return getTemplate()}static get properties(){return{disabledModules_:{type:Object,observer:"onDisabledModulesChange_",value:()=>({all:true,ids:[]})},modulesShownToUser:{type:Boolean,notify:true},undoData_:{type:Object,value:null}}}connectedCallback(){super.connectedCallback();this.setDisabledModulesListenerId_=NewTabPageProxy.getInstance().callbackRouter.setDisabledModules.addListener(((all,ids)=>{this.disabledModules_={all:all,ids:ids}}));NewTabPageProxy.getInstance().handler.updateDisabledModules();const widths=new Set;for(let i=0;i<SUPPORTED_MODULE_WIDTHS.length;i++){const namedWidth=SUPPORTED_MODULE_WIDTHS[i];for(let u=1;u<=this.maxColumnCount_-i;u++){const width=namedWidth.value*u+CONTAINER_GAP_WIDTH*(u-1);if(width<=this.containerMaxWidth_){widths.add(width)}}}const thresholds=[...widths];thresholds.sort(((i,j)=>i-j));const queries=[];for(let i=1;i<thresholds.length-1;i++){queries.push({maxWidth:thresholds[i+1]-1,query:`(min-width: ${thresholds[i]+2*MARGIN_WIDTH}px) and (max-width: ${thresholds[i+1]-1+2*MARGIN_WIDTH}px)`})}queries.splice(0,0,{maxWidth:thresholds[0],query:`(max-width: ${thresholds[0]-1+2*MARGIN_WIDTH}px)`});queries.push({maxWidth:thresholds[thresholds.length-1],query:`(min-width: ${thresholds[thresholds.length-1]+2*MARGIN_WIDTH}px)`});queries.forEach((details=>{const query=WindowProxy.getInstance().matchMedia(details.query);this.eventTracker_.add(query,"change",(e=>{if(e.matches){this.updateContainerAndChildrenStyles_(details.maxWidth)}}))}));this.eventTracker_.add(window,"keydown",this.onWindowKeydown_.bind(this));this.containerObserver_=new MutationObserver((()=>{this.updateContainerAndChildrenStyles_()}));this.containerObserver_.observe(this.$.container,{childList:true})}disconnectedCallback(){super.disconnectedCallback();assert(this.setDisabledModulesListenerId_);NewTabPageProxy.getInstance().callbackRouter.removeListener(this.setDisabledModulesListenerId_);this.eventTracker_.removeAll();this.containerObserver_.disconnect()}ready(){super.ready();this.updateStyles({"--container-gap":`${CONTAINER_GAP_WIDTH}px`});this.maxColumnCount_=loadTimeData.getInteger("modulesMaxColumnCount");this.containerMaxWidth_=this.maxColumnCount_*SUPPORTED_MODULE_WIDTHS[0].value+(this.maxColumnCount_-1)*CONTAINER_GAP_WIDTH;this.loadModules_()}moduleDisabled_(disabledModules,instance){return disabledModules.all||disabledModules.ids.includes(instance.descriptor.id)}async loadModules_(){const modulesIdNames=(await NewTabPageProxy.getInstance().handler.getModulesIdNames()).data;const modules=await ModuleRegistry.getInstance().initializeModulesHavingIds(modulesIdNames.map((m=>m.id)),loadTimeData.getInteger("modulesLoadTimeout"));if(modules){NewTabPageProxy.getInstance().handler.onModulesLoadedWithData(modules.map((module=>module.descriptor.id)));const template=this.shadowRoot.querySelector("template");const moduleWrapperConstructor=templatize(template,this,{parentModel:true,forwardHostProp:this.forwardHostProp_,instanceProps:{item:true}});if(modules.length>1){const maxModuleInstanceCount=modules.length>=this.maxColumnCount_?1:loadTimeData.getInteger("multipleLoadedModulesMaxModuleInstanceCount");if(maxModuleInstanceCount>0){modules.forEach((module=>{module.elements.splice(maxModuleInstanceCount,module.elements.length-maxModuleInstanceCount)}))}}this.templateInstances_=modules.map((module=>module.elements.map((element=>({element:element,descriptor:module.descriptor}))))).flat().map((instance=>new moduleWrapperConstructor({item:instance})));this.templateInstances_.map((t=>t.children[0])).forEach((wrapperElement=>{this.$.container.appendChild(wrapperElement)}));chrome.metricsPrivate.recordSmallCount("NewTabPage.Modules.LoadedModulesCount",modules.length);modulesIdNames.forEach((({id:id})=>{chrome.metricsPrivate.recordBoolean(`NewTabPage.Modules.EnabledOnNTPLoad.${id}`,!this.disabledModules_.all&&!this.disabledModules_.ids.includes(id))}));chrome.metricsPrivate.recordSmallCount("NewTabPage.Modules.InstanceCount",this.templateInstances_.length);chrome.metricsPrivate.recordBoolean("NewTabPage.Modules.VisibleOnNTPLoad",!this.disabledModules_.all);this.recordModuleLoadedWithModules_(modules);this.dispatchEvent(new Event("modules-loaded"));if(this.templateInstances_.length>0){this.registerHelpBubble(MODULE_CUSTOMIZE_ELEMENT_ID,["#container","ntp-module-wrapper","#moduleElement"],{fixed:true});setTimeout((()=>{NewTabPageProxy.getInstance().handler.maybeShowFeaturePromo(IphFeature.kCustomizeModules)}),1e3)}}}recordModuleLoadedWithModules_(modules){const moduleDescriptorIds=modules.map((m=>m.descriptor.id));for(const moduleDescriptorId of moduleDescriptorIds){moduleDescriptorIds.forEach((id=>{if(id!==moduleDescriptorId){chrome.metricsPrivate.recordSparseValueWithPersistentHash(`NewTabPage.Modules.LoadedWith.${moduleDescriptorId}`,id)}}))}}forwardHostProp_(property,value){this.templateInstances_.forEach((instance=>{instance.forwardHostProp(property,value)}))}updateContainerAndChildrenStyles_(availableWidth){if(typeof availableWidth==="undefined"){availableWidth=Math.min(document.body.clientWidth-2*MARGIN_WIDTH,this.containerMaxWidth_)}const moduleWrappers=Array.from(this.shadowRoot.querySelectorAll("ntp-module-wrapper:not([hidden])"));this.modulesShownToUser=moduleWrappers.length!==0;if(moduleWrappers.length===0){return}this.updateStyles({"--container-max-width":`${availableWidth}px`});const clamp=(min,val,max)=>Math.max(min,Math.min(val,max));const rowMaxInstanceCount=clamp(1,Math.floor((availableWidth+CONTAINER_GAP_WIDTH)/(CONTAINER_GAP_WIDTH+SUPPORTED_MODULE_WIDTHS[0].value)),this.maxColumnCount_);let index=0;while(index<moduleWrappers.length){const instances=moduleWrappers.slice(index,index+rowMaxInstanceCount).map((w=>w.module));let namedWidth=SUPPORTED_MODULE_WIDTHS[0];for(let i=1;i<SUPPORTED_MODULE_WIDTHS.length;i++){if(Math.floor((availableWidth-CONTAINER_GAP_WIDTH*(instances.length-1))/SUPPORTED_MODULE_WIDTHS[i].value)<instances.length){break}namedWidth=SUPPORTED_MODULE_WIDTHS[i]}instances.slice(0,instances.length).forEach((instance=>{instance.element.setAttribute("format",namedWidth.name);instance.element.style.width=`${namedWidth.value}px`}));index+=instances.length}}onDisableModule_(e){const id=e.target.module.descriptor.id;const restoreCallback=e.detail.restoreCallback;this.undoData_={message:e.detail.message,undo:()=>{if(restoreCallback){restoreCallback()}NewTabPageProxy.getInstance().handler.setModuleDisabled(id,false);chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Enabled",id);chrome.metricsPrivate.recordSparseValueWithPersistentHash("NewTabPage.Modules.Enabled.Toast",id)}};NewTabPageProxy.getInstance().handler.setModuleDisabled(id,true);this.$.undoToast.show();chrome.metricsPrivate.recordSparseValueWithPersistentHash(METRIC_NAME_MODULE_DISABLED,id);chrome.metricsPrivate.recordSparseValueWithPersistentHash(`${METRIC_NAME_MODULE_DISABLED}.ModuleRequest`,id)}onDisabledModulesChange_(){this.updateContainerAndChildrenStyles_()}onDismissModuleInstance_(e){const wrapper=e.target;const index=Array.from(wrapper.parentNode.children).indexOf(wrapper);wrapper.remove();const restoreCallback=e.detail.restoreCallback;this.undoData_={message:e.detail.message,undo:restoreCallback?()=>{this.$.container.insertBefore(wrapper,this.$.container.childNodes[index]);restoreCallback();recordOccurence("NewTabPage.Modules.Restored");recordOccurence(`NewTabPage.Modules.Restored.${wrapper.module.descriptor.id}`)}:undefined};this.$.undoToast.show();NewTabPageProxy.getInstance().handler.onDismissModule(wrapper.module.descriptor.id)}onDismissModuleElement_(e){const restoreCallback=e.detail.restoreCallback;this.undoData_={message:e.detail.message,undo:restoreCallback?()=>{restoreCallback()}:undefined};this.$.undoToast.show()}onUndoButtonClick_(){if(!this.undoData_){return}this.undoData_.undo();this.$.undoToast.hide();this.undoData_=null}onWindowKeydown_(e){let ctrlKeyPressed=e.ctrlKey;if(ctrlKeyPressed&&e.key==="z"){this.onUndoButtonClick_()}}}customElements.define(ModulesV2Element.is,ModulesV2Element);export{CalendarAction,CalendarElement,CalendarEventElement,DriveModuleElement$1 as DriveModuleElement,DriveModuleElement as DriveModuleV2Element,FileProxy,FileSuggestionElement,GoogleCalendarModuleElement,GoogleCalendarProxyImpl,InfoDialogElement,LensErrorType,LensFormElement,LensSubmitType,LensUploadDialogAction,LensUploadDialogElement,LensUploadDialogError,MODULE_CUSTOMIZE_ELEMENT_ID,MiddleSlotPromoElement,MobilePromoElement,ModuleDescriptor,ModuleHeaderElement$1 as ModuleHeaderElement,ModuleHeaderElement as ModuleHeaderElementV2,ModuleRegistry,ModuleWrapperElement,ModulesElement,ModulesV2Element,ModuleElement as MostRelevantTabResumptionModuleElement,MostRelevantTabResumptionProxyImpl,OutlookCalendarModuleElement,OutlookCalendarProxyImpl,PageImageServiceBrowserProxy,PromoDismissAction,SUPPORTED_MODULE_WIDTHS,SharepointModuleElement,counterfactualLoad,driveDescriptor,driveModuleV2Descriptor,googleCalendarDescriptor,mostRelevantTabResumptionDescriptor,outlookCalendarDescriptor,sharepointModuleDescriptor};
